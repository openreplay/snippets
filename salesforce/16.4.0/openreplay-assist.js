(()=>{"undefined"!=typeof window&&(window.parcelRequire=window.parcelRequire||void 0);let n=Object.create(null),b=(n.open="0",n.close="1",n.ping="2",n.pong="3",n.message="4",n.upgrade="5",n.noop="6",Object.create(null)),w=(Object.keys(n).forEach(e=>{b[n[e]]=e}),{type:"error",data:"parser error"}),_="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),C="function"==typeof ArrayBuffer,O=e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,R=({type:e,data:t},s,i)=>_&&t instanceof Blob?s?i(t):N(t,i):C&&(t instanceof ArrayBuffer||O(t))?s?i(t):N(new Blob([t]),i):i(n[e]+(t||"")),N=(e,t)=>{let s=new FileReader;return s.onload=function(){var e=s.result.split(",")[1];t("b"+(e||""))},s.readAsDataURL(e)};function A(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let D;var M="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";let H="undefined"==typeof Uint8Array?[]:new Uint8Array(256);for(let e=0;e<M.length;e++)H[M.charCodeAt(e)]=e;let z=e=>{let t=.75*e.length,s=e.length,i,n=0,r,o,a,h;"="===e[e.length-1]&&(t--,"="===e[e.length-2])&&t--;var l=new ArrayBuffer(t),c=new Uint8Array(l);for(i=0;i<s;i+=4)r=H[e.charCodeAt(i)],o=H[e.charCodeAt(i+1)],a=H[e.charCodeAt(i+2)],h=H[e.charCodeAt(i+3)],c[n++]=r<<2|o>>4,c[n++]=(15&o)<<4|a>>2,c[n++]=(3&a)<<6|63&h;return l},W="function"==typeof ArrayBuffer,V=(e,t)=>{var s;return"string"!=typeof e?{type:"message",data:G(e,t)}:"b"===(s=e.charAt(0))?{type:"message",data:((e,t)=>{if(W){const s=z(e);return G(s,t)}else return{base64:true,data:e}})(e.substring(1),t)}:b[s]?1<e.length?{type:b[s],data:e.substring(1)}:{type:b[s]}:w},G=(e,t)=>"blob"!==t?e instanceof ArrayBuffer?e:e.buffer:e instanceof Blob?e:new Blob([e]),Y=String.fromCharCode(30);function Q(){return new TransformStream({transform(n,r){var e,t;e=n,t=e=>{var t,s=e.length;let i;s<126?(i=new Uint8Array(1),new DataView(i.buffer).setUint8(0,s)):s<65536?(i=new Uint8Array(3),(t=new DataView(i.buffer)).setUint8(0,126),t.setUint16(1,s)):(i=new Uint8Array(9),(t=new DataView(i.buffer)).setUint8(0,127),t.setBigUint64(1,BigInt(s))),n.data&&"string"!=typeof n.data&&(i[0]|=128),r.enqueue(i),r.enqueue(e)},_&&e.data instanceof Blob?e.data.arrayBuffer().then(A).then(t):C&&(e.data instanceof ArrayBuffer||O(e.data))?t(A(e.data)):R(e,!1,e=>{D=D||new TextEncoder,t(D.encode(e))})}})}let Z;function ee(e){return e.reduce((e,t)=>e+t.length,0)}function te(t,s){if(t[0].length===s)return t.shift();var i=new Uint8Array(s);let n=0;for(let e=0;e<s;e++)i[e]=t[0][n++],n===t[0].length&&(t.shift(),n=0);return t.length&&n<t[0].length&&(t[0]=t[0].slice(n)),i}function i(e){if(e){var t,s=e;for(t in i.prototype)s[t]=i.prototype[t];return s}}i.prototype.on=i.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},i.prototype.once=function(e,t){function s(){this.off(e,s),t.apply(this,arguments)}return s.fn=t,this.on(e,s),this},i.prototype.off=i.prototype.removeListener=i.prototype.removeAllListeners=i.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)this._callbacks={};else{var s=this._callbacks["$"+e];if(s)if(1==arguments.length)delete this._callbacks["$"+e];else{for(var i,n=0;n<s.length;n++)if((i=s[n])===t||i.fn===t){s.splice(n,1);break}0===s.length&&delete this._callbacks["$"+e]}}return this},i.prototype.emitReserved=i.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),s=this._callbacks["$"+e],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(s)for(var i=0,n=(s=s.slice(0)).length;i<n;++i)s[i].apply(this,t);return this},i.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},i.prototype.hasListeners=function(e){return!!this.listeners(e).length};let se="function"==typeof Promise&&"function"==typeof Promise.resolve?e=>Promise.resolve().then(e):(e,t)=>t(e,0),s="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function ie(s,...e){return e.reduce((e,t)=>(s.hasOwnProperty(t)&&(e[t]=s[t]),e),{})}let ne=s.setTimeout,re=s.clearTimeout;function oe(e,t){t.useNativeTimers?(e.setTimeoutFn=ne.bind(s),e.clearTimeoutFn=re.bind(s)):(e.setTimeoutFn=s.setTimeout.bind(s),e.clearTimeoutFn=s.clearTimeout.bind(s))}function ae(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}class he extends Error{constructor(e,t,s){super(e),this.description=t,this.context=s,this.type="TransportError"}}class le extends i{constructor(e){super(),this.writable=!1,oe(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,t,s){return super.emitReserved("error",new he(e,t,s)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){e=V(e,this.socket.binaryType);this.onPacket(e)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){var e=this.opts.hostname;return-1===e.indexOf(":")?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}_query(e){e=(e=>{let t="";for(var s in e)e.hasOwnProperty(s)&&(t.length&&(t+="&"),t+=encodeURIComponent(s)+"="+encodeURIComponent(e[s]));return t})(e);return e.length?"?"+e:""}}class ce extends le{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";let t=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let e=0;this._polling&&(e++,this.once("pollComplete",function(){--e||t()})),this.writable||(e++,this.once("drain",function(){--e||t()}))}else t()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){((e,t)=>{var s=e.split(Y),i=[];for(let e=0;e<s.length;e++){var n=V(s[e],t);if(i.push(n),"error"===n.type)break}return i})(e,this.socket.binaryType).forEach(e=>{if("opening"===this.readyState&&"open"===e.type&&this.onOpen(),"close"===e.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(e)}),"closed"!==this.readyState&&(this._polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState)&&this._poll()}doClose(){var e=()=>{this.write([{type:"close"}])};"open"===this.readyState?e():this.once("open",e)}write(e){this.writable=!1,((e,s)=>{let i=e.length,n=new Array(i),r=0;e.forEach((e,t)=>{R(e,!1,e=>{n[t]=e,++r===i&&s(n.join(Y))})})})(e,e=>{this.doWrite(e,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){var e=this.opts.secure?"https":"http",t=this.query||{};return!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=ae()),this.supportsBinary||t.sid||(t.b64=1),this.createUri(e,t)}}let de=!1;try{de="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(Ds){}let ue=de;function pe(){}class fe extends ce{constructor(t){if(super(t),"undefined"!=typeof location){var s="https:"===location.protocol;let e=location.port;e=e||(s?"443":"80"),this.xd=void 0!==location&&t.hostname!==location.hostname||e!==t.port}}doWrite(e,t){e=this.request({method:"POST",data:e});e.on("success",t),e.on("error",(e,t)=>{this.onError("xhr post error",e,t)})}doPoll(){var e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(e,t)=>{this.onError("xhr poll error",e,t)}),this.pollXhr=e}}let ge=class Request extends i{constructor(e,t,s){super(),this.createRequest=e,oe(this,s),this._opts=s,this._method=s.method||"GET",this._uri=t,this._data=void 0!==s.data?s.data:null,this._create()}_create(){var e,t=ie(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this._opts.xd;let s=this._xhr=this.createRequest(t);try{s.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders)for(var i in s.setDisableHeaderCheck&&s.setDisableHeaderCheck(!0),this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(i)&&s.setRequestHeader(i,this._opts.extraHeaders[i])}catch(e){}if("POST"===this._method)try{s.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{s.setRequestHeader("Accept","*/*")}catch(e){}null!=(e=this._opts.cookieJar)&&e.addCookies(s),"withCredentials"in s&&(s.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(s.timeout=this._opts.requestTimeout),s.onreadystatechange=()=>{var e;3===s.readyState&&null!=(e=this._opts.cookieJar)&&e.parseCookies(s.getResponseHeader("set-cookie")),4===s.readyState&&(200===s.status||1223===s.status?this._onLoad():this.setTimeoutFn(()=>{this._onError("number"==typeof s.status?s.status:0)},0))},s.send(this._data)}catch(e){return void this.setTimeoutFn(()=>{this._onError(e)},0)}"undefined"!=typeof document&&(this._index=Request.requestsCount++,Request.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(null!=this._xhr){if(this._xhr.onreadystatechange=pe,e)try{this._xhr.abort()}catch(e){}"undefined"!=typeof document&&delete Request.requests[this._index],this._xhr=null}}_onLoad(){var e=this._xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}};function me(){for(var e in ge.requests)ge.requests.hasOwnProperty(e)&&ge.requests[e].abort()}ge.requestsCount=0,ge.requests={},"undefined"!=typeof document&&("function"==typeof attachEvent?attachEvent("onunload",me):"function"==typeof addEventListener&&addEventListener("onpagehide"in s?"pagehide":"unload",me,!1));let ve=(e=be({xdomain:!1}))&&null!==e.responseType;class ye extends fe{constructor(e){super(e);e=e&&e.forceBase64;this.supportsBinary=ve&&!e}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new ge(be,this.uri(),e)}}function be(e){e=e.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!e||ue))return new XMLHttpRequest}catch(e){}if(!e)try{return new s[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch(e){}}let we="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();class Se extends le{get name(){return"websocket"}doOpen(){var e=this.uri(),t=this.opts.protocols,s=we?{}:ie(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(s.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,t,s)}catch(e){return this.emitReserved("error",e)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(i){this.writable=!1;for(let e=0;e<i.length;e++){let t=i[e],s=e===i.length-1;R(t,this.supportsBinary,e=>{try{this.doWrite(t,e)}catch(e){}s&&se(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){void 0!==this.ws&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){var e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=ae()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}}let ke=s.WebSocket||s.MozWebSocket;class Te extends Se{createSocket(e,t,s){return we?new ke(e,t,s):t?new ke(e,t):new ke(e)}doWrite(e,t){this.ws.send(t)}}class Ee extends le{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{var t=((r,o)=>{Z=Z||new TextDecoder;let a=[],h=0,l=-1,c=!1;return new TransformStream({transform(e,t){for(a.push(e);;){if(0===h){if(ee(a)<1)break;var s=te(a,1);c=128==(128&s[0]),l=127&s[0],h=l<126?3:126===l?1:2}else if(1===h){if(ee(a)<2)break;s=te(a,2);l=new DataView(s.buffer,s.byteOffset,s.length).getUint16(0),h=3}else if(2===h){if(ee(a)<8)break;var i=te(a,8),i=new DataView(i.buffer,i.byteOffset,i.length),n=i.getUint32(0);if(n>Math.pow(2,21)-1){t.enqueue(w);break}l=n*Math.pow(2,32)+i.getUint32(4),h=3}else{if(ee(a)<l)break;n=te(a,l);t.enqueue(V(c?n:Z.decode(n),o)),h=0}if(0===l||l>r){t.enqueue(w);break}}}})})(Number.MAX_SAFE_INTEGER,this.socket.binaryType);let s=e.readable.pipeThrough(t).getReader();t=Q();t.readable.pipeTo(e.writable),this._writer=t.writable.getWriter();let i=()=>{s.read().then(({done:e,value:t})=>{e||(this.onPacket(t),i())}).catch(e=>{})};i();e={type:"open"};this.query.sid&&(e.data=`{"sid":"${this.query.sid}"}`),this._writer.write(e).then(()=>this.onOpen())})})}write(s){this.writable=!1;for(let t=0;t<s.length;t++){var i=s[t];let e=t===s.length-1;this._writer.write(i).then(()=>{e&&se(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;null!=(e=this._transport)&&e.close()}}let _e={websocket:Te,webtransport:Ee,polling:ye},Ce=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Ie=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function xe(e){if(8e3<e.length)throw"URI too long";var t=e,s=e.indexOf("["),i=e.indexOf("]");-1!=s&&-1!=i&&(e=e.substring(0,s)+e.substring(s,i).replace(/:/g,";")+e.substring(i,e.length));let n=Ce.exec(e||""),r={},o=14;for(;o--;)r[Ie[o]]=n[o]||"";return-1!=s&&-1!=i&&(r.source=t,r.host=r.host.substring(1,r.host.length-1).replace(/;/g,":"),r.authority=r.authority.replace("[","").replace("]","").replace(/;/g,":"),r.ipv6uri=!0),r.pathNames=(e=>{var t=e.replace(/\/{2,9}/g,"/").split("/");return"/"!=e.slice(0,1)&&0!==e.length||t.splice(0,1),"/"==e.slice(-1)&&t.splice(t.length-1,1),t})(r.path),r.queryKey=(e=>{let i={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(e,t,s){t&&(i[t]=s)}),i})(r.query),r}let Oe="function"==typeof addEventListener&&"function"==typeof removeEventListener,Re=[];Oe&&addEventListener("offline",()=>{Re.forEach(e=>e())},!1);class c extends i{constructor(e,t){super(),this.binaryType="arraybuffer",this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&"object"==typeof e&&(t=e,e=null),e?(e=xe(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=xe(t.host).host),oe(this,t),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},t.transports.forEach(e=>{var t=e.prototype.name;this.transports.push(t),this._transportsByName[t]=e}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"==typeof this.opts.query&&(this.opts.query=(e=>{var s={},i=e.split("&");for(let e=0,t=i.length;e<t;e++){var n=i[e].split("=");s[decodeURIComponent(n[0])]=decodeURIComponent(n[1])}return s})(this.opts.query)),Oe&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),"localhost"!==this.hostname)&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},Re.push(this._offlineEventListener)),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){var t=Object.assign({},this.opts.query),t=(t.EIO=4,t.transport=e,this.id&&(t.sid=this.id),Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]));return new this._transportsByName[e](t)}_open(){var e;0===this.transports.length?this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0):(e=this.opts.rememberUpgrade&&c.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket")?"websocket":this.transports[0],this.readyState="opening",(e=this.createTransport(e)).open(),this.setTransport(e))}setTransport(e){this.transport&&this.transport.removeAllListeners(),(this.transport=e).on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",e=>this._onClose("transport close",e))}onOpen(){this.readyState="open",c.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush()}_onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":var t=new Error("server error");t.code=e.data,this._onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);var e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),(this._prevBufferLen=0)===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){var e;"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(e=this._getWritablePackets(),this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush"))}_getWritablePackets(){if(this._maxPayload&&"polling"===this.transport.name&&1<this.writeBuffer.length){let t=1;for(let e=0;e<this.writeBuffer.length;e++){var s=this.writeBuffer[e].data;if(s&&(t+=(e=>{if("string"!=typeof e)return Math.ceil(1.33*(e.byteLength||e.size));{var n=e;let s=0,i=0;for(let e=0,t=n.length;e<t;e++)(s=n.charCodeAt(e))<128?i+=1:s<2048?i+=2:s<55296||57344<=s?i+=3:(e++,i+=4);return i}})(s)),0<e&&t>this._maxPayload)return this.writeBuffer.slice(0,e);t+=2}}return this.writeBuffer}_hasPingExpired(){var e;return!this._pingTimeoutTime||((e=Date.now()>this._pingTimeoutTime)&&(this._pingTimeoutTime=0,se(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e)}write(e,t,s){return this._sendPacket("message",e,t,s),this}send(e,t,s){return this._sendPacket("message",e,t,s),this}_sendPacket(e,t,s,i){"function"==typeof t&&(i=t,t=void 0),"function"==typeof s&&(i=s,s=null),"closing"!==this.readyState&&"closed"!==this.readyState&&((s=s||{}).compress=!1!==s.compress,this.emitReserved("packetCreate",e={type:e,data:t,options:s}),this.writeBuffer.push(e),i&&this.once("flush",i),this.flush())}close(){let e=()=>{this._onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},s=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{(this.upgrading?s:e)()}):(this.upgrading?s:e)()),this}_onError(e){if(c.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&1<this.transports.length&&"opening"===this.readyState)return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,t){var s;"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),Oe&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)&&-1!==(s=Re.indexOf(this._offlineEventListener))&&Re.splice(s,1),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this._prevBufferLen=0)}}c.protocol=4;class Ne extends c{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),"open"===this.readyState&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let t=this.createTransport(e),s=!1,i=(c.priorWebsocketSuccess=!1,()=>{s||(t.send([{type:"ping",data:"probe"}]),t.once("packet",e=>{s||("pong"===e.type&&"probe"===e.data?(this.upgrading=!0,this.emitReserved("upgrading",t),t&&(c.priorWebsocketSuccess="websocket"===t.name,this.transport.pause(()=>{s||"closed"!==this.readyState&&(l(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())}))):((e=new Error("probe error")).transport=t.name,this.emitReserved("upgradeError",e)))}))});function n(){s||(s=!0,l(),t.close(),t=null)}let r=e=>{e=new Error("probe error: "+e);e.transport=t.name,n(),this.emitReserved("upgradeError",e)};function o(){r("transport closed")}function a(){r("socket closed")}function h(e){t&&e.name!==t.name&&n()}let l=()=>{t.removeListener("open",i),t.removeListener("error",r),t.removeListener("close",o),this.off("close",a),this.off("upgrading",h)};t.once("open",i),t.once("error",r),t.once("close",o),this.once("close",a),this.once("upgrading",h),-1!==this._upgrades.indexOf("webtransport")&&"webtransport"!==e?this.setTimeoutFn(()=>{s||t.open()},200):t.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(t){var s=[];for(let e=0;e<t.length;e++)~this.transports.indexOf(t[e])&&s.push(t[e]);return s}}let Ae=class extends Ne{constructor(e,t={}){t="object"==typeof e?e:t;t.transports&&(t.transports,"string"!=typeof t.transports[0])||(t.transports=(t.transports||["polling","websocket","webtransport"]).map(e=>_e[e]).filter(e=>!!e)),super(e,t)}},De="function"==typeof ArrayBuffer,Me=e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer;var r,e=Object.prototype.toString;let Le="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===e.call(Blob),Be="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===e.call(File);function je(e){return De&&(e instanceof ArrayBuffer||Me(e))||Le&&e instanceof Blob||Be&&e instanceof File}function Fe(e){var t=[],s=e.data;return e.data=function s(i,n){if(!i)return i;{if(je(i)){let e={_placeholder:!0,num:n.length};return n.push(i),e}if(Array.isArray(i)){let t=new Array(i.length);for(let e=0;e<i.length;e++)t[e]=s(i[e],n);return t}if("object"==typeof i&&!(i instanceof Date)){let e={};for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&(e[t]=s(i[t],n));return e}}return i}(s,t),e.attachments=t.length,{packet:e,buffers:t}}function Pe(e,t){return e.data=function t(s,i){if(!s)return s;{if(s&&!0===s._placeholder){let e="number"==typeof s.num&&0<=s.num&&s.num<i.length;if(e)return i[s.num];throw new Error("illegal attachments")}if(Array.isArray(s))for(let e=0;e<s.length;e++)s[e]=t(s[e],i);else if("object"==typeof s)for(var e in s)Object.prototype.hasOwnProperty.call(s,e)&&(s[e]=t(s[e],i))}return s}(e.data,t),delete e.attachments,e}let Ue=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"];(e=r=r||{})[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK";class qe{constructor(e){this.replacer=e}encode(e){return e.type!==r.EVENT&&e.type!==r.ACK||!function s(i){if(i&&"object"==typeof i)if(Array.isArray(i)){for(let e=0,t=i.length;e<t;e++)if(s(i[e]))return!0}else{if(je(i))return!0;if(i.toJSON&&"function"==typeof i.toJSON&&1===arguments.length)return s(i.toJSON(),!0);for(var e in i)if(Object.prototype.hasOwnProperty.call(i,e)&&s(i[e]))return!0}return!1}(e)?[this.encodeAsString(e)]:this.encodeAsBinary({type:e.type===r.EVENT?r.BINARY_EVENT:r.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id})}encodeAsString(e){let t=""+e.type;return e.type!==r.BINARY_EVENT&&e.type!==r.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){var e=Fe(e),t=this.encodeAsString(e.packet),e=e.buffers;return e.unshift(t),e}}function He(e){return"[object Object]"===Object.prototype.toString.call(e)}class ze extends i{constructor(e){super(),this.reviver=e}add(e){let t;if("string"==typeof e){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");var s=(t=this.decodeString(e)).type===r.BINARY_EVENT;(!s&&t.type!==r.BINARY_ACK||(t.type=s?r.EVENT:r.ACK,this.reconstructor=new We(t),0===t.attachments))&&super.emitReserved("decoded",t)}else{if(!je(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(t=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,super.emitReserved("decoded",t))}}decodeString(e){let t=0;var s={type:Number(e.charAt(0))};if(void 0===r[s.type])throw new Error("unknown packet type "+s.type);if(s.type===r.BINARY_EVENT||s.type===r.BINARY_ACK){for(var i=t+1;"-"!==e.charAt(++t)&&t!=e.length;);i=e.substring(i,t);if(i!=Number(i)||"-"!==e.charAt(t))throw new Error("Illegal attachments");s.attachments=Number(i)}if("/"===e.charAt(t+1)){for(i=t+1;++t;){if(","===e.charAt(t))break;if(t===e.length)break}s.nsp=e.substring(i,t)}else s.nsp="/";i=e.charAt(t+1);if(""!==i&&Number(i)==i){for(i=t+1;++t;){var n=e.charAt(t);if(null==n||Number(n)!=n){--t;break}if(t===e.length)break}s.id=Number(e.substring(i,t+1))}if(e.charAt(++t)){i=this.tryParse(e.substr(t));if(!ze.isPayloadValid(s.type,i))throw new Error("invalid payload");s.data=i}return s}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(e){return!1}}static isPayloadValid(e,t){switch(e){case r.CONNECT:return He(t);case r.DISCONNECT:return void 0===t;case r.CONNECT_ERROR:return"string"==typeof t||He(t);case r.EVENT:case r.BINARY_EVENT:return Array.isArray(t)&&("number"==typeof t[0]||"string"==typeof t[0]&&-1===Ue.indexOf(t[0]));case r.ACK:case r.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class We{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){return this.buffers.push(e),this.buffers.length===this.reconPack.attachments?(e=Pe(this.reconPack,this.buffers),this.finishedReconstruction(),e):null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}var Ve=Object.freeze({__proto__:null,Decoder:ze,Encoder:qe,get PacketType(){return r},protocol:5});function a(e,t,s){return e.on(t,s),function(){e.off(t,s)}}let $e=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Xe extends i{constructor(e,t,s){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,s&&s.auth&&(this.auth=s.auth),this._opts=Object.assign({},s),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){var e;this.subs||(e=this.io,this.subs=[a(e,"open",this.onopen.bind(this)),a(e,"packet",this.onpacket.bind(this)),a(e,"error",this.onerror.bind(this)),a(e,"close",this.onclose.bind(this))])}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){var s,i;if($e.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');return t.unshift(e),!this._opts.retries||this.flags.fromQueue||this.flags.volatile?(s=((e={type:r.EVENT,data:t,options:{}}).options.compress=!1!==this.flags.compress,"function"==typeof t[t.length-1]&&(i=this.ids++,s=t.pop(),this._registerAckCallback(i,s),e.id=i),null==(i=null==(s=this.io.engine)?void 0:s.transport)?void 0:i.writable),i=this.connected&&!(null!=(i=this.io.engine)&&i._hasPingExpired()),this.flags.volatile&&!s||(i?(this.notifyOutgoingListeners(e),this.packet(e)):this.sendBuffer.push(e)),this.flags={}):this._addToQueue(t),this}_registerAckCallback(s,i){var e=null!=(e=this.flags.timeout)?e:this._opts.ackTimeout;if(void 0===e)this.acks[s]=i;else{let t=this.io.setTimeoutFn(()=>{delete this.acks[s];for(let e=0;e<this.sendBuffer.length;e++)this.sendBuffer[e].id===s&&this.sendBuffer.splice(e,1);i.call(this,new Error("operation has timed out"))},e);e=(...e)=>{this.io.clearTimeoutFn(t),i.apply(this,e)};e.withError=!0,this.acks[s]=e}}emitWithAck(t,...n){return new Promise((s,i)=>{var e=(e,t)=>e?i(e):s(t);e.withError=!0,n.push(e),this.emit(t,...n)})}_addToQueue(e){let s,i=("function"==typeof e[e.length-1]&&(s=e.pop()),{id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)});e.push((e,...t)=>{if(i===this._queue[0])return null!==e?i.tryCount>this._opts.retries&&(this._queue.shift(),s)&&s(e):(this._queue.shift(),s&&s(null,...t)),i.pending=!1,this._drainQueue()}),this._queue.push(i),this._drainQueue()}_drainQueue(e=!1){var t;!this.connected||0===this._queue.length||(t=this._queue[0]).pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){"function"==typeof this.auth?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:r.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(t=>{var e;this.sendBuffer.some(e=>String(e.id)===t)||(e=this.acks[t],delete this.acks[t],e.withError&&e.call(this,new Error("socket has been disconnected")))})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case r.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case r.EVENT:case r.BINARY_EVENT:this.onevent(e);break;case r.ACK:case r.BINARY_ACK:this.onack(e);break;case r.DISCONNECT:this.ondisconnect();break;case r.CONNECT_ERROR:this.destroy();var t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}onevent(e){var t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){var t;if(this._anyListeners&&this._anyListeners.length)for(t of this._anyListeners.slice())t.apply(this,e);super.emit.apply(this,e),this._pid&&e.length&&"string"==typeof e[e.length-1]&&(this._lastOffset=e[e.length-1])}ack(t){let s=this,i=!1;return function(...e){i||(i=!0,s.packet({type:r.ACK,id:t,data:e}))}}onack(e){var t=this.acks[e.id];"function"==typeof t&&(delete this.acks[e.id],t.withError&&e.data.unshift(null),t.apply(this,e.data))}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:r.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(t){if(this._anyListeners)if(t){var s=this._anyListeners;for(let e=0;e<s.length;e++)if(t===s[e])return s.splice(e,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(t){if(this._anyOutgoingListeners)if(t){var s=this._anyOutgoingListeners;for(let e=0;e<s.length;e++)if(t===s[e])return s.splice(e,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){var t;if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length)for(t of this._anyOutgoingListeners.slice())t.apply(this,e.data)}}function Ke(e){this.ms=(e=e||{}).min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=0<e.jitter&&e.jitter<=1?e.jitter:0,this.attempts=0}Ke.prototype.duration=function(){var e,t,s=this.ms*Math.pow(this.factor,this.attempts++);return this.jitter&&(e=Math.random(),t=Math.floor(e*this.jitter*s),s=0==(1&Math.floor(10*e))?s-t:s+t),0|Math.min(s,this.max)},Ke.prototype.reset=function(){this.attempts=0},Ke.prototype.setMin=function(e){this.ms=e},Ke.prototype.setMax=function(e){this.max=e},Ke.prototype.setJitter=function(e){this.jitter=e};class Je extends i{constructor(e,t){super(),this.nsps={},this.subs=[],e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.opts=t,oe(this,t),this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(null!=(s=t.randomizationFactor)?s:.5),this.backoff=new Ke({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this._readyState="closed",this.uri=e;var s=t.parser||Ve;this.encoder=new s.Encoder,this.decoder=new s.Decoder,this._autoConnect=!1!==t.autoConnect,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null!=(t=this.backoff)&&t.setMin(e),this)}randomizationFactor(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null!=(t=this.backoff)&&t.setJitter(e),this)}reconnectionDelayMax(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null!=(t=this.backoff)&&t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(n){if(!~this._readyState.indexOf("open")){this.engine=new Ae(this.uri,this.opts);let t=this.engine,e=this,s=(this._readyState="opening",this.skipReconnect=!1,a(t,"open",function(){e.onopen(),n&&n()})),i=e=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",e),n?n(e):this.maybeReconnectOnOpen()};var r=a(t,"error",i);if(!1!==this._timeout){var o=this._timeout;let e=this.setTimeoutFn(()=>{s(),i(new Error("timeout")),t.close()},o);this.opts.autoUnref&&e.unref(),this.subs.push(()=>{this.clearTimeoutFn(e)})}this.subs.push(s),this.subs.push(r)}return this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");var e=this.engine;this.subs.push(a(e,"ping",this.onping.bind(this)),a(e,"data",this.ondata.bind(this)),a(e,"error",this.onerror.bind(this)),a(e,"close",this.onclose.bind(this)),a(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(e){this.onclose("parse error",e)}}ondecoded(e){se(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let s=this.nsps[e];return s?this._autoConnect&&!s.active&&s.connect():(s=new Xe(this,e,t),this.nsps[e]=s),s}_destroy(e){var t;for(t of Object.keys(this.nsps)){let e=this.nsps[t];if(e.active)return}this._close()}_packet(t){var s=this.encoder.encode(t);for(let e=0;e<s.length;e++)this.engine.write(s[e],t.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,t){var s;this.cleanup(),null!=(s=this.engine)&&s.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;let t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{var s=this.backoff.duration();this._reconnecting=!0;let e=this.setTimeoutFn(()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),t.skipReconnect)||t.open(e=>{e?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",e)):t.onreconnect()})},s);this.opts.autoUnref&&e.unref(),this.subs.push(()=>{this.clearTimeoutFn(e)})}}onreconnect(){var e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}let Ge={};function Ye(e,t){"object"==typeof e&&(t=e,e=void 0);var e=((e,t,s)=>{let i=e;return s=s||"undefined"!=typeof location&&location,"string"==typeof(e=null==e?s.protocol+"//"+s.host:e)&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?s.protocol+e:s.host+e),/^(https?|wss?):\/\//.test(e)||(e=void 0!==s?s.protocol+"//"+e:"https://"+e),i=xe(e)),i.port||(/^(http|ws)$/.test(i.protocol)?i.port="80":/^(http|ws)s$/.test(i.protocol)&&(i.port="443")),i.path=i.path||"/",e=-1!==i.host.indexOf(":")?"["+i.host+"]":i.host,i.id=i.protocol+"://"+e+":"+i.port+t,i.href=i.protocol+"://"+e+(s&&s.port===i.port?"":":"+i.port),i})(e,(t=t||{}).path||"/socket.io"),s=e.source,i=e.id,n=e.path,n=Ge[i]&&n in Ge[i].nsps,n=t.forceNew||t["force new connection"]||!1===t.multiplex||n;let r;return r=n?new Je(s,t):(Ge[i]||(Ge[i]=new Je(s,t)),Ge[i]),e.query&&!t.query&&(t.query=e.queryKey),r.socket(e.path,t)}Object.assign(Ye,{Manager:Je,Socket:Xe,io:Ye,connect:Ye});class Qe{constructor(e,t,s){this.mediaRequested=!1,this.onVideoTrackCb=null,this.stream=e,this.pc=t,this.toggleVideoCb=s}toggleVideo(){var e=this.stream.getVideoTracks();return this.mediaRequested?(e.forEach(e=>{e.enabled=!e.enabled}),Promise.resolve(e[0].enabled)):navigator.mediaDevices.getUserMedia({video:!0}).then(e=>{e=e.getVideoTracks()[0];if(e)return this.pc.addTrack(e,this.stream),this.stream.addTrack(e),this.toggleVideoCb&&this.toggleVideoCb(),this.mediaRequested=!0,this.onVideoTrackCb&&this.onVideoTrackCb(e),!0;throw new Error("No video track provided")}).catch(e=>!1)}toggleAudio(){let t=!0;return this.stream.getAudioTracks().forEach(e=>{e.enabled=t=t&&!e.enabled}),t}onVideoTrack(e){this.onVideoTrackCb=e}stop(){this.stream.getTracks().forEach(e=>e.stop())}}let Ze="https://docs.openreplay.com",et={};function tt(e,t){var s="data-openreplay-"+t;return e.hasAttribute(s)&&(DEPRECATED_ATTRS[t]&&(e=`"${s}" attribute`,s=`"${DEPRECATED_ATTRS[t]}" attribute`,t="/en/sdk/sanitize-data",et[e]||(console.warn(`OpenReplay: ${e} is deprecated. ${s?`Please, use ${s} instead.`:""} Visit ${Ze}${t} for more information.`),et[e]=!0)),1)}let st=class{constructor(e,t){this.agentName=e,this.onDragCamera=t,this.position=[0,0],this.isDragging=!1,this.pScrEl=document.scrollingElement||document.documentElement,this.lastScrEl=null,this.resetLastScrEl=()=>{this.lastScrEl=null},this.handleWScroll=e=>{e.target!==this.lastScrEl&&"window"!==this.lastScrEl&&this.resetLastScrEl()},this.mouse=document.createElement("div");e=document.createElement("div"),this.mouse.innerHTML='<svg version="1.1" width="20" height="20" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" xml:space="" viewBox="8.2 4.9 11.6 18.2"><polygon fill="#FFFFFF" points="8.2,20.9 8.2,4.9 19.8,16.5 13,16.5 12.6,16.6 "></polygon><polygon fill="#FFFFFF" points="17.3,21.6 13.7,23.1 9,12 12.7,10.5 "></polygon><rect x="12.5" y="13.6" transform="matrix(0.9221 -0.3871 0.3871 0.9221 -5.7605 6.5909)" width="2" height="8"></rect><polygon points="9.2,7.3 9.2,18.5 12.2,15.6 12.6,15.5 17.4,15.5 "></polygon></svg>',this.mouse.setAttribute("data-openreplay-hidden",""),Object.assign(e.style,{position:"absolute",padding:"4px 5px",borderRadius:"4px",backgroundColor:"#394EFF",color:"white",bottom:"-20px",left:"65%",fontSize:"12px",whiteSpace:"nowrap"}),this.onDragCamera=t,t=this.agentName?10<this.agentName.length?this.agentName.slice(0,9)+"...":this.agentName:"Agent";e.innerHTML=`<span>${t}</span>`,this.mouse.appendChild(e),Object.assign(this.mouse.style,{position:"absolute",zIndex:"999998",pointerEvents:"none",marginTop:"-1px",marginLeft:"-2px"})}mount(){document.body.appendChild(this.mouse),window.addEventListener("scroll",this.handleWScroll),window.addEventListener("resize",this.resetLastScrEl)}move(e){this.position[0]===e[0]&&this.position[1]===e[1]||this.resetLastScrEl(),this.position=e,Object.assign(this.mouse.style,{left:`${e[0]||0}px`,top:`${e[1]||0}px`})}getPosition(){return this.position}click(e){var t=document.elementFromPoint(e[0],e[1]);if(t instanceof HTMLElement||t instanceof SVGElement){try{var s=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window,clientX:e[0],clientY:e[1]});t.dispatchEvent(s)}catch(e){console.error(e),t.click&&t.click()}return t.focus(),t}return null}startDrag(e){this.move(e);var t=document.elementFromPoint(e[0],e[1]);t&&(e=new MouseEvent("mousedown",{bubbles:!0,cancelable:!0,clientX:e[0],clientY:e[1],buttons:1}),t.dispatchEvent(e),this.isDragging=!0)}drag(e){var t,[e,s,i,n]=e;this.move([e,s]),this.isDragging&&(t=document.elementFromPoint(e,s))&&(e=new MouseEvent("mousemove",{bubbles:!0,cancelable:!0,clientX:e,clientY:s,buttons:1}),t.dispatchEvent(e),tt(t,"draggable"))&&this.onDragCamera&&this.onDragCamera(i,n)}stopDrag(){var e,t,s;this.isDragging&&([s,e]=this.position,(t=document.elementFromPoint(s,e))&&(s=new MouseEvent("mouseup",{bubbles:!0,cancelable:!0,clientX:s,clientY:e,buttons:0}),t.dispatchEvent(s)),this.isDragging=!1)}scroll(e){var[t,s]=this.position,[i,n]=e;let r=this.lastScrEl;if(r instanceof Element)r.scrollLeft+=i,r.scrollTop+=n;else if("window"===r)window.scroll(this.pScrEl.scrollLeft+i,this.pScrEl.scrollTop+n);else{for(r=document.elementFromPoint(t-this.pScrEl.scrollLeft,s-this.pScrEl.scrollTop);r;){if(r.scrollHeight>r.clientHeight||r.scrollWidth>r.clientWidth){var o=getComputedStyle(r);if(0<=o.overflow.indexOf("scroll")||0<=o.overflow.indexOf("auto")){var o=r.scrollLeft,a=r.scrollTop;if(r.scrollLeft+=i,r.scrollTop+=n,o!==r.scrollLeft||a!==r.scrollTop)return void(this.lastScrEl=r)}}r=r.parentElement}window.scroll(this.pScrEl.scrollLeft+i,this.pScrEl.scrollTop+n),this.lastScrEl="window"}}remove(){this.mouse.parentElement&&document.body.removeChild(this.mouse),window.removeEventListener("scroll",this.handleWScroll),window.removeEventListener("resize",this.resetLastScrEl)}};function it(e,t){var s;return e instanceof HTMLButtonElement?e:(s=document.createElement("button"),Object.assign(s.style,{padding:"10px 14px",fontSize:"14px",borderRadius:"3px",border:"none",cursor:"pointer",display:"flex",alignItems:"center",textTransform:"uppercase",marginRight:"10px"},t),"string"==typeof e?s.innerHTML=e:(s.innerHTML=e.innerHTML,Object.assign(s.style,e.style)),s)}class nt{constructor(e){this.resolve=()=>{},this.reject=()=>{};var t=document.createElement("div"),s=document.createElement("div"),i=document.createElement("p"),n=(t.id="openreplay-confirm-window-wrapper",s.id="openreplay-confirm-window-popup",i.id="openreplay-confirm-window-p",i.innerText=e.text,document.createElement("div")),r=(n.id="openreplay-confirm-window-buttons",it(e.confirmBtn,{background:"rgba(0, 167, 47, 1)",color:"white"})),o=(r.id="openreplay-confirm-window-confirm-btn",it(e.declineBtn,{background:"#FFE9E9",color:"#CC0000"}));o.id="openreplay-confirm-window-decline-btn",n.appendChild(r),n.appendChild(o),s.appendChild(i),s.appendChild(n),Object.assign(n.style,{marginTop:"10px",display:"flex",alignItems:"center",backgroundColor:"white",padding:"10px",boxShadow:"0px 0px 3.99778px 1.99889px rgba(0, 0, 0, 0.1)",borderRadius:"6px"}),Object.assign(s.style,{font:"14px 'Roboto', sans-serif",position:"relative",pointerEvents:"auto",margin:"4em auto",width:"90%",maxWidth:"fit-content",padding:"20px",background:"#F3F3F3",color:"black",borderRadius:"3px",boxShadow:"0px 0px 3.99778px 1.99889px rgba(0, 0, 0, 0.1)"},e.style),Object.assign(t.style,{position:"fixed",left:0,top:0,height:"100%",width:"100%",pointerEvents:"none",zIndex:2147483646}),t.appendChild(s),t.setAttribute("data-openreplay-hidden",""),this.wrapper=t,r.onclick=()=>{this.resolve(!0)},o.onclick=()=>{this.resolve(!1)}}mount(){return document.body.appendChild(this.wrapper),new Promise((e,t)=>{this.resolve=e,this.reject=t})}_remove(){this.wrapper.parentElement&&this.wrapper.parentElement.removeChild(this.wrapper)}remove(){this._remove(),this.reject("no answer")}}var I,rt,e=`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-telephone" viewBox="0 0 16 16">
<path d="M3.654 1.328a.678.678 0 0 0-1.015-.063L1.605 2.3c-.483.484-.661 1.169-.45 1.77a17.568 17.568 0 0 0 4.168 6.608 17.569 17.569 0 0 0 6.608 4.168c.601.211 1.286.033 1.77-.45l1.034-1.034a.678.678 0 0 0-.063-1.015l-2.307-1.794a.678.678 0 0 0-.58-.122l-2.19.547a1.745 1.745 0 0 1-1.657-.459L5.482 8.062a1.745 1.745 0 0 1-.46-1.657l.548-2.19a.678.678 0 0 0-.122-.58L3.654 1.328zM1.884.511a1.745 1.745 0 0 1 2.612.163L6.29 2.98c.329.423.445.974.315 1.494l-.547 2.19a.678.678 0 0 0 .178.643l2.457 2.457a.678.678 0 0 0 .644.178l2.189-.547a1.745 1.745 0 0 1 1.494.315l2.306 1.794c.829.645.905 1.87.163 2.611l-1.034 1.034c-.74.74-1.846 1.065-2.877.702a18.634 18.634 0 0 1-7.01-4.42 18.634 18.634 0 0 1-4.42-7.009c-.362-1.03-.037-2.137.703-2.877L1.885.511z"/>
</svg>`.replace('fill="#ef5261"','fill="green"');let ot="Reject",at=e+" &#xa0 Answer";function ht(e,t,s,i){var n="string"==typeof e;return Object.assign({text:n?e:i,confirmBtn:t,declineBtn:s},n?void 0:e)}(e=I=I||{})[e.Disabled=0]="Disabled",e[e.Requesting=1]="Requesting",e[e.Enabled=2]="Enabled";let lt=function(e){this.value=e};(e="undefined"!=typeof window&&Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"value"))&&e.set&&(lt=e.set);class ct{constructor(e,t,s,i){this.options=e,this.onGrand=t,this.onRelease=s,this.onBusy=i,this.mouse=null,this.status=I.Disabled,this.agentID=null,this.confirm=null,this.requestControl=t=>{if(this.status===I.Enabled)return this.onBusy(t);null!==this.agentID?this.releaseControl():(setTimeout(()=>{this.status===I.Requesting&&this.releaseControl()},3e4),this.agentID=t,this.status=I.Requesting,this.confirm=new nt(ht(this.options.controlConfirm,"Grant Remote Control",ot,"Agent requested remote control. Allow?")),this.confirm.mount().then(e=>{e?this.grantControl(t):(null!=(e=this.confirm)&&e.remove(),this.releaseControl(!0))}).then(()=>{var e;null!=(e=this.confirm)&&e.remove()}).catch(e=>{var t;null!=(t=this.confirm)&&t.remove(),console.error(e)}))},this.releaseControl=(e,t)=>{this.confirm&&(this.confirm.remove(),this.confirm=null),this.resetMouse(),this.status=I.Disabled,t||sessionStorage.removeItem(this.options.session_control_peer_key),this.onRelease(this.agentID,e),this.agentID=null},this.grantControl=e=>{this.agentID=e,this.status=I.Enabled,sessionStorage.setItem(this.options.session_control_peer_key,e);var t=this.onGrand(e);this.mouse&&this.resetMouse(),this.mouse=new st(t,this.options.onDragCamera),this.mouse.mount(),document.addEventListener("visibilitychange",()=>{document.hidden?this.releaseControl(!1,!0):this.status===I.Disabled&&this.reconnect([e])})},this.resetMouse=()=>{var e;null!=(e=this.mouse)&&e.remove(),this.mouse=null},this.scroll=(e,t)=>{e===this.agentID&&null!=(e=this.mouse)&&e.scroll(t)},this.move=(e,t)=>e===this.agentID&&(null==(e=this.mouse)?void 0:e.move(t)),this.focused=null,this.click=(e,t)=>{e===this.agentID&&this.mouse&&(this.focused=this.mouse.click(t))},this.focus=(e,t)=>{this.focused=t},this.startDrag=(e,t)=>{var s;null!=(s=this.mouse)&&s.startDrag(t)},this.drag=(e,t)=>{var s;null!=(s=this.mouse)&&s.drag(t)},this.stopDrag=e=>{var t;null!=(t=this.mouse)&&t.stopDrag()},this.input=(e,t)=>{e===this.agentID&&this.mouse&&this.focused&&(this.focused instanceof HTMLTextAreaElement||this.focused instanceof HTMLInputElement||"INPUT"===this.focused.tagName||"TEXTAREA"===this.focused.tagName?(lt.call(this.focused,t),e=new Event("input",{bubbles:!0}),this.focused.dispatchEvent(e)):this.focused.isContentEditable&&(this.focused.innerText=t))}}reconnect(e){var t=sessionStorage.getItem(this.options.session_control_peer_key);null!==t&&-1!==e.indexOf(t)?this.grantControl(t):sessionStorage.removeItem(this.options.session_control_peer_key)}}function dt(t,e,s){e.addEventListener("pointerdown",function(e){n=e.clientX,r=e.clientY,i=t.getBoundingClientRect(),s.addEventListener("pointermove",l,{passive:!0}),s.addEventListener("pointerup",d,{passive:!0}),s.addEventListener("pointercancel",d,{passive:!0})},{passive:!0});let i,n,r,o,a=0,h=0;function l(e){o||(a+=e.clientX-n,h+=e.clientY-r,a=Math.min(Math.max(a,-i.left),window.innerWidth-i.right),h=Math.min(Math.max(h,-i.top),window.innerHeight-i.bottom),o=requestAnimationFrame(c))}function c(){t.style.transform="translate3d("+a+"px,"+h+"px, 0px)",o=null}function d(){s.removeEventListener("pointermove",l),s.removeEventListener("pointerup",d),s.removeEventListener("pointercancel",d),o&&(cancelAnimationFrame(o),o=null),t.style.left=i.left+a+"px",t.style.top=i.top+h+"px",t.style.transform="translate3d(0px,0px,0px)",a=h=0}}let ut="__openreplay_assist_call_start_ts";class pt{constructor(e,t){this.logError=e,this.callUITemplate=t,this.vRemote=null,this.vLocal=null,this.audioBtn=null,this.videoBtn=null,this.endCallBtn=null,this.agentNameElem=null,this.remoteStreamVideoContainerSample=null,this.videoContainer=null,this.vPlaceholder=null,this.remoteControlContainer=null,this.remoteControlEndBtn=null,this.controlsContainer=null,this.audioContainer=null,this.localStreams=[];let s=this.iframe=document.createElement("iframe"),n=(Object.assign(s.style,{position:"fixed",zIndex:2147483646,border:"none",bottom:"50px",right:"10px",height:"200px",width:"200px"}),s.setAttribute("data-openreplay-obscured",""),s.setAttribute("data-openreplay-hidden",""),s.setAttribute("data-openreplay-ignore",""),document.body.appendChild(s),s.contentDocument);if(n){let t="https://static.openreplay.com/tracker-assist/widget";this.load=fetch(this.callUITemplate||t+"/index.html").then(e=>e.text()).then(e=>{s.onload=()=>{let e=n.getElementById("or-assist");setTimeout(()=>{null!=e&&e.classList.remove("status-connecting")},0),this.adjustIframeSize(),s.onload=null},e=e.replace(/href="css/g,`href="${t}/css`),n.open(),n.write(e),n.close(),this.vLocal=n.getElementById("video-local"),this.vRemote=n.getElementById("video-remote"),this.videoContainer=n.getElementById("video-container"),this.audioBtn=n.getElementById("audio-btn"),this.audioBtn&&(this.audioBtn.onclick=()=>this.toggleAudio()),this.videoBtn=n.getElementById("video-btn"),this.videoBtn&&(this.videoBtn.onclick=()=>this.toggleVideo()),this.endCallBtn=n.getElementById("end-call-btn"),this.agentNameElem=n.getElementById("agent-name"),this.vPlaceholder=n.querySelector("#remote-stream p"),this.remoteControlContainer=n.getElementById("remote-control-row"),this.remoteControlEndBtn=n.getElementById("end-control-btn"),this.controlsContainer=n.getElementById("controls"),this.controlsContainer&&(this.controlsContainer.style.display="none");let i=n.getElementById("duration");if(i){let s=Number(sessionStorage.getItem(ut))||Date.now();sessionStorage.setItem(ut,s.toString()),this.tsInterval=setInterval(()=>{var e=~~((Date.now()-s)/1e3),t=~~(e/60),e=e-60*t;i.innerText=(0<t?t+"m":"")+(e<10?0:"")+e+"s"},500)}e=n.querySelector(".drag-area");e&&dt(s,e,n.documentElement),setTimeout(()=>{var e=n.getElementById("or-assist");null!=e&&e.classList.remove("status-connecting"),this.adjustIframeSize()},250)})}else e("OpenReplay: CallWindow iframe document is not reachable.")}adjustIframeSize(){var e=this.iframe.contentDocument;e&&(this.iframe.style.height=e.body.scrollHeight+"px",this.iframe.style.width=e.body.scrollWidth+"px")}addRemoteStream(t,s){this.load.then(()=>{this.vRemote&&!this.vRemote.srcObject&&(this.vRemote.srcObject=t,this.remoteVideo=t.getVideoTracks()[0],this.remoteVideoId=s,this.vPlaceholder&&(this.vPlaceholder.innerText="Video has been paused. Click anywhere to resume."),this.checkRemoteVideoInterval)&&clearInterval(this.checkRemoteVideoInterval),this.audioContainer||(this.audioContainer=document.createElement("div"),document.body.appendChild(this.audioContainer));var e=document.createElement("audio");e.autoplay=!0,e.style.display="none",e.srcObject=t,this.audioContainer.appendChild(e)}).catch(e=>this.logError(e))}toggleRemoteVideoUI(e){this.load.then(()=>{this.videoContainer&&(e?this.videoContainer.classList.add("remote"):this.videoContainer.classList.remove("remote"),this.adjustIframeSize())}).catch(e=>this.logError(e))}setLocalStreams(e){this.localStreams=e}playRemote(){this.vRemote&&this.vRemote.play()}setAssistentName(t){this.load.then(()=>{var e;this.agentNameElem&&(e=20<(e=Array.from(t.values()).join(", ")).length?e.substring(0,20)+"...":e,this.agentNameElem.innerText=e)}).catch(e=>this.logError(e))}toggleAudioUI(e){this.audioBtn&&(e?this.audioBtn.classList.remove("muted"):this.audioBtn.classList.add("muted"))}toggleAudio(){let t=!1;this.localStreams.forEach(e=>{t=e.toggleAudio()||!1}),this.toggleAudioUI(t)}toggleVideoUI(e){this.videoBtn&&this.videoContainer&&(e?(this.videoContainer.classList.add("local"),this.videoBtn.classList.remove("off")):(this.videoContainer.classList.remove("local"),this.videoBtn.classList.add("off")),this.adjustIframeSize())}toggleVideo(){this.localStreams.forEach(s=>{s.toggleVideo().then(e=>{var t;null!=(t=this.onToggleVideo)&&t.call(this,{streamId:s.stream.id,enabled:e}),this.toggleVideoUI(e),this.load.then(()=>{this.vLocal&&s&&!this.vLocal.srcObject&&(this.vLocal.srcObject=s.stream)}).catch(e=>this.logError(e))}).catch(e=>this.logError(e))})}showRemoteControl(e){this.load.then(()=>{this.remoteControlContainer&&(this.remoteControlContainer.style.display="flex"),this.remoteControlEndBtn&&(this.remoteControlEndBtn.onclick=e),this.adjustIframeSize()}).catch(e=>this.logError(e))}showControls(e){this.load.then(()=>{this.controlsContainer&&(this.controlsContainer.style.display="unset"),this.endCallBtn&&(this.endCallBtn.onclick=e),this.adjustIframeSize()}).catch(e=>this.logError(e))}hideControls(){this.controlsContainer&&(this.controlsContainer.style.display="none"),this.adjustIframeSize()}hideRemoteControl(){this.remoteControlContainer&&(this.remoteControlContainer.style.display="none"),this.adjustIframeSize()}setVideoToggleCallback(e){this.onToggleVideo=e}remove(){clearInterval(this.tsInterval),clearInterval(this.checkRemoteVideoInterval),this.audioContainer&&this.audioContainer.parentElement&&(this.audioContainer.parentElement.removeChild(this.audioContainer),this.audioContainer=null),this.iframe.parentElement&&this.iframe.parentElement.removeChild(this.iframe),sessionStorage.removeItem(ut),this.localStreams=[]}toggleVideoStream({streamId:e,enabled:t}){this.remoteVideoId===e&&(this.remoteVideo.enabled=t,this.toggleRemoteVideoUI(t))}}class ft{constructor(){this.ctx=null,this.painting=!1,this.resizeCanvas=()=>{this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight},this.lastPosition=[0,0],this.start=e=>{this.painting=!0,this.clrTmID&&clearTimeout(this.clrTmID),this.lastPosition=e},this.stop=()=>{this.painting&&(this.painting=!1,this.fadeOut())},this.move=e=>{this.ctx&&this.painting&&(this.ctx.globalAlpha=1,this.ctx.beginPath(),this.ctx.moveTo(this.lastPosition[0],this.lastPosition[1]),this.ctx.lineTo(e[0],e[1]),this.ctx.lineWidth=8,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.strokeStyle="red",this.ctx.stroke(),this.lastPosition=e)},this.clrTmID=null,this.canvas=document.createElement("canvas"),this.canvas.setAttribute("data-openreplay-hidden","1"),Object.assign(this.canvas.style,{position:"fixed",left:0,top:0,pointerEvents:"none",zIndex:2147483645})}fadeOut(){let e,t=()=>{this.ctx&&!this.painting&&(this.ctx.globalCompositeOperation="destination-out",this.ctx.fillStyle="rgba(255, 255, 255, 0.1)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.globalCompositeOperation="source-over",e=setTimeout(t,100))};this.clrTmID=setTimeout(()=>{clearTimeout(e),this.ctx&&this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)},4e3),t()}mount(){document.body.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d"),window.addEventListener("resize",this.resizeCanvas),this.resizeCanvas()}remove(){this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),window.removeEventListener("resize",this.resizeCanvas)}}(e=rt=rt||{})[e.Off=0]="Off",e[e.Requested=1]="Requested",e[e.Recording=2]="Recording";let gt={height:"100vh",width:"100vw",border:"2px dashed red",left:0,top:0,position:"fixed",pointerEvents:"none"};class mt{constructor(e){this.confirmOptions=e,this.status=rt.Off,this.overlayAdded=!1,this.confirm=null,this.requestRecording=(t,s,i)=>{this.isActive||(this.status=rt.Requested,this.confirm=new nt(ht(this.confirmOptions,"Allow Recording",ot,"Agent requested to record activity in this browser tab.")),this.confirm.mount().then(e=>{e?(this.acceptRecording(),s(),this.recordingAgent=t):(this.rejectRecording(),i())}).then(()=>{var e;null!=(e=this.confirm)&&e.remove()}).catch(e=>{var t;null!=(t=this.confirm)&&t.remove(),console.error(e)}))},this.acceptRecording=()=>{var e;this.overlayAdded||(e=window.document.createElement("div"),Object.assign(e.style,gt),e.className="or-recording-border",e.setAttribute("data-openreplay-obscured",""),e.setAttribute("data-openreplay-hidden",""),e.setAttribute("data-openreplay-ignore",""),window.document.body.appendChild(e),this.overlayAdded=!0,this.uiComponents=[e]),this.status=rt.Recording},this.stopAgentRecording=e=>{e===this.recordingAgent&&this.rejectRecording()},this.stopRecording=()=>{this.rejectRecording()},this.rejectRecording=()=>{var e;null!=(e=this.confirm)&&e.remove(),this.status=rt.Off,this.overlayAdded=!1,null!=(e=this.uiComponents)&&e.forEach(e=>{var t;return null==(t=e.parentElement)?void 0:t.removeChild(e)})}}get isActive(){return this.status!==rt.Off}}let vt=class{constructor(e,t,s,i,n){this.canvas=e,this.canvasId=t,this.fps=s,this.onStream=i,this.logError=n;e=this.canvas.captureStream(this.fps);this.emitStream(e)}restart(){var e=this.canvas.captureStream(this.fps);this.stream=e,this.emitStream(e)}toggleLocal(e){var t=document.getElementById("canvas-or-testing"),t=(t&&document.body.removeChild(t),document.createElement("video"));t.width=520,t.height=400,t.id="canvas-or-testing",t.setAttribute("autoplay","true"),t.setAttribute("muted","true"),t.setAttribute("playsinline","true"),t.crossOrigin="anonymous",document.body.appendChild(t),t.srcObject=e,t.play(),t.addEventListener("error",e=>{this.logError("Video error:",e)})}emitStream(e){if(e)return this.onStream(e);this.stream?this.onStream(this.stream):this.logError("no stream for canvas",this.canvasId)}stop(){var e;null!=(e=this.stream)&&e.getTracks().forEach(e=>e.stop()),this.stream=null}};function yt(e,t){for(var s=new X(31),i=0;i<31;++i)s[i]=t+=1<<e[i-1];for(var n=new St(s[30]),i=1;i<30;++i)for(var r=s[i];r<s[i+1];++r)n[r]=r-s[i]<<5|i;return{b:s,r:n}}var bt={},wt=function(e,t,s,i,n){t=new Worker(bt[t]||(bt[t]=URL.createObjectURL(new Blob([e+';addEventListener("error",function(e){e=e.error;postMessage({$e$:[e.message,e.code,e.stack]})})'],{type:"text/javascript"}))));return t.onmessage=function(e){var t,e=e.data,s=e.$e$;s?((t=new Error(s[0])).code=s[1],t.stack=s[2],n(t,null)):n(null,e)},t.postMessage(s,i),t},$=Uint8Array,X=Uint16Array,St=Int32Array,kt=new $([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Tt=new $([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Et=new $([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),t=(e=yt(kt,2)).b,_t=e.r;t[28]=258,_t[258]=28;for(var Ct=yt(Tt,0).r,It=new X(32768),o=0;o<32768;++o){var xt=(43690&o)>>1|(21845&o)<<1;It[o]=((65280&(xt=(61680&(xt=(52428&xt)>>2|(13107&xt)<<2))>>4|(3855&xt)<<4))>>8|(255&xt)<<8)>>1}for(var Ot=function(e,t,s){for(var i=e.length,n=0,r=new X(t);n<i;++n)e[n]&&++r[e[n]-1];var o=new X(t);for(n=1;n<t;++n)o[n]=o[n-1]+r[n-1]<<1;if(s){for(var a=new X(1<<t),h=15-t,n=0;n<i;++n)if(e[n])for(var l=n<<4|e[n],c=t-e[n],d=o[e[n]-1]++<<c,u=d|(1<<c)-1;d<=u;++d)a[It[d]>>h]=l}else for(a=new X(i),n=0;n<i;++n)e[n]&&(a[n]=It[o[e[n]-1]++]>>15-e[n]);return a},B=new $(288),o=0;o<144;++o)B[o]=8;for(o=144;o<256;++o)B[o]=9;for(o=256;o<280;++o)B[o]=7;for(o=280;o<288;++o)B[o]=8;for(var Rt=new $(32),o=0;o<32;++o)Rt[o]=5;function Nt(){return[$,X,St,kt,Tt,Et,_t,Ct,Dt,B,Mt,Rt,It,$t,Xt,Ot,j,Pt,Ut,qt,Ht,zt,Wt,Vt,Lt,Bt,Kt,Yt,as,is]}function At(){return[rs,os,ns,Gt,Jt]}var Dt=Ot(B,9,0),Mt=Ot(Rt,5,0),Lt=function(e){return(e+7)/8|0},Bt=function(e,t,s){return(null==s||s>e.length)&&(s=e.length),new $(e.subarray(t=null==t||t<0?0:t,s))},jt=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Ft=function(e,t,s){t=new Error(t||jt[e]);if(t.code=e,Error.captureStackTrace&&Error.captureStackTrace(t,Ft),s)return t;throw t},j=function(e,t,s){var i=t/8|0;e[i]|=s<<=7&t,e[1+i]|=s>>8},Pt=function(e,t,s){var i=t/8|0;e[i]|=s<<=7&t,e[1+i]|=s>>8,e[2+i]|=s>>16},Ut=function(e,t){for(var s=[],i=0;i<e.length;++i)e[i]&&s.push({s:i,f:e[i]});var n=s.length,r=s.slice();if(!n)return{t:Xt,l:0};if(1==n)return(g=new $(s[0].s+1))[s[0].s]=1,{t:g,l:1};s.sort(function(e,t){return e.f-t.f}),s.push({s:-1,f:25001});var o=s[0],a=s[1],h=0,l=1,c=2;for(s[0]={s:-1,f:o.f+a.f,l:o,r:a};l!=n-1;)o=s[s[h].f<s[c].f?h++:c++],a=s[h!=l&&s[h].f<s[c].f?h++:c++],s[l++]={s:-1,f:o.f+a.f,l:o,r:a};for(var d=r[0].s,i=1;i<n;++i)r[i].s>d&&(d=r[i].s);var u=new X(d+1),p=qt(s[l-1],u,0);if(t<p){var i=0,f=0,g=p-t,m=1<<g;for(r.sort(function(e,t){return u[t.s]-u[e.s]||e.f-t.f});i<n;++i){var v=r[i].s;if(!(u[v]>t))break;f+=m-(1<<p-u[v]),u[v]=t}for(f>>=g;0<f;){var y=r[i].s;u[y]<t?f-=1<<t-u[y]++-1:++i}for(;0<=i&&f;--i){var b=r[i].s;u[b]==t&&(--u[b],++f)}p=t}return{t:new $(u),l:p}},qt=function(e,t,s){return-1==e.s?Math.max(qt(e.l,t,s+1),qt(e.r,t,s+1)):t[e.s]=s},Ht=function(e){for(var t=e.length;t&&!e[--t];);for(var s=new X(++t),i=0,n=e[0],r=1,o=function(e){s[i++]=e},a=1;a<=t;++a)if(e[a]==n&&a!=t)++r;else{if(!n&&2<r){for(;138<r;r-=138)o(32754);2<r&&(o(10<r?r-11<<5|28690:r-3<<5|12305),r=0)}else if(3<r){for(o(n),--r;6<r;r-=6)o(8304);2<r&&(o(r-3<<5|8208),r=0)}for(;r--;)o(n);r=1,n=e[a]}return{c:s.subarray(0,i),n:t}},zt=function(e,t){for(var s=0,i=0;i<t.length;++i)s+=e[i]*t[i];return s},Wt=function(e,t,s){var i=s.length,n=Lt(t+2);e[n]=255&i,e[n+1]=i>>8,e[n+2]=255^e[n],e[n+3]=255^e[n+1];for(var r=0;r<i;++r)e[n+r+4]=s[r];return 8*(n+4+i)},Vt=function(e,t,s,i,n,r,o,a,h,l,c){j(t,c++,s),++n[256];for(var s=Ut(n,15),d=s.t,s=s.l,u=Ut(r,15),p=u.t,u=u.l,f=Ht(d),g=f.c,f=f.n,m=Ht(p),v=m.c,m=m.n,y=new X(19),b=0;b<g.length;++b)++y[31&g[b]];for(b=0;b<v.length;++b)++y[31&v[b]];for(var w=Ut(y,7),S=w.t,w=w.l,k=19;4<k&&!S[Et[k-1]];--k);var T=l+5<<3,E=zt(n,B)+zt(r,Rt)+o,n=zt(n,d)+zt(r,p)+o+14+3*k+zt(y,S)+2*y[16]+3*y[17]+7*y[18];if(0<=h&&T<=E&&T<=n)return Wt(t,c,e.subarray(h,h+l));if(j(t,c,1+(n<E)),c+=2,n<E){var _=Ot(d,s,0),C=d,I=Ot(p,u,0),x=p,O=Ot(S,w,0);j(t,c,f-257),j(t,c+5,m-1),j(t,c+10,k-4),c+=14;for(b=0;b<k;++b)j(t,c+3*b,S[Et[b]]);c+=3*k;for(var R=[g,v],N=0;N<2;++N)for(var A=R[N],b=0;b<A.length;++b){var D=31&A[b];j(t,c,O[D]),c+=S[D],15<D&&(j(t,c,A[b]>>5&127),c+=A[b]>>12)}}else _=Dt,C=B,I=Mt,x=Rt;for(b=0;b<a;++b){var M,L=i[b];255<L?(Pt(t,c,_[(D=L>>18&31)+257]),c+=C[D+257],7<D&&(j(t,c,L>>23&31),c+=kt[D]),Pt(t,c,I[M=31&L]),c+=x[M],3<M&&(Pt(t,c,L>>5&8191),c+=Tt[M])):(Pt(t,c,_[L]),c+=C[L])}return Pt(t,c,_[256]),c+C[256]},$t=new St([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Xt=new $(0),Kt=function(t,e,s,i,n,r){var o=r.z||t.length,a=new $(i+o+5*(1+Math.ceil(o/7e3))+n),h=a.subarray(i,a.length-n),l=r.l,c=7&(r.r||0);if(e){c&&(h[0]=r.r>>3);for(var e=$t[e-1],B=e>>13,j=8191&e,d=(1<<s)-1,u=r.p||new X(32768),p=r.h||new X(1+d),f=Math.ceil(s/3),F=2*f,g=function(e){return(t[e]^t[e+1]<<f^t[e+2]<<F)&d},m=new St(25e3),v=new X(288),y=new X(32),b=0,w=0,S=r.i||0,k=0,T=r.w||0,E=0;S+2<o;++S){var _=g(S),C=32767&S,I=p[_];if(u[C]=I,p[_]=C,T<=S){var x=o-S;if((7e3<b||24576<k)&&(423<x||!l)){for(var c=Vt(t,h,0,m,v,y,w,k,E,S-E,c),k=b=w=0,E=S,O=0;O<286;++O)v[O]=0;for(O=0;O<30;++O)y[O]=0}var R=2,N=0,P=j,A=C-I&32767;if(2<x&&_==g(S-A))for(var U=Math.min(B,x)-1,q=Math.min(32767,S),H=Math.min(258,x);A<=q&&--P&&C!=I;){if(t[S+R]==t[S+R-A]){for(var D=0;D<H&&t[S+D]==t[S+D-A];++D);if(R<D){if(N=A,U<(R=D))break;for(var z=Math.min(A,D-2),W=0,O=0;O<z;++O){var M=S-A+O&32767,V=M-u[M]&32767;W<V&&(W=V,I=M)}}}A+=(C=I)-(I=u[C])&32767}N?(m[k++]=268435456|_t[R]<<18|Ct[N],_=31&_t[R],x=31&Ct[N],w+=kt[_]+Tt[x],++v[257+_],++y[x],T=S+R,++b):(m[k++]=t[S],++v[t[S]])}}for(S=Math.max(S,T);S<o;++S)m[k++]=t[S],++v[t[S]];c=Vt(t,h,l,m,v,y,w,k,E,S-E,c),l||(r.r=7&c|h[c/8|0]<<3,c-=7,r.h=p,r.p=u,r.i=S,r.w=T)}else{for(S=r.w||0;S<o+l;S+=65535){var L=S+65535;o<=L&&(h[c/8|0]=l,L=o),c=Wt(h,c+1,t.subarray(S,L))}r.i=o}return Bt(a,0,i+Lt(c)+n)},Jt=(()=>{for(var e=new Int32Array(256),t=0;t<256;++t){for(var s=t,i=9;--i;)s=(1&s&&-306674912)^s>>>1;e[t]=s}return e})(),Gt=function(){var i=-1;return{p:function(e){for(var t=i,s=0;s<e.length;++s)t=Jt[255&t^e[s]]^t>>>8;i=t},d:function(){return~i}}},Yt=function(e,t,s,i,n){var r,o;return n||(n={l:1},t.dictionary&&(r=t.dictionary.subarray(-32768),(o=new $(r.length+e.length)).set(r),o.set(e,r.length),e=o,n.w=r.length)),Kt(e,null==t.level?6:t.level,null==t.mem?n.l?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):20:12+t.mem,s,i,n)},Qt=function(e,t){var s,i={};for(s in e)i[s]=e[s];for(s in t)i[s]=t[s];return i},Zt=function(e,t,s){for(var i=e(),e=e.toString(),n=e.slice(e.indexOf("[")+1,e.lastIndexOf("]")).replace(/\s+/g,"").split(","),r=0;r<i.length;++r){var o=i[r],a=n[r];if("function"==typeof o){t+=";"+a+"=";var h=o.toString();if(o.prototype)if(-1!=h.indexOf("[native code]")){var l=h.indexOf(" ",8)+1;t+=h.slice(l,h.indexOf("(",l))}else for(var c in t+=h,o.prototype)t+=";"+a+".prototype."+c+"="+o.prototype[c].toString();else t+=h}else s[a]=o}return t},es=[],ts=function(e){var t,s=[];for(t in e)e[t].buffer&&s.push((e[t]=new e[t].constructor(e[t])).buffer);return s},ss=function(e,t,s,i){if(!es[s]){for(var n="",r={},o=e.length-1,a=0;a<o;++a)n=Zt(e[a],n,r);es[s]={c:Zt(e[o],n,r),e:r}}var h=Qt({},es[s].e);return wt(es[s].c+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+t.toString()+"}",s,h,ts(h),i)},is=function(e){return postMessage(e,[e.buffer])},ns=function(e,t,s){for(;s;++t)e[t]=s,s>>>=8},rs=function(e,t){var s=t.filename;if(e[0]=31,e[1]=139,e[2]=8,e[8]=t.level<2?4:9==t.level?2:0,e[9]=3,0!=t.mtime&&ns(e,4,Math.floor(new Date(t.mtime||Date.now())/1e3)),s){e[3]=8;for(var i=0;i<=s.length;++i)e[i+10]=s.charCodeAt(i)}},os=function(e){return 10+(e.filename?e.filename.length+1:0)};function as(e,t){return Yt(e,t||{},0,0)}function hs(e,t,s){var i,n;s||(s=t,t={}),"function"!=typeof s&&Ft(7),e=e,t=t,i=s,(n=ss([Nt,At,function(){return[ls]}],function(e){return is(ls(e.data[0],e.data[1]))},2,function(e,t){n.terminate(),i(e,t)})).postMessage([e,t],t.consume?[e.buffer]:[])}function ls(e,t){t=t||{};var s=Gt(),i=e.length,e=(s.p(e),Yt(e,t,os(t),8)),n=e.length;return rs(e,t),ns(e,n-8,s.d()),ns(e,n-4,i),e}var x,e="undefined"!=typeof TextDecoder&&new TextDecoder;try{e.decode(Xt,{stream:!0})}catch(no){}(t=x=x||{})[t.Requesting=0]="Requesting",t[t.True=1]="True",t[t.False=2]="False";class cs{constructor(e,t,s=!1){this.app=e,this.noSecureMode=s,this.version="11.0.8",this.socket=null,this.calls=new Map,this.canvasPeers={},this.canvasNodeCheckers=new Map,this.assistDemandedRestart=!1,this.callingState=x.False,this.remoteControl=null,this.peerReconnectTimeout=null,this.agents={},this.canvasMap=new Map,this.iceCandidatesBuffer=new Map,this.setCallingState=e=>{this.callingState=e},window.__OR_ASSIST_VERSION=this.version,this.options=Object.assign({session_calling_peer_key:"__openreplay_calling_peer",session_control_peer_key:"__openreplay_control_peer",config:null,serverURL:null,onCallStart:()=>{},onAgentConnect:()=>{},onRemoteControlStart:()=>{},onDragCamera:()=>{},callConfirm:{},controlConfirm:{},recordingConfirm:{},socketHost:"",compressionEnabled:!1,compressionMinBatchSize:5e3},t),this.app.options.assistSocketHost&&(this.options.socketHost=this.app.options.assistSocketHost),void 0!==document.hidden&&e.attachEventListener(document,"visibilitychange",()=>this.emit("UPDATE_SESSION",{active:!document.hidden}),!1,!1);let i=document.querySelector("title"),n=i&&new MutationObserver(()=>{this.emit("UPDATE_SESSION",{pageTitle:document.title})});e.addOnUxtCb(e=>{this.emit("UPDATE_SESSION",{uxtId:e})}),e.attachStartCallback(()=>{this.assistDemandedRestart||(this.onStart(),n&&n.observe(i,{subtree:!0,characterData:!0,childList:!0}))}),e.attachStopCallback(()=>{this.assistDemandedRestart||(this.clean(),n&&n.disconnect())}),e.attachCommitCallback(e=>{var t,s,i;!this.agentsConnected||2===(i=e.length)&&0===e[0]._id&&49===e[1]._id||(i>this.options.compressionMinBatchSize&&this.options.compressionEnabled?(t=[],1e4<i?(i=Math.floor(i/2),s=e.slice(0,i),i=e.slice(i),t.push(s),t.push(i)):t.push(e),t.forEach(s=>{var e=JSON.stringify(s);hs((new TextEncoder).encode(e),{mtime:0},(e,t)=>{e?this.emit("messages",s):this.emit("messages_gz",t)})})):this.emit("messages",e))}),e.session.attachUpdateCallback(e=>this.emit("UPDATE_SESSION",e))}emit(e,t){this.socket&&this.socket.emit(e,{meta:{tabId:this.app.getTabId()},data:t})}get agentsConnected(){return 0<Object.keys(this.agents).length}getHost(){return this.options.socketHost||(this.options.serverURL?new URL(this.options.serverURL).host:this.app.getHost())}getBasePrefixUrl(){return this.options.serverURL?new URL(this.options.serverURL).pathname:""}onStart(){let e,p=this.app;var t=p.getSessionID();let f=null,g=null,s=null,i=null,m=null;if(!t)return p.debug.error("No session ID");var n=p.getProjectKey()+`-${t}-`+this.app.getTabId();let v=this.socket=Ye(this.getHost(),{path:this.getBasePrefixUrl()+"/ws-assist/socket",query:{peerId:n,identity:"session",tabId:this.app.getTabId(),sessionInfo:JSON.stringify(Object.assign({uxtId:null!=(e=this.app.getUxtId())?e:void 0,pageTitle:document.title,active:!0,assistOnly:this.app.socketMode},this.app.getSessionInfo()))},extraHeaders:{sessionId:t},transports:["websocket"],withCredentials:!0,reconnection:!0,reconnectionAttempts:30,reconnectionDelay:1e3,reconnectionDelayMax:25e3,randomizationFactor:.5});v.onAny((...e)=>{"messages"!==e[0]&&"UPDATE_SESSION"!==e[0]&&("webrtc_call_ice_candidate"!==e[0]&&p.debug.log("Socket:",...e),v.on("close",e=>{p.debug.warn("Socket closed:",e)}))});let r=(e,t)=>{var s;e&&(s=this.agents[e].onControlReleased,delete this.agents[e].onControlReleased,"function"==typeof s&&s(),this.emit("control_rejected",e)),null!=g&&(g.remove(),g=null),null!=f&&f.hideRemoteControl(),this.callingState!==x.True&&(null!=f&&f.remove(),f=null),t&&(t=e?null==(s=this.agents[e])?void 0:s.agentInfo:{},null!=(s=(e=this.options).onRemoteControlDeny))&&s.call(e,t||{})},o=(this.remoteControl=new ct(this.options,e=>{var t;return f=f||new pt(p.debug.error,this.options.callUITemplate),this.remoteControl&&null!=f&&f.showRemoteControl(this.remoteControl.releaseControl),this.agents[e]=Object.assign(Object.assign({},this.agents[e]),{onControlReleased:this.options.onRemoteControlStart(null==(t=this.agents[e])?void 0:t.agentInfo)}),this.emit("control_granted",e),(g=new ft).mount(),c.get(e)},(e,t)=>r(e,t),e=>this.emit("control_busy",e)),()=>{v.emit("recording_accepted")}),a=e=>{var t,s;v.emit("recording_rejected"),null!=(s=(t=this.options).onRecordingDeny)&&s.call(t,e||{})},h=new mt(this.options.recordingConfirm);function l(e,t,s){return p.getTabId()!==t.meta.tabId||null==s?void 0:s(e,t.data)}null!==this.remoteControl&&(v.on("request_control",(e,t)=>{l(e,t,null==(e=this.remoteControl)?void 0:e.requestControl)}),v.on("release_control",(e,t)=>{l(e,t,(e,t)=>{var s;return null==(s=this.remoteControl)?void 0:s.releaseControl(t)})}),v.on("scroll",(e,t)=>l(e,t,null==(e=this.remoteControl)?void 0:e.scroll)),v.on("click",(e,t)=>l(e,t,null==(e=this.remoteControl)?void 0:e.click)),v.on("move",(e,t)=>l(e,t,null==(e=this.remoteControl)?void 0:e.move)),v.on("startDrag",(e,t)=>l(e,t,null==(e=this.remoteControl)?void 0:e.startDrag)),v.on("drag",(e,t)=>l(e,t,null==(e=this.remoteControl)?void 0:e.drag)),v.on("stopDrag",(e,t)=>l(e,t,null==(e=this.remoteControl)?void 0:e.stopDrag)),v.on("focus",(e,t)=>l(e,t,(e,t)=>{t=p.nodes.getNode(t);t instanceof HTMLElement&&this.remoteControl&&this.remoteControl.focus(e,t)})),v.on("input",(e,t)=>l(e,t,null==(e=this.remoteControl)?void 0:e.input))),v.on("moveAnnotation",(e,t)=>l(e,t,(e,t)=>g&&g.move(t))),v.on("startAnnotation",(e,t)=>l(e,t,(e,t)=>null==g?void 0:g.start(t))),v.on("stopAnnotation",(e,t)=>l(e,t,null==g?void 0:g.stop)),v.on("WEBRTC_CONFIG",e=>{e&&(this.config=JSON.parse(e))}),v.on("NEW_AGENT",(t,e)=>{var s,i;this.cleanCanvasConnections(),this.agents[t]={onDisconnect:null==(i=(s=this.options).onAgentConnect)?void 0:i.call(s,e),agentInfo:e},this.app.active()&&(this.assistDemandedRestart=!0,this.app.stop(),this.app.clearBuffers(),this.app.waitStatus(0).then(()=>{this.app.allowAppStart(),setTimeout(()=>{this.app.start().then(()=>{this.assistDemandedRestart=!1}).then(()=>{var e;null!=(e=this.remoteControl)&&e.reconnect([t])}).catch(e=>p.debug.error(e))},100)}))}),v.on("AGENTS_INFO_CONNECTED",e=>{this.cleanCanvasConnections(),e.forEach(e=>{var t,s;e.socketId&&(this.agents[e.socketId]={agentInfo:e,onDisconnect:null==(s=(t=this.options).onAgentConnect)?void 0:s.call(t,e)})}),this.app.active()&&(this.assistDemandedRestart=!0,this.app.stop(),this.app.clearBuffers(),this.app.waitStatus(0).then(()=>{this.app.allowAppStart(),setTimeout(()=>{this.app.start().then(()=>{this.assistDemandedRestart=!1}).then(()=>{var e;null!=(e=this.remoteControl)&&e.reconnect(Object.keys(this.agents))}).catch(e=>p.debug.error(e))},100)}))}),v.on("AGENT_DISCONNECTED",e=>{var t,s;null!=(t=this.remoteControl)&&t.releaseControl(),null!=(s=null==(t=this.agents[e])?void 0:t.onDisconnect)&&s.call(t),delete this.agents[e],Object.values(this.calls).forEach(e=>e.close()),this.calls.clear(),h.stopAgentRecording(e),u({socketId:e})}),v.on("NO_AGENT",()=>{Object.values(this.agents).forEach(e=>{var t;return null==(t=e.onDisconnect)?void 0:t.call(e)}),this.cleanCanvasConnections(),this.agents={},h.isActive&&h.stopRecording()}),v.on("call_end",(e,t)=>{c.has(e)&&t?(t=t.data,u({socketId:e,callId:t})):p.debug.warn("Received call_end from unknown agent",e)}),v.on("_agent_name",(e,t)=>{p.getTabId()===t.meta.tabId&&(t=t.data,c.set(e,t),d())}),v.on("webrtc_canvas_answer",async(e,t)=>{var s=this.canvasPeers[t.id];if(s)try{await s.setRemoteDescription(new RTCSessionDescription(t.answer))}catch(e){p.debug.error("Error adding ICE candidate",e)}}),v.on("webrtc_canvas_ice_candidate",async(e,t)=>{var s=this.canvasPeers[t.id];if(s)try{await s.addIceCandidate(new RTCIceCandidate(t.candidate))}catch(e){p.debug.error("Error adding ICE candidate",e)}else this.iceCandidatesBuffer.set(t.id,(null==(s=this.iceCandidatesBuffer.get(t.id))?void 0:s.concat([t.candidate]))||[t.candidate])}),v.on("videofeed",(e,t)=>{p.getTabId()===t.meta.tabId&&(t=t.data,null!=f)&&f.toggleVideoStream(t)}),v.on("request_recording",(t,s)=>{var i;if(p.getTabId()===s.meta.tabId){let e=s.data;h.isActive?this.emit("recording_busy"):(null!=(i=(s=this.options).onRecordingRequest)&&i.call(s,JSON.parse(e)),h.requestRecording(t,o,()=>a(e)))}}),v.on("stop_recording",(e,t)=>{p.getTabId()===t.meta.tabId&&h.isActive&&h.stopAgentRecording(e)}),v.on("webrtc_call_offer",async(e,t)=>{this.calls.has(t.from)||await T(t.from,t.offer)}),v.on("webrtc_call_ice_candidate",async(e,t)=>{var s=this.calls[t.from];if(s)try{await s.addIceCandidate(new RTCIceCandidate(t.candidate))}catch(e){p.debug.error("Error adding ICE candidate",e)}else this.iceCandidatesBuffer.set(t.from,(null==(s=this.iceCandidatesBuffer.get(t.from))?void 0:s.concat([t.candidate]))||[t.candidate])});let c=new Map,y={};function d(){null!=f&&f.setAssistentName(c)}function u({socketId:e,callId:t}){c.delete(e),0===c.size?w():(d(),t&&b(t))}let b=e=>{var t;null!=(t=this.calls.get(e))&&t.close(),this.calls.delete(e)},w=()=>{var e;Object.values(this.calls).forEach(e=>e.close()),this.calls.clear(),Object.values(y).forEach(e=>{e.stop()}),Object.keys(y).forEach(e=>{delete y[e]}),S(),(null==(e=this.remoteControl)?void 0:e.status)===I.Disabled?(null!=f&&f.remove(),null!=g&&g.remove(),f=null,g=null):null!=f&&f.hideControls(),this.emit("UPDATE_SESSION",{agentIds:[],isCallActive:!1}),this.setCallingState(x.False),sessionStorage.removeItem(this.options.session_calling_peer_key),null!=m&&m()},S=()=>{s&&(s.remove(),s=null,i=null)},k=async({pc:e,from:t})=>{try{var s=await e.createOffer();await e.setLocalDescription(s),this.emit("webrtc_call_offer",{from:t,offer:s})}catch(e){p.debug.error("Error with renegotiation:",e)}},T=async(i,e)=>{var t,s,n,r,o,a,h,l;p.debug.log("handleIncomingCallOffer",i);let c;JSON.parse(sessionStorage.getItem(this.options.session_calling_peer_key)||"[]").includes(i)||this.callingState===x.True?c=Promise.resolve(!0):(this.setCallingState(x.Requesting),c=E(),this.playNotificationSound(),setTimeout(()=>{this.callingState===x.Requesting&&_()},3e4));try{if(await c){let s=new RTCPeerConnection({iceServers:this.config});this.calls.set(i,s),f||(f=new pt(p.debug.error,this.options.callUITemplate)).setVideoToggleCallback(e=>{this.emit("videofeed",{streamId:i,enabled:e.enabled})}),f.showControls(_),g||(g=new ft).mount();try{y[i]||(p.debug.log("starting new stream for",i),y[i]=(h=s,l=k.bind(null,{pc:s,from:i}),await navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(t=>{if(t.getAudioTracks()[0])return t.getTracks().forEach(e=>{h.addTrack(e,t)}),new Qe(t,h,l);throw new Error("No audio tracks provided")}))),f.setLocalStreams(Object.values(y))}catch(e){return p.debug.error("Error requesting local stream",e),_(),void(null!=(r=(n=this.options).onCallDeny)&&r.call(n))}s.onicecandidate=e=>{e.candidate&&v.emit("webrtc_call_ice_candidate",{from:i,candidate:e.candidate})},s.ontrack=t=>{t=t.streams[0];if(t&&f){f.addRemoteStream(t,i);let e=()=>{null!=f&&f.playRemote(),document.removeEventListener("click",e)};document.addEventListener("click",e)}},await s.setRemoteDescription(new RTCSessionDescription(e));var d=await s.createAnswer(),u=(await s.setLocalDescription(d),v.emit("webrtc_call_answer",{from:i,answer:d}),this.applyBufferedIceCandidates(i),y[i].onVideoTrack(e=>{var t=s.getSenders().find(e=>"video"===(null==(e=e.track)?void 0:e.kind));t?t.replaceTrack(e):p.debug.warn("No video sender found")}),document.addEventListener("visibilitychange",()=>{_()}),this.setCallingState(x.True),m=m||(null==(a=(o=this.options).onCallStart)?void 0:a.call(o)),Array.from(this.calls.keys()));sessionStorage.setItem(this.options.session_calling_peer_key,JSON.stringify(u)),this.emit("UPDATE_SESSION",{agentIds:u,isCallActive:!0})}else _(),null!=(s=(t=this.options).onCallDeny)&&s.call(t)}catch(e){p.debug.log(e)}},E=()=>i||(s=new nt(ht(this.options.callConfirm||{text:this.options.confirmText,style:this.options.confirmStyle},at,ot,"You have an incoming call. Do you want to answer?")),i=s.mount().then(e=>(S(),e))),_=()=>{this.emit("call_end"),w()},C=async(i,e)=>{for(var t of Object.values(this.agents)){if(!t.agentInfo)return;let s=`${t.agentInfo.peerId}-${t.agentInfo.id}-canvas-`+e;this.canvasPeers[s]||(this.canvasPeers[s]=new RTCPeerConnection({iceServers:this.config}),this.setupPeerListeners(s),this.applyBufferedIceCandidates(s),i.getTracks().forEach(e=>{var t;null!=(t=this.canvasPeers[s])&&t.addTrack(e,i)}),t=await this.canvasPeers[s].createOffer(),await this.canvasPeers[s].setLocalDescription(t),v.emit("webrtc_canvas_offer",{offer:t,id:s}))}};p.nodes.attachNodeCallback(t=>{let s=p.nodes.getID(t);if(s&&(i="canvas",t.localName===i)&&!p.sanitizer.isHidden(s)){p.debug.log("Creating stream for canvas "+s);i=new vt(t,s,30,e=>{C(e,s)},p.debug.error);this.canvasMap.set(s,i),this.canvasNodeCheckers.has(s)&&clearInterval(this.canvasNodeCheckers.get(s));let e=setInterval(()=>{t.ownerDocument.defaultView&&t.isConnected||(this.stopCanvasStream(s),clearInterval(e))},5e3);this.canvasNodeCheckers.set(s,e)}var i})}setupPeerListeners(t){var e=this.canvasPeers[t];e&&(e.onicecandidate=e=>{e.candidate&&this.socket&&this.socket.emit("webrtc_canvas_ice_candidate",{candidate:e.candidate,id:t})})}playNotificationSound(){"Audio"in window&&new Audio("https://static.openreplay.com/tracker-assist/notification.mp3").play().catch(e=>{this.app.debug.warn(e)})}clean(){var e;null!=(e=this.remoteControl)&&e.releaseControl(!1,!0),this.peerReconnectTimeout&&(clearTimeout(this.peerReconnectTimeout),this.peerReconnectTimeout=null),this.cleanCanvasConnections(),Object.values(this.calls).forEach(e=>e.close()),this.calls.clear(),this.socket&&(this.socket.disconnect(),this.app.debug.log("Socket disconnected")),this.canvasMap.clear(),this.canvasPeers={},this.canvasNodeCheckers.forEach(e=>clearInterval(e)),this.canvasNodeCheckers.clear(),this.iceCandidatesBuffer.clear()}cleanCanvasConnections(){var e;Object.values(this.canvasPeers).forEach(e=>null==e?void 0:e.close()),this.canvasPeers={},null!=(e=this.socket)&&e.emit("webrtc_canvas_restart")}stopCanvasStream(e){var t,s;for(s of Object.values(this.agents)){if(!s.agentInfo)return;var i=`${s.agentInfo.peerId}-${s.agentInfo.id}-canvas-`+e;null!=(t=this.socket)&&t.emit("webrtc_canvas_stop",{id:i}),this.canvasPeers[i]&&(null!=(t=this.canvasPeers[i])&&t.close(),delete this.canvasPeers[i],null!=(t=this.canvasMap.get(e))&&t.stop(),this.canvasMap.delete(e),this.canvasNodeCheckers.get(e)&&clearInterval(this.canvasNodeCheckers.get(e)),this.canvasNodeCheckers.delete(e))}}applyBufferedIceCandidates(s){var e=this.iceCandidatesBuffer.get(s);e&&(e.forEach(e=>{var t;null!=(t=this.calls.get(s))&&t.addIceCandidate(new RTCIceCandidate(e))}),this.iceCandidatesBuffer.delete(s))}}function ds(e,t){for(var s=new J(31),i=0;i<31;++i)s[i]=t+=1<<e[i-1];for(var n=new fs(s[30]),i=1;i<30;++i)for(var r=s[i];r<s[i+1];++r)n[r]=r-s[i]<<5|i;return{b:s,r:n}}var us={},ps=function(e,t,s,i,n){t=new Worker(us[t]||(us[t]=URL.createObjectURL(new Blob([e+';addEventListener("error",function(e){e=e.error;postMessage({$e$:[e.message,e.code,e.stack]})})'],{type:"text/javascript"}))));return t.onmessage=function(e){var t,e=e.data,s=e.$e$;s?((t=new Error(s[0])).code=s[1],t.stack=s[2],n(t,null)):n(null,e)},t.postMessage(s,i),t},K=Uint8Array,J=Uint16Array,fs=Int32Array,gs=new K([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ms=new K([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),vs=new K([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),t=(e=ds(gs,2)).b,ys=e.r;t[28]=258,ys[258]=28;for(var bs=ds(ms,0).r,ws=new J(32768),h=0;h<32768;++h){var Ss=(43690&h)>>1|(21845&h)<<1;ws[h]=((65280&(Ss=(61680&(Ss=(52428&Ss)>>2|(13107&Ss)<<2))>>4|(3855&Ss)<<4))>>8|(255&Ss)<<8)>>1}for(var ks=function(e,t,s){for(var i=e.length,n=0,r=new J(t);n<i;++n)e[n]&&++r[e[n]-1];var o=new J(t);for(n=1;n<t;++n)o[n]=o[n-1]+r[n-1]<<1;if(s){for(var a=new J(1<<t),h=15-t,n=0;n<i;++n)if(e[n])for(var l=n<<4|e[n],c=t-e[n],d=o[e[n]-1]++<<c,u=d|(1<<c)-1;d<=u;++d)a[ws[d]>>h]=l}else for(a=new J(i),n=0;n<i;++n)e[n]&&(a[n]=ws[o[e[n]-1]++]>>15-e[n]);return a},F=new K(288),h=0;h<144;++h)F[h]=8;for(h=144;h<256;++h)F[h]=9;for(h=256;h<280;++h)F[h]=7;for(h=280;h<288;++h)F[h]=8;for(var Ts=new K(32),h=0;h<32;++h)Ts[h]=5;function Es(){return[K,J,fs,gs,ms,vs,ys,bs,xs,F,Os,Ts,ws,qs,Hs,ks,P,Ms,Ls,Bs,js,Fs,Ps,Us,Rs,Ns,zs,$s,si,Qs]}function _s(){return[ei,ti,Zs,Vs,Ws]}var d,Cs,Is,L,xs=ks(F,9,0),Os=ks(Ts,5,0),Rs=function(e){return(e+7)/8|0},Ns=function(e,t,s){return(null==s||s>e.length)&&(s=e.length),new K(e.subarray(t=null==t||t<0?0:t,s))},As=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Ds=function(e,t,s){t=new Error(t||As[e]);if(t.code=e,Error.captureStackTrace&&Error.captureStackTrace(t,Ds),s)return t;throw t},P=function(e,t,s){var i=t/8|0;e[i]|=s<<=7&t,e[1+i]|=s>>8},Ms=function(e,t,s){var i=t/8|0;e[i]|=s<<=7&t,e[1+i]|=s>>8,e[2+i]|=s>>16},Ls=function(e,t){for(var s=[],i=0;i<e.length;++i)e[i]&&s.push({s:i,f:e[i]});var n=s.length,r=s.slice();if(!n)return{t:Hs,l:0};if(1==n)return(g=new K(s[0].s+1))[s[0].s]=1,{t:g,l:1};s.sort(function(e,t){return e.f-t.f}),s.push({s:-1,f:25001});var o=s[0],a=s[1],h=0,l=1,c=2;for(s[0]={s:-1,f:o.f+a.f,l:o,r:a};l!=n-1;)o=s[s[h].f<s[c].f?h++:c++],a=s[h!=l&&s[h].f<s[c].f?h++:c++],s[l++]={s:-1,f:o.f+a.f,l:o,r:a};for(var d=r[0].s,i=1;i<n;++i)r[i].s>d&&(d=r[i].s);var u=new J(d+1),p=Bs(s[l-1],u,0);if(t<p){var i=0,f=0,g=p-t,m=1<<g;for(r.sort(function(e,t){return u[t.s]-u[e.s]||e.f-t.f});i<n;++i){var v=r[i].s;if(!(u[v]>t))break;f+=m-(1<<p-u[v]),u[v]=t}for(f>>=g;0<f;){var y=r[i].s;u[y]<t?f-=1<<t-u[y]++-1:++i}for(;0<=i&&f;--i){var b=r[i].s;u[b]==t&&(--u[b],++f)}p=t}return{t:new K(u),l:p}},Bs=function(e,t,s){return-1==e.s?Math.max(Bs(e.l,t,s+1),Bs(e.r,t,s+1)):t[e.s]=s},js=function(e){for(var t=e.length;t&&!e[--t];);for(var s=new J(++t),i=0,n=e[0],r=1,o=function(e){s[i++]=e},a=1;a<=t;++a)if(e[a]==n&&a!=t)++r;else{if(!n&&2<r){for(;138<r;r-=138)o(32754);2<r&&(o(10<r?r-11<<5|28690:r-3<<5|12305),r=0)}else if(3<r){for(o(n),--r;6<r;r-=6)o(8304);2<r&&(o(r-3<<5|8208),r=0)}for(;r--;)o(n);r=1,n=e[a]}return{c:s.subarray(0,i),n:t}},Fs=function(e,t){for(var s=0,i=0;i<t.length;++i)s+=e[i]*t[i];return s},Ps=function(e,t,s){var i=s.length,n=Rs(t+2);e[n]=255&i,e[n+1]=i>>8,e[n+2]=255^e[n],e[n+3]=255^e[n+1];for(var r=0;r<i;++r)e[n+r+4]=s[r];return 8*(n+4+i)},Us=function(e,t,s,i,n,r,o,a,h,l,c){P(t,c++,s),++n[256];for(var s=Ls(n,15),d=s.t,s=s.l,u=Ls(r,15),p=u.t,u=u.l,f=js(d),g=f.c,f=f.n,m=js(p),v=m.c,m=m.n,y=new J(19),b=0;b<g.length;++b)++y[31&g[b]];for(b=0;b<v.length;++b)++y[31&v[b]];for(var w=Ls(y,7),S=w.t,w=w.l,k=19;4<k&&!S[vs[k-1]];--k);var T=l+5<<3,E=Fs(n,F)+Fs(r,Ts)+o,n=Fs(n,d)+Fs(r,p)+o+14+3*k+Fs(y,S)+2*y[16]+3*y[17]+7*y[18];if(0<=h&&T<=E&&T<=n)return Ps(t,c,e.subarray(h,h+l));if(P(t,c,1+(n<E)),c+=2,n<E){var _=ks(d,s,0),C=d,I=ks(p,u,0),x=p,O=ks(S,w,0);P(t,c,f-257),P(t,c+5,m-1),P(t,c+10,k-4),c+=14;for(b=0;b<k;++b)P(t,c+3*b,S[vs[b]]);c+=3*k;for(var R=[g,v],N=0;N<2;++N)for(var A=R[N],b=0;b<A.length;++b){var D=31&A[b];P(t,c,O[D]),c+=S[D],15<D&&(P(t,c,A[b]>>5&127),c+=A[b]>>12)}}else _=xs,C=F,I=Os,x=Ts;for(b=0;b<a;++b){var M,L=i[b];255<L?(Ms(t,c,_[(D=L>>18&31)+257]),c+=C[D+257],7<D&&(P(t,c,L>>23&31),c+=gs[D]),Ms(t,c,I[M=31&L]),c+=x[M],3<M&&(Ms(t,c,L>>5&8191),c+=ms[M])):(Ms(t,c,_[L]),c+=C[L])}return Ms(t,c,_[256]),c+C[256]},qs=new fs([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Hs=new K(0),zs=function(t,e,s,i,n,r){var o=r.z||t.length,a=new K(i+o+5*(1+Math.ceil(o/7e3))+n),h=a.subarray(i,a.length-n),l=r.l,c=7&(r.r||0);if(e){c&&(h[0]=r.r>>3);for(var e=qs[e-1],B=e>>13,j=8191&e,d=(1<<s)-1,u=r.p||new J(32768),p=r.h||new J(1+d),f=Math.ceil(s/3),F=2*f,g=function(e){return(t[e]^t[e+1]<<f^t[e+2]<<F)&d},m=new fs(25e3),v=new J(288),y=new J(32),b=0,w=0,S=r.i||0,k=0,T=r.w||0,E=0;S+2<o;++S){var _=g(S),C=32767&S,I=p[_];if(u[C]=I,p[_]=C,T<=S){var x=o-S;if((7e3<b||24576<k)&&(423<x||!l)){for(var c=Us(t,h,0,m,v,y,w,k,E,S-E,c),k=b=w=0,E=S,O=0;O<286;++O)v[O]=0;for(O=0;O<30;++O)y[O]=0}var R=2,N=0,P=j,A=C-I&32767;if(2<x&&_==g(S-A))for(var U=Math.min(B,x)-1,q=Math.min(32767,S),H=Math.min(258,x);A<=q&&--P&&C!=I;){if(t[S+R]==t[S+R-A]){for(var D=0;D<H&&t[S+D]==t[S+D-A];++D);if(R<D){if(N=A,U<(R=D))break;for(var z=Math.min(A,D-2),W=0,O=0;O<z;++O){var M=S-A+O&32767,V=M-u[M]&32767;W<V&&(W=V,I=M)}}}A+=(C=I)-(I=u[C])&32767}N?(m[k++]=268435456|ys[R]<<18|bs[N],_=31&ys[R],x=31&bs[N],w+=gs[_]+ms[x],++v[257+_],++y[x],T=S+R,++b):(m[k++]=t[S],++v[t[S]])}}for(S=Math.max(S,T);S<o;++S)m[k++]=t[S],++v[t[S]];c=Us(t,h,l,m,v,y,w,k,E,S-E,c),l||(r.r=7&c|h[c/8|0]<<3,c-=7,r.h=p,r.p=u,r.i=S,r.w=T)}else{for(S=r.w||0;S<o+l;S+=65535){var L=S+65535;o<=L&&(h[c/8|0]=l,L=o),c=Ps(h,c+1,t.subarray(S,L))}r.i=o}return Ns(a,0,i+Rs(c)+n)},Ws=(()=>{for(var e=new Int32Array(256),t=0;t<256;++t){for(var s=t,i=9;--i;)s=(1&s&&-306674912)^s>>>1;e[t]=s}return e})(),Vs=function(){var i=-1;return{p:function(e){for(var t=i,s=0;s<e.length;++s)t=Ws[255&t^e[s]]^t>>>8;i=t},d:function(){return~i}}},$s=function(e,t,s,i,n){var r,o;return n||(n={l:1},t.dictionary&&(r=t.dictionary.subarray(-32768),(o=new K(r.length+e.length)).set(r),o.set(e,r.length),e=o,n.w=r.length)),zs(e,null==t.level?6:t.level,null==t.mem?n.l?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):20:12+t.mem,s,i,n)},Xs=function(e,t){var s,i={};for(s in e)i[s]=e[s];for(s in t)i[s]=t[s];return i},Ks=function(e,t,s){for(var i=e(),e=e.toString(),n=e.slice(e.indexOf("[")+1,e.lastIndexOf("]")).replace(/\s+/g,"").split(","),r=0;r<i.length;++r){var o=i[r],a=n[r];if("function"==typeof o){t+=";"+a+"=";var h=o.toString();if(o.prototype)if(-1!=h.indexOf("[native code]")){var l=h.indexOf(" ",8)+1;t+=h.slice(l,h.indexOf("(",l))}else for(var c in t+=h,o.prototype)t+=";"+a+".prototype."+c+"="+o.prototype[c].toString();else t+=h}else s[a]=o}return t},Js=[],Gs=function(e){var t,s=[];for(t in e)e[t].buffer&&s.push((e[t]=new e[t].constructor(e[t])).buffer);return s},Ys=function(e,t,s,i){if(!Js[s]){for(var n="",r={},o=e.length-1,a=0;a<o;++a)n=Ks(e[a],n,r);Js[s]={c:Ks(e[o],n,r),e:r}}var h=Xs({},Js[s].e);return ps(Js[s].c+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+t.toString()+"}",s,h,Gs(h),i)},Qs=function(e){return postMessage(e,[e.buffer])},Zs=function(e,t,s){for(;s;++t)e[t]=s,s>>>=8},ei=function(e,t){var s=t.filename;if(e[0]=31,e[1]=139,e[2]=8,e[8]=t.level<2?4:9==t.level?2:0,e[9]=3,0!=t.mtime&&Zs(e,4,Math.floor(new Date(t.mtime||Date.now())/1e3)),s){e[3]=8;for(var i=0;i<=s.length;++i)e[i+10]=s.charCodeAt(i)}},ti=function(e){return 10+(e.filename?e.filename.length+1:0)};function si(e,t){return $s(e,t||{},0,0)}function ii(e,t,s){var i,n;s||(s=t,t={}),"function"!=typeof s&&Ds(7),e=e,t=t,i=s,(n=Ys([Es,_s,function(){return[ni]}],function(e){return Qs(ni(e.data[0],e.data[1]))},2,function(e,t){n.terminate(),i(e,t)})).postMessage([e,t],t.consume?[e.buffer]:[])}function ni(e,t){t=t||{};var s=Vs(),i=e.length,e=(s.p(e),$s(e,t,ti(t),8)),n=e.length;return ei(e,t),Zs(e,n-8,s.d()),Zs(e,n-4,i),e}e="undefined"!=typeof TextDecoder&&new TextDecoder;try{e.decode(Hs,{stream:!0})}catch(no){}class ri{constructor(){this.lastTs=0,this.lastSuffix=1,this.backDict={},this.getKey=t=>{let s=!1;t="__"+t;if(!this.backDict[t]){s=!0;var i=Date.now()%1e11;let e=i;e===this.lastTs?(e=1e4*e+this.lastSuffix,this.lastSuffix+=1):this.lastSuffix=1,this.backDict[t]=e,this.lastTs=i}return[this.backDict[t],s]}}}class oi{constructor(e){this.sendSetAttribute=(e,t,s)=>this.isDictDisabled?this.app.send([12,e,t,s]):(e=[35,e,this.applyDict(t),this.applyDict(s)],this.app.send(e)),this.app=e.app,this.isDictDisabled=e.isDictDisabled,this.dict=new ri}applyDict(e){var[t,s]=this.dict.getKey(e);return s&&this.app.send([34,t,e]),t}clear(){this.dict=new ri}}class ai{constructor(e,t){this.app=e,this.startParams=t,this.conditions=[],this.hasStarted=!1,this.createConditionFromFilter=e=>{e=li(e);if(e.type)return e},this.durationInt=null}setConditions(e){this.conditions=e}async fetchConditions(e,t){try{var s=(await(await fetch(this.app.options.ingestPoint+"/v1/web/conditions/"+e,{method:"GET",headers:{Authorization:"Bearer "+t}})).json()).conditions;let i=[];s.forEach(s=>{s.filters.forEach(e=>{let t;"fetch"===e.type?(t={type:"network_request",subConditions:[],name:s.name},e.filters.forEach(e=>{e=this.createConditionFromFilter(e);e&&t.subConditions.push(e)})):t=this.createConditionFromFilter(e),t&&("session_duration"===t.type&&this.processDuration(t.value[0],s.name),i.push({...t,name:s.name}))})}),this.conditions=i}catch(e){this.app.debug.error("Critical: cannot fetch start conditions")}}trigger(e){if(!this.hasStarted)try{this.hasStarted=!0,this.app.start(this.startParams,void 0,e)}catch(e){this.app.debug.error(e)}}processMessage(e){if(!this.hasStarted)switch(e[0]){case 78:this.jsExceptionEvent(e);break;case 27:this.customEvent(e);break;case 68:this.clickEvent(e);break;case 122:this.pageLocationEvent(e);break;case 83:this.networkRequest(e)}}processFlags(e){var t=this.conditions.filter(e=>"feature_flag"===e.type);t.length&&t.forEach(t=>{let s=hi[t.operator];s&&e.find(e=>s(e.key,t.value))&&this.trigger(t.name)})}processDuration(t,s){this.durationInt=setInterval(()=>{var e=performance.now();t<e&&this.trigger(s)},1e3),this.app.attachStopCallback(()=>{this.durationInt&&clearInterval(this.durationInt)})}networkRequest(i){var e=this.conditions.filter(e=>"network_request"===e.type);e.length&&e.forEach(e=>{var t=e.subConditions.filter(e=>"isAny"!==e.operator);t.length?t.every(e=>{let t;switch(e.key){case"url":t=i[3];break;case"status":t=i[6];break;case"method":t=i[2];break;case"duration":t=i[8]}var s=hi[e.operator];if(s&&s(t,e.value))return!0})&&this.trigger(e.name):0===t.length&&e.subConditions.length&&this.trigger(e.name)})}customEvent(s){var e=this.conditions.filter(e=>"custom_event"===e.type);e.length&&e.forEach(e=>{var t=hi[e.operator];t&&(t(s[1],e.value)||t(s[2],e.value))&&this.trigger(e.name)})}clickEvent(s){var e=this.conditions.filter(e=>"click"===e.type);e.length&&e.forEach(e=>{var t=hi[e.operator];t&&(t(s[3],e.value)||t(s[4],e.value))&&this.trigger(e.name)})}pageLocationEvent(s){var e=this.conditions.filter(e=>"visited_url"===e.type);e&&e.forEach(e=>{var t=hi[e.operator];t&&t(s[1],e.value)&&this.trigger(e.name)})}jsExceptionEvent(e){let i=[e[1],e[2],e[3]];e=this.conditions.filter(e=>"exception"===e.type);e&&e.forEach(t=>{let s=hi[t.operator];s&&i.some(e=>s(e,t.value))&&this.trigger(t.name)})}}let hi={is:(t,e)=>e.some(e=>t.includes(e)),isAny:()=>!0,isNot:(t,e)=>!e.some(e=>t.includes(e)),contains:(t,e)=>e.some(e=>t.includes(e)),notContains:(t,e)=>!e.some(e=>t.includes(e)),startsWith:(t,e)=>e.some(e=>t.startsWith(e)),endsWith:(t,e)=>e.some(e=>t.endsWith(e)),greaterThan:(e,t)=>t<e,greaterOrEqual:(e,t)=>t<=e,lessOrEqual:(e,t)=>e<=t,lessThan:(e,t)=>e<t},li=e=>{let t={on:"is",notOn:"isNot",">":"greaterThan","<":"lessThan","=":"is","<=":"lessOrEqual",">=":"greaterOrEqual"};var s=e=>{if(Object.keys(t).includes(e))return t[e]};let i={type:"",operator:"",value:e.value,key:""};switch(e.type){case"click":i={type:"click",operator:s(e.operator),value:e.value,key:""};break;case"location":i={type:"visited_url",operator:e.operator,value:e.value,key:""};break;case"custom":i={type:"custom_event",operator:e.operator,value:e.value,key:""};break;case"metadata":i={type:"featureFlag"===e.source?"feature_flag":e.type,operator:e.operator,value:e.value,key:""};break;case"error":i={type:"exception",operator:e.operator,value:e.value,key:""};break;case"duration":i={type:"session_duration",value:e.value,key:"",operator:"is"};break;case"fetchUrl":i={type:"network_request",key:"url",operator:e.operator,value:e.value};break;case"fetchStatusCode":i={type:"network_request",key:"status",operator:s(e.operator),value:e.value};break;case"fetchMethod":i={type:"network_request",key:"method",operator:s(e.operator),value:e.value};break;case"fetchDuration":i={type:"network_request",key:"duration",operator:s(e.operator),value:e.value}}return i};class ci{constructor(e){this.app=e,this.flags=[],this.storageKey="__openreplay_flags";var e=this.app.sessionStorage.getItem(this.storageKey);e&&(e=e.split(";").filter(Boolean),this.flags=e.map(e=>JSON.parse(e)))}getFeatureFlag(t){return this.flags.find(e=>e.key===t)}isFlagEnabled(t){return-1!==this.flags.findIndex(e=>e.key===t)}onFlagsLoad(e){this.onFlagsCb=e}async reloadFlags(e){var t=this.app.sessionStorage.getItem(this.storageKey);let s={};t&&t.split(";").filter(Boolean).forEach(e=>{e=JSON.parse(e);s[e.key]={key:e.key,value:e.value}});var t=this.app.session.getInfo(),i=this.app.session.userInfo,t={projectID:t.projectID,userID:t.userID,metadata:t.metadata,referrer:document.referrer,os:i.userOS,device:i.userDevice,country:i.userCountry,state:i.userState,city:i.userCity,browser:i.userBrowser,persistFlags:s},i=e??this.app.session.getSessionToken(),e=await fetch(this.app.options.ingestPoint+"/v1/web/feature-flags",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+i},body:JSON.stringify(t)});if(200===e.status)return i=await e.json(),this.handleFlags(i.flags)}handleFlags(e){let t=[],s=(e.forEach(e=>{e.is_persist&&t.push(e)}),"");return this.diffPersist(t).forEach(e=>{s+=JSON.stringify(e)+";"}),this.app.sessionStorage.setItem(this.storageKey,s),this.flags=e,this.onFlagsCb?.(e)}clearPersistFlags(){this.app.sessionStorage.removeItem(this.storageKey)}diffPersist(e){var t=this.app.sessionStorage.getItem(this.storageKey);if(!t)return e;let s=t.split(";").filter(Boolean).map(e=>JSON.parse(e));return e.filter(t=>-1===s.findIndex(e=>e.key===t.key))}}let di={htmlmasked:"hidden",masked:"obscured"},S=!("undefined"==typeof window),ui=S&&navigator.userAgent.match(/firefox|fxios/i),k=S?Date.now()-performance.now():0;function pi(){k=Date.now()-performance.now()}let U=S&&performance.now?()=>Math.round(performance.now()+k):()=>Date.now(),fi="repeat"in String.prototype?e=>"*".repeat(e.length):e=>e.replace(/./g,"*");function gi(e){return e.trim().replace(/\s+/g," ")}function mi(e){return e.startsWith("https://")||e.startsWith("http://")}let vi="https://docs.openreplay.com",yi={};function T(e,t,s="/"){yi[e]||(console.warn(`OpenReplay: ${e} is deprecated. ${t?`Please, use ${t} instead.`:""} Visit ${vi}${s} for more information.`),yi[e]=!0)}function bi(e){var t=e.getAttribute("data-openreplay-label");return null===t&&null!==(t=e.getAttribute("data-asayer-label"))&&T('"data-asayer-label" attribute','"data-openreplay-label" attribute',"/"),t}function l(e,t){var s="data-openreplay-"+t;return e.hasAttribute(s)&&(di[t]&&T(`"${s}" attribute`,`"${di[t]}" attribute`,"/en/sdk/sanitize-data"),1)}function wi(e){try{e instanceof HTMLIFrameElement?e.contentDocument:e instanceof Window?e.document:e instanceof Document?e.defaultView:"nodeType"in e?e.nodeType:"addEventListener"in e&&e.addEventListener}catch(e){if(e instanceof DOMException&&"SecurityError"===e.name)return}return 1}function Si(e){return e.toString(16).padStart(2,"0")}function ki(){try{return window.self&&window.top&&window.self!==window.top}catch(e){return!0}}function Ti(e){return window.Zone&&"__symbol__"in window.Zone?window.Zone.__symbol__(e):e}function Ei(e,t){return new(t?MutationObserver:(t=Ti("MutationObserver"),window[t]))(e)}function _i(t,s,i,n,r){if(wi(t)){let e="addEventListener";r||(e=Ti("addEventListener"));try{t[e]?t[e](s,i,n):t.addEventListener(s,i,n)}catch(e){r=e.message;console.error(`Openreplay: ${r}; if this error is caused by an IframeObserver, ignore it`,s,t)}}}function Ci(t,s,i,n,r){if(wi(t)){let e="removeEventListener";r||(e=Ti("removeEventListener"));try{t[e]?t[e](s,i,n):t.removeEventListener(s,i,n)}catch(e){r=e.message;console.error(`Openreplay: ${r}; if this error is caused by an IframeObserver, ignore it`,s,t)}}}let Ii=new class{constructor(){this.taskQueue=[],this.isRunning=!1}addTask(e){this.taskQueue.push(e),this.runTasks()}runTasks(){if(!this.isRunning&&0!==this.taskQueue.length){this.isRunning=!0;let t=()=>{var e;0===this.taskQueue.length?this.isRunning=!1:(e=this.taskQueue.shift(),Promise.resolve(e()).then(()=>{requestAnimationFrame(()=>t())}))};t()}}};function xi(e){Ii.addTask(e)}function Oi(e,t){return[13,e,t]}function Ri(e,t){return[30,e,t]}function Ni(e,t,s,i){return[57,e,t,s,i]}function Ai(e){return[58,e]}function Di(e,t,s,i){return[60,e,t,s,i]}function Mi(e,t,s){return[61,e,t,s]}function Li(e,t){return[70,e,t]}function Bi(e,t,s){return[71,e,t,s]}function ji(e,t,s,i){return[73,e,t,s,i]}function Fi(e,t){return[75,e,t]}function Pi(e,t){return[76,e,t]}function Ui(e,t,s,i){return[78,e,t,s,i]}function qi(e,t,s,i,n,r,o,a,h){return[83,e,t,s,i,n,r,o,a,h]}function Hi(e,t,s){return[113,e,t,s]}function zi(e){return[115,e]}function Wi(e,t,s,i,n,r,o,a,h,l){return[116,e,t,s,i,n,r,o,a,h,l]}function Vi(e){return[117,e]}function $i(e){return[118,e]}let Xi=S&&"performance"in window&&"memory"in performance?performance:{memory:{}},Ki=S?1024*(navigator.deviceMemory||0):0,Ji=Xi.memory.jsHeapSizeLimit||0,Gi="__or__watched_tags__";class Yi{constructor(e){this.intervals={},this.tags=[],this.sessionStorage=e.sessionStorage,this.errLog=e.errLog,this.onTag=e.onTag;e=JSON.parse(e.sessionStorage.getItem(Gi)??"[]");this.setTags(e),this.observer=new IntersectionObserver(e=>{e.forEach(e=>{var t;e.isIntersecting&&e.target&&((t=e.target.__or_watcher_tagname)&&this.onTagRendered(t),this.observer.unobserve(e.target))})})}async fetchTags(e,t){return fetch(e+"/v1/web/tags",{method:"GET",headers:{Authorization:"Bearer "+t}}).then(e=>e.json()).then(({tags:e})=>{e&&e.length&&(this.setTags(e),e=JSON.stringify(e),this.sessionStorage.setItem(Gi,e||""))}).catch(e=>this.errLog(e))}setTags(e){this.tags=e,this.intervals={},e.forEach(t=>{this.intervals[t.id]=setInterval(()=>{var e=document.querySelectorAll(t.selector);0<e.length&&((e=e[0]).__or_watcher_tagname=t.id,this.observer.observe(e))},500)})}onTagRendered(e){this.intervals[e]&&clearInterval(this.intervals[e]),this.onTag(e)}clear(){this.tags.forEach(e=>{clearInterval(this.intervals[e.id])}),this.tags=[],this.intervals={},this.observer.disconnect()}}let Qi={position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"rgba(0, 0, 0, 0.40)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:999999,fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"'},Zi={display:"flex",flexDirection:"column",gap:"2rem",alignItems:"center",padding:"1.5rem",borderRadius:"2px",border:"1px solid rgb(255 255 255 / var(--tw-bg-opacity, 1))",background:"#FFF",width:"22rem"},en={display:"flex","flex-direction":"column",gap:"unset","align-items":"center",padding:"unset",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',"border-radius":"2px",border:"1px solid rgb(255 255 255 / var(--tw-bg-opacity, 1))",background:"rgba(255, 255, 255, 0.75)",width:"22rem"},tn={fontFamily:"Verdana, sans-serif",fontSize:"1.25rem",fontStyle:"normal",fontWeight:"500",lineHeight:"1.75rem",color:"rgba(0, 0, 0, 0.85)"},sn={borderTop:"1px solid rgba(0, 0, 0, 0.06)",borderBottom:"1px solid rgba(0, 0, 0, 0.06)",padding:"1.25rem 0rem",color:"rgba(0, 0, 0, 0.85)",fontFamily:"Verdana, sans-serif",fontSize:"13px",fontStyle:"normal",fontWeight:"400",lineHeight:"auto",whiteSpace:"pre-wrap"},nn={display:"flex",padding:"0.4rem 0.9375rem",justifyContent:"center",alignItems:"center",gap:"0.625rem",borderRadius:"0.25rem",border:"1px solid #394EFF",background:"#394EFF",boxShadow:"0px 2px 0px 0px rgba(0, 0, 0, 0.04)",color:"#FFF",textAlign:"center",fontFamily:"Verdana, sans-serif",fontSize:"1rem",fontStyle:"normal",fontWeight:"500",lineHeight:"1.5rem",cursor:"pointer"},rn={fontFamily:"Verdana, sans-serif",fontSize:"13px",fontWeight:"500",lineHeight:"auto",display:"flex",justifyContent:"space-between",width:"100%",cursor:"pointer"},on={display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"0.625rem",fontSize:"13px",lineHeight:"auto"},an={padding:"0.5rem",gap:"0.5rem",fontFamily:"Verdana, sans-serif",fontSize:"16px",fontStyle:"normal",fontWeight:"500",lineHeight:"auto",color:"white",display:"flex",alignItems:"center",width:"100%",borderRadius:"2px",background:"rgba(0, 0, 0, 0.75)",boxSizing:"border-box"},hn={boxSizing:"border-box",display:"block",width:"100%",borderBottom:"1px solid rgb(255 255 255 / var(--tw-bg-opacity, 1))",background:"#FFF",padding:"0.65rem",alignSelf:"stretch",color:"#000",fontFamily:"Verdana, sans-serif",fontStyle:"normal",fontWeight:"400"},ln={...hn,display:"flex",flexDirection:"column",alignItems:"center",gap:"0.625rem"},cn={fontSize:"1.25rem",fontWeight:"500",cursor:"pointer",color:"#394EFF"},dn={display:"flex",padding:"0.4rem 0.9375rem",justifyContent:"center",alignItems:"center",gap:"0.625rem",borderRadius:"0.25rem",border:"1px solid #394EFF",background:"#394EFF",boxShadow:"0px 2px 0px 0px rgba(0, 0, 0, 0.04)",color:"#FFF",textAlign:"center",fontFamily:"Verdana, sans-serif",fontSize:"1rem",fontStyle:"normal",fontWeight:"500",lineHeight:"1.5rem",width:"100%",boxSizing:"border-box",cursor:"pointer"},un={marginTop:"1rem",marginBottom:"1rem",cursor:"pointer",display:"block",fontWeight:"500",fontSize:"13px!important",lineHeight:"auto"},pn={display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem",padding:"0.5rem",width:"100%",boxSizing:"border-box"},fn={display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",borderRadius:"6.25em",outline:"1px solid #394EFF",fontSize:"13px",height:"24px",width:"24px"},gn={display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",borderRadius:"6.25em",outline:"1px solid #D2DFFF",boxShadow:"0px 2px 0px 0px rgba(0, 0, 0, 0.04)",background:"#D2DFFF",fontSize:"13px",height:"24px",width:"24px"},mn={borderRadius:"0.375rem",border:"1px solid rgba(0, 0, 0, 0.06)",background:"#F5F7FF",boxShadow:"0px 2px 0px 0px rgba(0, 0, 0, 0.04)",display:"flex",flexDirection:"column",padding:"0.625rem 0.9375rem",gap:"0.5rem",alignSelf:"stretch"},vn={fontWeight:"bold"},yn={fontSize:"13px",lineHeight:"auto"},bn={marginRight:"0.5rem",cursor:"pointer",color:"#394EFF",textAlign:"center",fontFamily:"Verdana, sans-serif",fontSize:"13px",fontStyle:"normal",fontWeight:"500",lineHeight:"auto"},wn={...bn,display:"flex",padding:"0.25rem 0.9375rem",justifyContent:"center",alignItems:"center",gap:"0.5rem",borderRadius:"0.25rem",border:"1px solid #394EFF"},Sn={display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",boxSizing:"border-box"},kn={border:"4px solid rgba(255, 255, 255, 0.4)",width:"16px",height:"16px",borderRadius:"50%",borderLeftColor:"#fff",animation:"spin 0.5s linear infinite"},Tn={Standard:{width:1280,height:720}};class En{constructor(e){this.app=e,this.mediaRecorder=null,this.recordedChunks=[],this.stream=null,this.recStartTs=null}async startRecording(e,t,s,i){this.recStartTs=this.app.timestamp();try{this.stream=await navigator.mediaDevices.getUserMedia({video:!!i&&{...t,frameRate:{ideal:e}},audio:s}),this.mediaRecorder=new MediaRecorder(this.stream,{mimeType:"video/webm;codecs=vp9"}),this.recordedChunks=[],this.mediaRecorder.ondataavailable=e=>{0<e.data.size&&this.recordedChunks.push(e.data)},this.mediaRecorder.start()}catch(e){console.error(e)}}async stopRecording(){return new Promise(t=>{this.mediaRecorder&&(this.mediaRecorder.onstop=()=>{var e=new Blob(this.recordedChunks,{type:"video/webm"});t(e)},this.mediaRecorder.stop())})}async sendToAPI(){let t=await this.stopRecording();return fetch(this.app.options.ingestPoint+"/v1/web/uxt/upload-url",{headers:{Authorization:"Bearer "+this.app.session.getSessionToken()}}).then(e=>{if(e.ok)return e.json();throw new Error("Failed to get upload url")}).then(({url:e})=>fetch(e,{method:"PUT",headers:{"Content-Type":"video/webm"},body:t})).catch(console.error).finally(()=>{this.discard()})}async saveToFile(e="recorded-video.webm"){var t=await this.stopRecording(),t=URL.createObjectURL(t),s=document.createElement("a");s.style.display="none",s.href=t,s.download=e,document.body.appendChild(s),s.click(),window.URL.revokeObjectURL(t),document.body.removeChild(s)}discard(){this.mediaRecorder?.stop(),this.stream?.getTracks().forEach(e=>e.stop())}}function _n(){(e=document.createElement("style")).type="text/css",e.innerText=`@keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }`,document.head.appendChild(e);var e=document.createElement("div");return e.classList.add("spinner"),Object.assign(e.style,kn),e}function v(e,t,s,i,n){e=document.createElement(e);return e.className=t,Object.assign(e.style,s),i&&(e.textContent=i),n&&(e.id=n),e}let Cn="or_uxt_test_start",In="or_uxt_task_index",xn="or_uxt_session_id";class On{constructor(e,t,s,i,n,r,o,a,h){this.ingestPoint=e,this.getTimestamp=t,this.token=s,this.testId=i,this.storageKey=n,this.setStorageKey=r,this.removeStorageKey=o,this.getStorageKey=a,this.getSessionId=h,this.durations={testStart:0,tasks:[]},this.getDurations=()=>this.durations,this.setDurations=e=>{this.durations.testStart=e.testStart,this.durations.tasks=e.tasks},this.signalTask=(t,e,s)=>{var i,n;return t?(n=this.durations.tasks.find(e=>e.taskId===t),i=this.getTimestamp(),n=n?i-n.started:0,fetch(this.ingestPoint+"/v1/web/uxt/signals/task",{method:"POST",headers:{Authorization:"Bearer "+this.token},body:JSON.stringify({testId:this.testId,taskId:t,status:e,duration:n,timestamp:i,taskAnswer:s})})):console.error("User Testing: No Task ID Given")},this.signalTest=e=>{var t=this.getTimestamp(),s=("begin"===e&&this.testId?(s=this.getSessionId(),this.setStorageKey(xn,s),this.setStorageKey(this.storageKey,this.testId.toString()),this.setStorageKey(Cn,t.toString())):(this.removeStorageKey(this.storageKey),this.removeStorageKey(In),this.removeStorageKey(Cn)),this.durations.testStart||t);return fetch(this.ingestPoint+"/v1/web/uxt/signals/test",{method:"POST",headers:{Authorization:"Bearer "+this.token},body:JSON.stringify({testId:this.testId,status:e,duration:t-s,timestamp:t})})};e=this.getStorageKey(Cn);e&&(this.durations.testStart=parseInt(e,10))}}class Rn{constructor(e,t){this.app=e,this.storageKey=t,this.bg=v("div","bg",Qi,void 0,"__or_ut_bg"),this.container=v("div","container",Zi,void 0,"__or_ut_ct"),this.widgetGuidelinesVisible=!0,this.widgetTasksVisible=!1,this.widgetVisible=!0,this.isActive=!1,this.descriptionSection=null,this.taskSection=null,this.endSection=null,this.stopButton=null,this.stopButtonContainer=null,this.test=null,this.testId=null,this.signalManager=null,this.getTest=(t,s,i)=>{this.testId=t;var e=this.app.options.ingestPoint;return fetch(e+"/v1/web/uxt/test/"+t,{headers:{Authorization:"Bearer "+s}}).then(e=>e.json()).then(({test:e})=>{this.isActive=!0,this.test=e,this.signalManager=new On(this.app.options.ingestPoint,()=>this.app.timestamp(),s,t,this.storageKey,(e,t)=>this.app.localStorage.setItem(e,t),e=>this.app.localStorage.removeItem(e),e=>this.app.localStorage.getItem(e),()=>this.app.getSessionID()),this.createGreeting(e.title,e.reqMic,e.reqCamera),i&&((e.reqMic||e.reqCamera)&&this.userRecorder.startRecording(30,Tn.Standard,e.reqMic,e.reqCamera),this.showWidget(e.description,e.tasks,!0),this.showTaskSection())}).then(()=>t).catch(e=>{console.log("OR: Error fetching test",e)})},this.hideTaskSection=()=>!1,this.showTaskSection=()=>!0,this.collapseWidget=()=>!1,this.removeGreeting=()=>!1,this.toggleDescriptionVisibility=()=>{},this.currentTaskIndex=0,this.userRecorder=new En(e);this.app.getSessionID()!==this.app.localStorage.getItem(xn)&&(this.app.localStorage.removeItem(this.storageKey),this.app.localStorage.removeItem(xn),this.app.localStorage.removeItem("or_uxt_test_id"),this.app.localStorage.removeItem(In),this.app.localStorage.removeItem(Cn));t=this.app.localStorage.getItem(In);t&&(this.currentTaskIndex=parseInt(t,10))}getTestId(){return this.testId}createGreeting(e,t,s){let i=v("div","title",tn,e),n=v("div","description",sn,`Welcome, you're here to help us improve, not to be judged. Your insights matter!

ðŸ“¹ We're recording this browser tab to learn from your experience.
ðŸŽ¤ Please enable mic and camera if asked, to give us a complete picture.`),r=v("div","button",nn,"Read guidelines to begin");this.removeGreeting=()=>((t||s)&&this.userRecorder.startRecording(30,Tn.Standard,t,s),this.container.removeChild(r),this.container.removeChild(n),this.container.removeChild(i),!1),r.onclick=()=>{this.removeGreeting();var e=this.signalManager?.getDurations();e&&this.signalManager&&(e.testStart=this.app.timestamp(),this.signalManager.setDurations(e)),this.signalManager?.signalTest("begin"),this.container.style.fontFamily='-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',Object.assign(this.container.style,en),this.showWidget(this.test?.guidelines||"",this.test?.tasks||[])},this.container.append(i,n,r),this.bg.appendChild(this.container),document.body.appendChild(this.bg)}showWidget(e,t,s){this.container.innerHTML="",Object.assign(this.bg.style,{position:"fixed",zIndex:99999999999999,right:"8px",left:"unset",width:"fit-content",top:"8px",height:"fit-content",background:"unset",display:"unset",alignItems:"unset",justifyContent:"unset"});var i=this.createTitleSection(),e=(this.container.style.fontFamily='-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',Object.assign(this.container.style,en),this.createDescriptionSection(e)),t=this.createTasksSection(t),n=v("div","stop_bn_or",un,"Abort Session"),r=v("div","stop_ct_or",{fontSize:"13px!important"});r.style.fontSize="13px",r.append(n),this.container.append(i,e,t,r),this.taskSection=t,this.descriptionSection=e,this.stopButton=n,this.stopButtonContainer=r,n.onclick=()=>{this.userRecorder.discard(),this.signalManager?.signalTest("skipped"),document.body.removeChild(this.bg),window.close()},s?this.toggleDescriptionVisibility():this.hideTaskSection()}createTitleSection(){var e=v("div","title",an),t=(()=>{var t=document.createElement("div");t.className="grid";for(let e=0;e<16;e++){var s=document.createElement("div");Object.assign(s.style,{width:"2px",height:"2px",borderRadius:"10px",background:"white"}),s.className="cell",t.appendChild(s)}return Object.assign(t.style,{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gridTemplateRows:"repeat(4, 1fr)",gap:"2px",cursor:"grab"}),t})(),s=v("div","title_text",{maxWidth:"19rem",overflow:"hidden",textOverflow:"ellipsis",width:"100%",fontSize:16,lineHeight:"auto",cursor:"pointer"},this.test?.title);o=document.createElement("div"),Object.assign(o.style,{width:"0",height:"0",borderLeft:"7px solid transparent",borderRight:"7px solid transparent",borderBottom:"7px solid white"}),(r=document.createElement("div")).appendChild(o),Object.assign(r.style,{display:"flex",alignItems:"center",justifyContent:"center",width:"16px",height:"16px",cursor:"pointer",marginLeft:"auto",transform:"rotate(180deg)"});let i=r,n=(e.append(t,s,i),e=>(this.widgetVisible=e,this.container.style.fontFamily='-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',Object.assign(this.container.style,this.widgetVisible?en:{border:"none",background:"none",padding:0}),this.taskSection&&Object.assign(this.taskSection.style,this.widgetVisible?hn:{display:"none"}),this.descriptionSection&&Object.assign(this.descriptionSection.style,this.widgetVisible?hn:{display:"none"}),this.endSection&&Object.assign(this.endSection.style,this.widgetVisible?hn:{display:"none"}),this.stopButton&&Object.assign(this.stopButton.style,this.widgetVisible?un:{display:"none"}),e));var a,r,o=()=>{Object.assign(i.style,{transform:this.widgetVisible?"rotate(0deg)":"rotate(180deg)"}),n(!this.widgetVisible)};return s.onclick=o,i.onclick=o,a=this.bg,(r=t).onmousedown=function(e){let n=a.getBoundingClientRect(),r=e.clientX-n.left,o=e.clientY-n.top;function t(e,t){let s=e-r,i=t-o;s<=5&&(s=5),i<=5&&(i=5),s>=window.innerWidth-n.width&&(s=window.innerWidth-n.width),i>=window.innerHeight-n.height&&(i=window.innerHeight-n.height),a.style.left=s+"px",a.style.top=i+"px"}function s(e){t(e.pageX,e.pageY)}a.style.position="fixed",a.style.zIndex=99999999999999,t(e.pageX,e.pageY),document.addEventListener("mousemove",s);let i=()=>{document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",i)};document.addEventListener("mouseup",i)},r.ondragstart=function(){return!1},this.collapseWidget=()=>n(!1),e}createDescriptionSection(e){var t=v("div","description_section_or",hn),s=v("div","description_s_title_or",rn),i=v("div","title",{fontSize:13,fontWeight:500,lineHeight:"auto"},"Introduction & Guidelines");let n=v("div","icon",cn,"-"),r=v("div","content",on);var o=v("div","text_description",{maxHeight:"250px",overflowY:"auto",whiteSpace:"pre-wrap",fontSize:13,color:"#454545",lineHeight:"auto"});o.innerHTML=e;let a=v("div","button_begin_or",dn,"Begin Test"),h=(s.append(i,n),r.append(o,a),t.append(s,r),()=>{this.widgetGuidelinesVisible=!this.widgetGuidelinesVisible,n.textContent=this.widgetGuidelinesVisible?"-":"+",Object.assign(r.style,this.widgetGuidelinesVisible?on:{display:"none"})});return s.onclick=h,this.toggleDescriptionVisibility=()=>{this.widgetGuidelinesVisible=!1,n.textContent=this.widgetGuidelinesVisible?"-":"+",Object.assign(r.style,this.widgetGuidelinesVisible?on:{display:"none"}),r.removeChild(a)},a.onclick=()=>{var e,t;h(),this.test&&(t=(e=this.signalManager?.getDurations())?e.tasks.findIndex(e=>this.test&&e.taskId===this.test.tasks[0].task_id):null,e&&-1===t&&(e.tasks.push({taskId:this.test.tasks[0].task_id,started:this.app.timestamp()}),this.signalManager?.setDurations(e)),this.signalManager?.signalTask(this.test.tasks[0].task_id,"begin")),this.showTaskSection(),r.removeChild(a)},t}createTasksSection(t){this.container.style.fontFamily='-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',Object.assign(this.container.style,en);var e=v("div","task_section_or",hn),s=v("div","description_t_title_or",rn),i=v("div","title",{fontSize:"13px",fontWeight:"500",lineHeight:"auto"},"Tasks");let n=v("div","icon",cn,"-"),r=v("div","content",on),o=v("div","pagination",pn);var a=v("div","taskCard",mn);let h=v("div","taskText",vn),l=v("div","taskDescription",yn);var c=v("div","taskButtons",Sn),d=v("div","taskText",vn);d.textContent="Your answer";let u=v("textarea","taskDescription",{resize:"vertical"}),p=v("div","inputArea",mn);p.append(d,u);var d=v("div","closePanelButton",bn,"Collapse Panel"),f=v("div","nextButton",wn,"Done, Next");s.append(i,n),a.append(h,l),c.append(d,f),r.append(o,a,p,c),e.append(s,r);let g=()=>{var e=t[this.currentTaskIndex];h.textContent=e.title,l.textContent=e.description,p.style.display=e.allow_typing?"flex":"none"};t.forEach((e,t)=>{var s=v("span","or_task_"+t,{outline:"1px solid #efefef",fontSize:"13px",height:"24px",width:"24px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",borderRadius:"6.25em"},(t+1).toString());s.id="or_task_"+t,o.append(s)});this.hideTaskSection=()=>(n.textContent="+",Object.assign(r.style,{display:"none"}),this.widgetTasksVisible=!1),this.showTaskSection=()=>(n.textContent="-",Object.assign(r.style,on),this.widgetTasksVisible=!0);let m=()=>{var e=document.getElementById("or_task_"+this.currentTaskIndex);e&&Object.assign(e.style,fn);for(let e=0;e<this.currentTaskIndex;e++){var t=document.getElementById("or_task_"+e);t&&Object.assign(t.style,gn)}};return s.onclick=()=>{this.widgetTasksVisible=!this.widgetTasksVisible,n.textContent=this.widgetTasksVisible?"-":"+",Object.assign(r.style,this.widgetTasksVisible?on:{display:"none"})},d.onclick=this.collapseWidget,f.onclick=()=>{var e=t[this.currentTaskIndex].allow_typing?u.value:void 0;u.value="",this.signalManager?.signalTask(t[this.currentTaskIndex].task_id,"done",e),this.currentTaskIndex<t.length-1?(this.currentTaskIndex++,g(),(e=this.signalManager?.getDurations())&&-1===e.tasks.findIndex(e=>e.taskId===t[this.currentTaskIndex].task_id)&&(e.tasks.push({taskId:t[this.currentTaskIndex].task_id,started:this.app.timestamp()}),this.signalManager?.setDurations(e)),this.signalManager?.signalTask(t[this.currentTaskIndex].task_id,"begin"),m()):this.showEndSection(),this.app.localStorage.setItem("or_uxt_task_index",this.currentTaskIndex.toString())},setTimeout(()=>{var e=document.getElementById("or_task_0");e&&Object.assign(e.style,fn),g(),m()},1),e}showEndSection(){let t=!0;this.signalManager?.signalTest("done");var e=v("div","end_section_or",ln),s=v("div","end_title_or",{fontSize:"1.25rem",fontWeight:"500"},"Thank you! ðŸ‘"),i=v("div","end_description_or",{},this.test?.conclusion??"Thank you for participating in our usability test. Your feedback has been captured and will be used to enhance our website. \n\nWe appreciate your time and valuable input.");let n=v("div","end_button_or",dn,"Submitting Feedback"),r=_n();n.appendChild(r),this.test?.reqMic||this.test?.reqCamera?this.userRecorder.sendToAPI().then(()=>{n.removeChild(r),n.textContent="End Session",t=!1}).catch(e=>{console.error(e),n.removeChild(r),n.textContent="End Session",t=!1}):(n.removeChild(r),n.textContent="End Session",t=!1),this.taskSection&&this.container.removeChild(this.taskSection),this.descriptionSection&&this.container.removeChild(this.descriptionSection),this.stopButton&&this.stopButtonContainer&&this.container.removeChild(this.stopButtonContainer),n.onclick=()=>{t||(window.close(),document.body.removeChild(this.bg))},e.append(s,i,n),this.endSection=e,this.container.append(e)}}function Nn(e){return e&&null!=e.nodeType}function An(e){return"http://www.w3.org/2000/svg"===e.namespaceURI||"svg"===e.localName}function u(e){return e.nodeType===Node.ELEMENT_NODE}function Dn(e){return e.nodeType===Node.TEXT_NODE}function Mn(e){return e.nodeType===Node.DOCUMENT_NODE}function Ln(e){return e.nodeType===Node.DOCUMENT_NODE||e.nodeType===Node.DOCUMENT_FRAGMENT_NODE}function E(e,t){return e.localName===t}class Bn{constructor(e,t){this.app=e,this.options=t,this.snapshots={},this.intervals=[],this.restartTracking=()=>{this.clear(),this.app.nodes.scanTree(this.captureCanvas)},this.captureCanvas=e=>{let t=this.app.nodes.getID(e);t&&E(e,"canvas")&&(this.app.sanitizer.isObscured(t)||this.app.sanitizer.isHidden(t)||!E(e,"canvas")||this.snapshots[t]||new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(e.target?this.snapshots[t]&&this.snapshots[t].createdAt?this.snapshots[t].paused=!1:this.recordCanvas(e.target,t):this.snapshots[t]&&(this.snapshots[t].paused=!0))})}).observe(e))},this.recordCanvas=(s,o)=>{var e=this.app.timestamp(),e=(this.snapshots[o]={images:[],createdAt:e,paused:!1,dummy:document.createElement("canvas")},[119,o.toString(),e]);this.app.send(e);let i=e=>{var[e,t="medium",s,i=!1,n,r]=[e,this.options.quality,this.snapshots[o].dummy,this.options.fixedScaling,this.fileExt,e=>{if(e){if(!this.snapshots[o])return this.app.debug.warn("Canvas not present in snapshots after capture:",this.snapshots,o);this.snapshots[o].images.push({id:this.app.timestamp(),data:e}),9<this.snapshots[o].images.length&&(this.sendSnaps(this.snapshots[o].images,o,this.snapshots[o].createdAt),this.snapshots[o].images=[])}}];if(n="image/"+n,i){i=window.devicePixelRatio||1,i=(s.width=e.width/i,s.height=e.height/i,s.getContext("2d"));if(!i)return;i.clearRect(0,0,s.width,s.height),i.drawImage(e,0,0,s.width,s.height),s.toBlob(r,n,jn[t])}else e.toBlob(r,n,jn[t])},n=setInterval(()=>{var e=this.app.nodes.getID(s);let t=e?this.app.nodes.getNode(e):void 0;this.snapshots[o]?t&&E(t,"canvas")&&t===s?this.snapshots[o].paused||(this.options.useAnimationFrame?requestAnimationFrame(()=>{i(t)}):i(t)):(this.app.debug.log("Canvas element not in sync",t,s),clearInterval(n)):(this.app.debug.log("Canvas is not present in {snapshots}"),clearInterval(n))},this.interval);this.intervals.push(n)},this.fileExt=t.fileExt??"webp",this.interval=1e3/t.fps}startTracking(){setTimeout(()=>{this.app.nodes.scanTree(this.captureCanvas),this.app.nodes.attachNodeCallback(this.captureCanvas)},250)}sendSnaps(e,n,r){if(0!==Object.keys(this.snapshots).length){let i=new FormData,t=(e.forEach(e=>{var t,s=e.data;s&&(i.append("snapshot",s,r+`_${n}_${e.id}.`+this.fileExt),this.options.isDebug)&&(t=s,e=`${r}_${n}_${e.id}.`+this.fileExt,t=URL.createObjectURL(s),(s=document.createElement("a")).href=t,s.download=e,s.style.display="none",document.body.appendChild(s),s.click(),document.body.removeChild(s))}),()=>{this.app.debug.log("Restarting tracker; token expired"),this.app.stop(!1),setTimeout(()=>{this.app.start({},!0)},250)});fetch(this.app.options.ingestPoint+"/v1/web/images",{method:"POST",headers:{Authorization:"Bearer "+(this.app.session.getSessionToken()??"")},body:i}).then(e=>401!==e.status||t()).catch(e=>{this.app.debug.error("error saving canvas",e)})}}clear(){this.intervals.forEach(e=>clearInterval(e)),this.snapshots={}}}let jn={low:.35,medium:.55,high:.8},Fn={Verbose:5,Log:4,Warnings:3,Errors:2,Silent:0};class Pn{constructor(e=Fn.Silent){this.shouldLog=e=>this.level>=e,this.info=(...e)=>{this.shouldLog(Fn.Verbose)&&console.info(...e)},this.log=(...e)=>{this.shouldLog(Fn.Log)&&console.log(...e)},this.warn=(...e)=>{this.shouldLog(Fn.Warnings)&&console.warn(...e)},this.error=(...e)=>{this.shouldLog(Fn.Errors)&&console.error(...e)},this.level=e}}function Un(e,i,n){let r=e.entries();!function e(){var t=[];let s=r.next();for(;!s.done&&t.length<i;)t.push(s.value),s=r.next();0<t.length&&(t.forEach(([,e])=>{e&&n(e)}),setTimeout(e,50))}()}let qn={interval:3e4,batchSize:2500,enabled:!0};class Hn{constructor(e,t,s){this.nodes=e,this.unregisterNode=t,this.start=()=>{this.options.enabled&&(this.stop(),this.interval=setInterval(()=>{Un(this.nodes,this.options.batchSize,e=>{(e=>{try{var t,s,i;return e.isConnected?(s=(t=e.nodeType===Node.DOCUMENT_NODE)?e.defaultView:e.ownerDocument?.defaultView,i=t?e:e.ownerDocument,s?s.closed?[!1,"window closed"]:i?.documentElement.isConnected?[!0,"ok"]:[!1,"documentElement not connected"]:[!1,"no window"]):[!1,"not connected"]}catch(e){return[!1,e]}})(e)[0]||this.unregisterNode(e)})},this.options.interval))},this.stop=()=>{this.interval&&clearInterval(this.interval)},this.options={...qn,...s}}}class zn{constructor(e){this.nodes=new Map,this.totalNodeAmount=0,this.nodeCallbacks=[],this.elementListeners=new Map,this.nextNodeId=0,this.attachNodeCallback=e=>this.nodeCallbacks.push(e),this.scanTree=t=>{this.nodes.forEach(e=>e?t(e):void 0)},this.attachNodeListener=(t,s,i,n=!0)=>{var r=this.getID(t);if(void 0!==r){_i(t,s,i,n,this.forceNgOff);let e=this.elementListeners.get(r);void 0===e&&(e=[],this.elementListeners.set(r,e)),e.push([s,i,n])}},this.unregisterNode=t=>{var e,s=t[this.node_id];return void 0!==s&&(t[this.node_id]=void 0,delete t[this.node_id],this.nodes.delete(s),void 0!==(e=this.elementListeners.get(s))&&(this.elementListeners.delete(s),e.forEach(e=>Ci(t,e[0],e[1],e[2],this.forceNgOff))),this.totalNodeAmount--),s},this.node_id=e.node_id,this.forceNgOff=e.forceNgOff,this.maintainer=new Hn(this.nodes,this.unregisterNode,e.maintainer),this.maintainer.start()}syntheticMode(e){e*=99999999;if(Number.MAX_SAFE_INTEGER<e)throw new Error("Placeholder id overflow");this.nextNodeId=e}registerNode(e){let t=e[this.node_id];var s=void 0===t;return s&&(t=this.nextNodeId,this.totalNodeAmount++,this.nextNodeId++,this.nodes.set(t,e),e[this.node_id]=t),[t,s]}cleanTree(){for(var[e,t]of this.nodes)t&&!document.contains(t)&&this.unregisterNode(t)}callNodeCallbacks(t,s){this.nodeCallbacks.forEach(e=>e(t,s))}getID(e){if(e)return e[this.node_id]}getNode(e){return this.nodes.get(e)}getNodeCount(){return this.totalNodeAmount}clear(){for(var[e,t]of this.nodes)t&&this.unregisterNode(t);this.nextNodeId=0,this.nodes.clear()}}let Wn=99e6;function Vn(t,e,s,i,n,r,o,a,h){let l=a?null:i();a||r(l,e);i=t.sheet;if(i&&!o)try{var c=u(i);if(c)return void d(c)}catch(e){}function d(e){var t=(t=>{let s=[],i=!1,n=!1,r="",o=0,a="";for(let e=0;e<t.length;e++){var h=t[e],l=t[e+1]||"";n||"/"!==h||"*"!==l?i?"*"===h&&"/"===l&&(i=!1,e++):n||'"'!==h&&"'"!==h?n?(a+=h,h===r&&"\\"!==t[e-1]&&(n=!1)):(a+=h,"{"===h?o++:"}"===h&&0===--o&&(s.push(a.trim()),a="")):(n=!0,r=h,a+=h):(i=!0,e++)}return a.trim()&&s.push(a.trim()),s})(e=e.replace(/\/\*[\s\S]*?\*\//g,""));for(let e=0;e<t.length;e++)n(l,t[e],e,s)}function u(t){try{var s=t.rules||t.cssRules;if(!s)return null;let e=t.href;!e&&t.ownerNode&&t.ownerNode.ownerDocument&&(e=t.ownerNode.ownerDocument.location.href);var i=Array.from(s,s=>{var t=e;if("styleSheet"in s){let t;try{t=u(s.styleSheet)||(e=>{var t=e.cssText;return t.split('"').length<3?t:(t=["@import",`url(${JSON.stringify(e.href)})`],""===e.layerName?t.push("layer"):e.layerName&&t.push(`layer(${e.layerName})`),e.supportsText&&t.push(`supports(${e.supportsText})`),e.media.length&&t.push(e.media.mediaText),t.join(" ")+";")})(s)}catch(e){t=s.cssText}return s.styleSheet.href?p(t,s.styleSheet.href):t}{let e=s.cssText;return"selectorText"in s&&s.selectorText.includes(":")&&(e=(e=>e.replace(/(\[(?:[\w-]+)[^\\])(:(?:[\w-]+)\])/gm,"$1\\$2"))(e)),t?p(e,t):e}}).join("");return i=i.includes(" background-clip: text;")&&!i.includes(" -webkit-background-clip: text;")?i.replace(/\sbackground-clip:\s*text;/g," -webkit-background-clip: text; background-clip: text;"):i}catch(e){return null}}function p(e,h){if(!e)return"";let l=/^(?:[a-z+]+:)?\/\//i,c=/^www\..*/i,d=/^(data:)([^,]*),(.*)/i;return e.replace(/url\((?:(')([^']*)'|(")(.*?)"|([^)]*))\)/gm,(e,t,s,i,n,r)=>{s=s||n||r,n=t||i||"";if(!s)return e;if(l.test(s)||c.test(s))return`url(${n}${s}${n})`;if(d.test(s))return`url(${n}${s}${n})`;if("/"===s[0])return`url(${n}${(e=>{let t="";return t=(t=-1<e.indexOf("//")?e.split("/").slice(0,3).join("/"):e.split("/")[0]).split("?")[0]})(h)+s}${n})`;var o,a=h.split("/"),r=s.split("/");a.pop();for(o of r)"."!==o&&(".."===o?a.pop():a.push(o));return`url(${n}${a.join("/")}${n})`})}t.href&&fetch(t.href).then(e=>{if(e.ok)return e.text();throw new Error("response status "+e.status)}).then(e=>{a&&h?h(e,Wn++):d(e)}).catch(e=>{console.error(`OpenReplay: Failed to fetch CSS from ${t.href}:`,e)})}function $n(e){return Ln(e)&&e.adoptedStyleSheets}let Xn=15;function Kn(){return Xn++}let Jn=new Map,Gn={},Yn={};function Qn(e){var t,s;return e.nodeType===Node.COMMENT_NODE||!(Dn(e)||u(e)&&("LINK"===(t=e.tagName.toUpperCase())?(s=e.getAttribute("rel"),e=e.getAttribute("as"),s?.includes("stylesheet")||"style"===e||"font"===e):"SCRIPT"!==t&&"NOSCRIPT"!==t&&"META"!==t&&"TITLE"!==t&&"BASE"!==t))}function Zn(e){return Ln(e)||!Qn(e)}(t=d=d||{})[t.New=0]="New",t[t.Removed=1]="Removed",t[t.Changed=2]="Changed";class er{constructor(e,t=!1,s={}){this.app=e,this.isTopContext=t,this.commited=[],this.recents=new Map,this.indexes=[],this.attributesMap=new Map,this.textSet=new Set,this.disableSprites=!1,this.inlineRemoteCss=!1,this.inlinerOptions=void 0,this.domParser=new DOMParser,this.disableSprites=Boolean(s.disableSprites),this.inlineRemoteCss=Boolean(s.inlineRemoteCss),this.inlinerOptions=s.inlinerOptions,this.observer=Ei(this.app.safe(e=>{for(var t of e){var s=t.target,i=t.type;if(Zn(s))if("childList"===i){for(let e=0;e<t.removedNodes.length;e++)Zn(t.removedNodes[e])&&this.bindNode(t.removedNodes[e]);for(let e=0;e<t.addedNodes.length;e++)this.bindTree(t.addedNodes[e])}else{s=this.app.nodes.getID(s);if(void 0!==s)if(this.recents.has(s)||this.recents.set(s,d.Changed),"attributes"===i){var n=t.attributeName;if(null===n)continue;let e=this.attributesMap.get(s);void 0===e&&this.attributesMap.set(s,e=new Set),e.add(n)}else"characterData"===i&&this.textSet.add(s)}}this.commitNodes()}),this.app.options.forceNgOff)}clear(){this.commited.length=0,this.recents.clear(),this.indexes.length=1,this.attributesMap.clear(),this.textSet.clear()}handleIframeSrcChange(t){var s=t.contentDocument;if(s&&void 0!==this.app.nodes.getID(s)){var i=document.createTreeWalker(s,NodeFilter.SHOW_ELEMENT+NodeFilter.SHOW_TEXT,{acceptNode:e=>Qn(e)||void 0===this.app.nodes.getID(e)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT},!1);let e=0;for(var s=this.app.nodes.getNodeCount(),n=t.contentDocument,r=this.app.nodes.unregisterNode.bind(this.app.nodes);i.nextNode();)n.contains(i.currentNode)||(e+=1,r(i.currentNode));t=Math.floor(e/s*100);30<t&&this.app.send(zi(t))}}sendNodeAttribute(s,e,t,i){if(An(e))return t.startsWith("xlink:")&&(t=t.substring(6)),null===i&&this.app.send(Oi(s,t)),"use"!==e.localName||"href"!==t||this.disableSprites?void("href"===t?(1e5<i.length&&(i=""),this.app.send(Di(s,t,i,this.app.getBaseHref()))):this.app.attributeSender.sendSetAttribute(s,t,i)):void(async(e,t,s)=>{try{var i,r,o=e.getAttribute("xlink:href")||e.getAttribute("href");if(o){let[n,e]=o.split("#");if(!n&&e)return(i=document.querySelector(o))?(r=`
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="${i.getAttribute("viewBox")||"0 0 24 24"}">
          ${i.innerHTML}
        </svg>
      `,Gn[e]=r):void console.warn("Openreplay: Sprite symbol not found in the document.");if(n||e){if(Gn[e])return Gn[e];let i;Yn[n]?1===Yn[n]?await new Promise(e=>{let t=0,s=setInterval(()=>{100<t&&(clearInterval(s),e(!1)),1!==Yn[n]?(i=Yn[n],clearInterval(s),e(!0)):t++},100)}):i=Yn[n]??'<svg xmlns="http://www.w3.org/2000/svg"></svg>':(Yn[n]=1,a=await(await fetch(n)).text(),i=s.parseFromString(a,"image/svg+xml"),Yn[n]=i);var a,h,l=i.getElementById(e);return l?"svgtext"===t?(h=`
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="${l.getAttribute("viewBox")||"0 0 24 24"}">
          ${l.innerHTML}
        </svg>
      `,Gn[e]=h):void console.debug(`Openreplay: Unknown mode: ${t}. Use "inline" or "dataurl".`):(console.debug("Openreplay: Symbol not found in SVG."),"")}console.warn("Openreplay: Invalid xlink:href or href found on <use>.")}else console.debug("Openreplay: xlink:href or href not found on <use>.")}catch(e){console.error("Openreplay: Error processing <use> element:",e)}})(e,"svgtext",this.domParser).then(e=>{e&&this.app.send([12,s,t,"_$OPENREPLAY_SPRITE$_"+e])}).catch(e=>{console.error("Openreplay: Error parsing <use> element:",e)});if("src"!==t&&"srcset"!==t&&"integrity"!==t&&"crossorigin"!==t&&"autocomplete"!==t&&"on"!==t.substring(0,2)&&("value"!==t||!E(e,"input")||"button"===e.type||"reset"===e.type||"submit"===e.type))if(null===i)this.app.send(Oi(s,t));else{if("style"===t||"href"===t&&E(e,"link"))return"rel"in e&&"stylesheet"===e.rel&&this.inlineRemoteCss?void setTimeout(()=>{Vn(e,s,this.app.getBaseHref(),Kn,(e,t,s,i)=>{this.app.send(ji(e,t,s,i))},(e,t)=>{this.app.send(Pi(e,t))},this.inlinerOptions?.forceFetch,this.inlinerOptions?.forcePlain,(e,t)=>{this.app.send([9,t,s,0]),setTimeout(()=>{this.app.send(Mi(t,e,this.app.getBaseHref()))},10)})},0):void this.app.send(Di(s,t,i,this.app.getBaseHref()));("href"===t||1e5<i.length)&&(i=""),["alt","placeholder"].includes(t)&&this.app.sanitizer.privateMode&&(i=i.replaceAll(/./g,"*")),this.app.attributeSender.sendSetAttribute(s,t,i)}}sendNodeData(e,t,s){E(t,"style")?this.app.send(Mi(e,s,this.app.getBaseHref())):(s=this.app.sanitizer.sanitize(e,s),this.app.send([14,e,s]))}bindNode(e){var[e,t]=this.app.nodes.registerNode(e);t?this.recents.set(e,d.New):this.recents.get(e)!==d.New&&this.recents.set(e,d.Removed)}bindTree(e){if(Zn(e)){this.bindNode(e);for(var t=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT+NodeFilter.SHOW_TEXT,{acceptNode:e=>(void 0!==this.app.nodes.getID(e)&&this.app.debug.info("! Node is already bound",e),Qn(e)||void 0!==this.app.nodes.getID(e)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT)},!1);t.nextNode();)this.bindNode(t.currentNode)}}unbindTree(t){var s=this.app.nodes.unregisterNode(t);if(void 0!==s&&this.recents.get(s)===d.Removed){this.app.send([11,s]);var i=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT+NodeFilter.SHOW_TEXT,{acceptNode:e=>Qn(e)||void 0===this.app.nodes.getID(e)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT},!1);let e=0;for(s=this.app.nodes.getNodeCount();i.nextNode();)e+=1,this.app.nodes.unregisterNode(i.currentNode);t=Math.floor(e/s*100);30<t&&this.app.send(zi(t))}}_commitNode(i,n){if(!Ln(n)){var s=n.assignedSlot||n.parentNode;let t;if(!E(n,"html")||!this.isTopContext){if(null===s)return this.unbindTree(n),!1;if(void 0===(t=this.app.nodes.getID(s)))return this.unbindTree(n),!1;if(!this.commitNode(t))return this.unbindTree(n),!1;if(this.app.sanitizer.handleNode(i,t,n),this.app.sanitizer.isHidden(t))return!1}let e=n.previousSibling;for(;null!==e;){var r=this.app.nodes.getID(e);if(void 0!==r){this.commitNode(r),this.indexes[i]=this.indexes[r]+1;break}e=e.previousSibling}null===e&&(this.indexes[i]=0);var o,a=this.recents.get(i),h=a===d.New,l=this.indexes[i];if(void 0===l)throw"commitNode: missing node index";if(h)if(u(n)){let s=n;void 0!==t&&(this.app.sanitizer.isHidden(i)&&(h=s.clientWidth,o=s.clientHeight,(s=n.cloneNode()).style.width=h+"px",s.style.height=o+"px"),"rel"in s&&"stylesheet"===s.rel&&this.inlineRemoteCss?this.app.send([8,i,t,l,"STYLE",!1]):this.app.send([8,i,t,l,s.tagName,An(n)]));for(let t=0;t<s.attributes.length;t++){let e=s.attributes[t];this.sendNodeAttribute(i,s,e.nodeName,e.value)}}else Dn(n)&&(this.app.send([9,i,t,l]),this.sendNodeData(i,s,n.data));else{a===d.Removed&&void 0!==t&&this.app.send([10,i,t,l]);let e=this.attributesMap.get(i);if(void 0!==e){if(!u(n))throw"commitNode: node is not an element";for(var c of e)this.sendNodeAttribute(i,n,c,n.getAttribute(c))}if(this.textSet.has(i)){if(!Dn(n))throw"commitNode: node is not a text";this.sendNodeData(i,s,n.data)}}}return!0}commitNode(e){var t,s=this.app.nodes.getNode(e);return!!s&&(void 0!==(t=this.commited[e])?t:this.commited[e]=this._commitNode(e,s))}commitNodes(e=!1){let t;for(var[s,i]of this.recents.entries())this.commitNode(s),i===d.New&&(t=this.app.nodes.getNode(s))&&this.app.nodes.callNodeCallbacks(t,e);this.clear()}observeRoot(e,t,s=e){this.observer.observe(e,{childList:!0,attributes:!0,characterData:!0,subtree:!0,attributeOldValue:!1,characterDataOldValue:!1}),this.bindTree(s),t(this.app.nodes.getID(e)),this.commitNodes(!0)}disconnect(){this.observer.disconnect(),this.clear()}}class tr extends er{observe(e){var t=e.contentDocument;let s=this.app.nodes.getID(e);t&&void 0!==s&&this.observeRoot(t,e=>{void 0===e?this.app.debug.log("OpenReplay: Iframe document not bound"):(this.docId=e,this.app.send(Li(s,e)))})}syntheticObserve(t,e){this.observeRoot(e,e=>{void 0===e?this.app.debug.log("OpenReplay: Iframe document not bound"):this.app.send(Li(t,e))})}}class sr extends er{observe(e){var t=e.shadowRoot;let s=this.app.nodes.getID(e);t&&void 0!==s&&this.observeRoot(t,e=>{void 0===e?this.app.debug.error("OpenReplay: Shadow Root was not bound"):this.app.send(Li(s,e))})}}class ir{constructor(){this.states=new WeakMap}calcOffset(s){let e=0,t=0;if(s.parent&&([e,t]=this.calcOffset(s.parent)),!s.offset){let{left:e,top:t}=s.iFrame.getBoundingClientRect();s.offset=[e,t]}let[i,n]=s.offset;return[e+i,t+n]}getDocumentOffset(e){e=this.states.get(e);return e?this.calcOffset(e):[0,0]}observe(e){var t=e.contentDocument;if(!t)return;let s=e.ownerDocument,i={offset:null,iFrame:e,parent:this.states.get(s)||null,clear:()=>{s.removeEventListener("scroll",n),s.defaultView?.removeEventListener("resize",n)}},n=()=>{i.offset=null};s.addEventListener("scroll",n),s.defaultView?.addEventListener("resize",n),this.states.set(t,i)}clear(){this.states=new WeakMap}}(e=Cs=Cs||{})[e.Disabled=0]="Disabled",e[e.Inline=1]="Inline",e[e.InlineFetched=2]="InlineFetched",e[e.PlainFetched=3]="PlainFetched";let nr=S?Element.prototype.attachShadow:()=>new ShadowRoot;class rr extends er{constructor(e){var t=Object.assign({captureIFrames:!0,disableSprites:!1,inlineCss:0},e.options),s={disableSprites:t.disableSprites,...(e=>{switch(e){case Cs.Inline:return{inlineRemoteCss:!0,inlinerOptions:{forceFetch:!1,forcePlain:!1}};case Cs.InlineFetched:return{inlineRemoteCss:!0,inlinerOptions:{forceFetch:!0,forcePlain:!1}};case Cs.PlainFetched:return{inlineRemoteCss:!0,inlinerOptions:{forceFetch:!0,forcePlain:!0}};default:Cs.Disabled;return{inlineRemoteCss:!1,inlinerOptions:{forceFetch:!1,forcePlain:!1}}}})(t.inlineCss)};super(e.app,!0,s),this.iframeOffsets=new ir,this.contextCallbacks=[],this.contextsSet=new WeakSet,this.iframeObserversArr=[],this.iframeObservers=new WeakMap,this.docObservers=new WeakMap,this.shadowRootObservers=new WeakMap,this.app=e.app,this.options=t,this.app.nodes.attachNodeCallback(e=>{E(e,"iframe")&&(this.options.captureIFrames&&!l(e,"obscured")||l(e,"capture"))&&this.handleIframe(e)}),this.app.nodes.attachNodeCallback(e=>{u(e)&&null!==e.shadowRoot&&this.handleShadowRoot(e.shadowRoot)})}attachContextCallback(e){this.contextCallbacks.push(e)}getDocumentOffset(e){return this.iframeOffsets.getDocumentOffset(e)}handleIframe(i){var e=this.app.safe(()=>setTimeout(()=>{var e=this.app.nodes.getID(i);if(void 0!==e&&(e=>{try{return Boolean(e.contentDocument)}catch(e){}})(i)){let t=i.contentWindow;var s=i.contentDocument;s?s&&this.docObservers.has(s)?this.app.debug.info("doc already observed for",e):(e=new tr(this.app,!1,{}),this.iframeObservers.set(i,e),this.docObservers.set(s,e),this.iframeObserversArr.push(e),e.observe(i),this.iframeOffsets.observe(i),t&&t===t.window&&!this.contextsSet.has(t)&&(this.contextsSet.add(t),this.contextCallbacks.forEach(e=>e(t)))):this.app.debug.warn("no doc for iframe found",i)}},250));i.addEventListener("load",e),e()}handleShadowRoot(e){var t=new sr(this.app);this.shadowRootObservers.set(e,t),t.observe(e.host)}observe(){let t=this;Element.prototype.attachShadow=function(){var e=nr.apply(this,arguments);return t.handleShadowRoot(e),e},this.app.nodes.clear(),this.observeRoot(window.document,()=>{this.app.send([7]),this.app.nodes.callNodeCallbacks(document,!0)},window.document.documentElement)}crossdomainObserve(e,t){let s=this;Element.prototype.attachShadow=function(){var e=nr.apply(this,arguments);return s.handleShadowRoot(e),e},this.app.nodes.clear(),this.app.nodes.syntheticMode(t);t=new tr(this.app);this.iframeObservers.set(window.document,t),t.syntheticObserve(e,window.document)}disconnect(){this.iframeOffsets.clear(),Element.prototype.attachShadow=nr,this.iframeObserversArr.forEach(e=>e.disconnect()),this.iframeObserversArr=[],this.iframeObservers=new WeakMap,this.shadowRootObservers=new WeakMap,this.docObservers=new WeakMap,super.disconnect()}}(t=Is=Is||{})[t.Plain=0]="Plain",t[t.Obscured=1]="Obscured",t[t.Hidden=2]="Hidden";let or=e=>e.trim().replace(/[^\f\n\r\t\v\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff\s]/g,"*");class ar{constructor(e){this.obscured=new Set,this.hidden=new Set,this.app=e.app;var t={obscureTextEmails:!0,obscureTextNumbers:!1,privateMode:!1,domSanitizer:void 0};this.privateMode=e.options?.privateMode??!1,this.options=Object.assign(t,e.options)}handleNode(e,t,s){if(this.options.privateMode){if(u(s)&&!l(s,"unmask"))return this.obscured.add(e);if(Dn(s)&&!l(s.parentNode,"unmask"))return this.obscured.add(e)}(this.obscured.has(t)||u(s)&&(l(s,"masked")||l(s,"obscured")))&&this.obscured.add(e),(this.hidden.has(t)||u(s)&&(l(s,"htmlmasked")||l(s,"hidden")))&&this.hidden.add(e),void 0!==this.options.domSanitizer&&u(s)&&((t=this.options.domSanitizer(s))===Is.Obscured&&this.obscured.add(e),t===Is.Hidden)&&this.hidden.add(e)}sanitize(e,t){return this.obscured.has(e)?or(t):(this.options.obscureTextNumbers&&(t=t.replace(/\d/g,"0")),this.options.obscureTextEmails?t.replace(/^\w+([+.-]\w+)*@\w+([.-]\w+)*\.\w{2,3}$/g,e=>{var[e,t]=e.split("@"),[t,s]=t.split(".");return`${fi(e)}@${fi(t)}.`+fi(s)}):t)}isObscured(e){return this.obscured.has(e)}isHidden(e){return this.hidden.has(e)}getInnerTextSecure(e){var t=this.app.nodes.getID(e);return t?this.sanitize(t,e.innerText):""}clear(){this.obscured.clear(),this.hidden.clear()}}class hr{constructor(e){this.metadata={},this.userID=null,this.callbacks=[],this.timestamp=0,this.getPageNumber=()=>{var e=this.app.sessionStorage.getItem(this.options.session_pageno_key);if(null!=e)return parseInt(e)},this.incPageNo=()=>{let e=this.getPageNumber();return void 0===e?e=0:e++,this.app.sessionStorage.setItem(this.options.session_pageno_key,e.toString()),e},this.app=e.app,this.options=e.options,this.createTabId()}attachUpdateCallback(e){this.callbacks.push(e)}handleUpdate(t){null==t.userID&&delete t.userID,null==t.sessionID&&delete t.sessionID,this.callbacks.forEach(e=>e(t))}assign(e){void 0!==e.userID&&(this.userID=e.userID),void 0!==e.metadata&&Object.entries(e.metadata).forEach(([e,t])=>this.metadata[e]=t),void 0!==e.sessionID&&(this.sessionID=e.sessionID),void 0!==e.timestamp&&(this.timestamp=e.timestamp),void 0!==e.projectID&&(this.projectID=e.projectID),this.handleUpdate(e)}setMetadata(e,t){this.metadata[e]=t,this.handleUpdate({metadata:{[e]:t}})}setUserID(e){this.userID=e,this.handleUpdate({userID:e})}setUserInfo(e){this.userInfo=e}getSessionToken(){return this.token||this.app.sessionStorage.getItem(this.options.session_token_key)||void 0}setSessionToken(e){this.token=e,this.app.sessionStorage.setItem(this.options.session_token_key,e)}applySessionHash(e){var t=decodeURI(e).split("&");let s=e,i="100500";2==t.length&&([i,s]=t),i&&s&&(this.app.sessionStorage.setItem(this.options.session_token_key,s),this.app.sessionStorage.setItem(this.options.session_pageno_key,i))}getSessionHash(){var e=this.getPageNumber(),t=this.getSessionToken();if(void 0!==e&&void 0!==t)return encodeURI(String(e)+"&"+t)}getTabId(){return this.tabId||this.createTabId(),this.tabId}regenerateTabId(){e=12,t=new Uint8Array(e/2);var e,t,s=((s=window.crypto||window.msCrypto)?(s.getRandomValues(t),Array.from(t,Si)):Array.from({length:e},()=>Si(Math.floor(16*Math.random())))).join("");this.app.sessionStorage.setItem(this.options.session_tabid_key,s),this.tabId=s}createTabId(){var e=this.app.sessionStorage.getItem(this.options.session_tabid_key);e?this.tabId=e:this.regenerateTabId()}getInfo(){return{sessionID:this.sessionID,metadata:this.metadata,userID:this.userID,timestamp:this.timestamp,projectID:this.projectID}}reset(){this.app.sessionStorage.removeItem(this.options.session_token_key),this.metadata={},this.userID=null,this.sessionID=void 0,this.timestamp=0}}class lr{constructor(e){this.app=e,this.timer=null,this.callbacks=[]}attach(e,t=0,s=!0,i){i&&(e=e.bind(i)),s&&(e=this.app.safe(e)),this.callbacks.unshift(t?((e,t)=>{let s=0;return()=>{s++>=t&&(s=0,e())}})(e,t):e)}start(){null===this.timer&&(this.timer=setInterval(()=>this.callbacks.forEach(e=>{e&&e()}),30))}stop(){null!==this.timer&&(clearInterval(this.timer),this.timer=null)}}let cr="canceled",dr="or_uxt_active",ur="or_buffer_1",q=e=>({reason:e,success:!1}),pr=e=>({...e,success:!0});function fr(){var e=-1*(new Date).getTimezoneOffset(),t=0<=e?"+":"-",s=Math.floor(Math.abs(e)/60),e=Math.abs(e)%60;return`UTC${t}${String(s).padStart(2,"0")}:`+String(e).padStart(2,"0")}(e=L=L||{})[e.NotActive=0]="NotActive",e[e.Starting=1]="Starting",e[e.Active=2]="Active",e[e.ColdStart=3]="ColdStart";let f={ask:"never-gonna-give-you-up",resp:"never-gonna-let-you-down",reg:"never-gonna-run-around-and-desert-you",iframeSignal:"tracker inside a child iframe",iframeId:"getting node id for child iframe",iframeBatch:"batch of messages from an iframe window",parentAlive:"signal that parent is live",killIframe:"stop tracker inside frame",startIframe:"start tracker inside frame",polling:"hello-how-are-you-im-under-the-water-please-help-me"};class gr{constructor(e,t,s,i,n){this.signalError=i,this.insideIframe=n,this.messages=[],this.bufferedMessages1=[],this.bufferedMessages2=[],this.startCallbacks=[],this.stopCallbacks=[],this.commitCallbacks=[],this.activityState=L.NotActive,this.version="16.2.1",this.socketMode=!1,this.compressionThreshold=24e3,this.bc=null,this.canvasRecorder=null,this.conditionsManager=null,this.canStart=!1,this.rootId=null,this.pageFrames=[],this.frameOderNumber=0,this.features={"feature-flags":!0,"usability-test":!0},this.emptyBatchCounter=0,this.parentActive=!1,this.checkStatus=()=>this.parentActive,this.parentCrossDomainFrameListener=e=>{var t=e.data;if(t&&e.source!==window){if(t.line===f.startIframe){if(this.active())return;try{this.allowAppStart(),this.start()}catch(e){console.error("children frame restart failed:",e)}}t.line===f.parentAlive&&(this.parentActive=!0),t.line===f.iframeId&&(this.parentActive=!0,this.rootId=t.id,this.session.setSessionToken(t.token),this.frameOderNumber=t.frameOrderNumber,this.debug.log("starting iframe tracking",t),this.allowAppStart()),t.line===f.killIframe&&this.active()&&this.stop()}},this.trackedFrames=[],this.crossDomainIframeListener=p=>{if(this.active()&&p.source!==window){let n=p.data;var e;if(n)if(n.line===f.iframeSignal&&(p.source?.postMessage({ping:!0,line:f.parentAlive},"*"),(async()=>{if(null===p.source)return console.error("Couldnt connect to event.source for child iframe tracking");var e=await this.checkNodeId(p.source);if(e)try{this.trackedFrames.includes(n.context)?this.debug.log("Trying to observe already added iframe; ignore if its a restart"):this.trackedFrames.push(n.context),await this.waitStarted();var t=this.session.getSessionToken(),s=this.trackedFrames.findIndex(e=>e===n.context)+1,i=(0===s&&this.debug.error("Couldnt get order number for iframe",n.context,this.trackedFrames),{line:f.iframeId,id:e,token:t,frameOrderNumber:s});this.debug.log("Got child frame signal; nodeId",e,p.source,i),p.source?.postMessage(i,"*")}catch(e){console.error(e)}else this.debug.log("Couldnt get node id for iframe",p.source)})()),n.line===f.iframeBatch&&(e=n.messages.map(u=>{if(20===u[0]){let r=u;return this.pageFrames.forEach(e=>{var t,s,i,n;e.contentWindow===p.source&&([t,s,i]=u,{left:e,top:n}=e.getBoundingClientRect(),r=[t,s+e,i+n])}),r}if(68!==u[0])return u;{let d=u;return this.pageFrames.forEach(e=>{var t,s,i,n,r,o,a,h,l,c;e.contentWindow===p.source&&([t,s,i,n,r,l,o]=u,{left:e,top:a,width:c,height:h}=e.getBoundingClientRect(),l=(l/100*c+e)/document.documentElement.scrollWidth,c=(o/100*h+a)/document.documentElement.scrollHeight,d=[t,s,i,n,r,Math.round(1e3*l)/10,Math.round(1e3*c)/10])}),d}}),this.messages.push(...e)),n.line===f.polling&&this.pollingQueue.order.length){let t=this.pollingQueue.order[0];t&&0===this.pollingQueue[t].length?this.pollingQueue.order=this.pollingQueue.order.filter(e=>e!==t):this.pollingQueue[t].includes(n.context)&&(this.pollingQueue[t]=this.pollingQueue[t].filter(e=>e!==n.context),p.source?.postMessage({line:t},"*"),0===this.pollingQueue[t].length)&&this.pollingQueue.order.shift()}}},this.pollingQueue={order:[]},this.addCommand=e=>{this.pollingQueue.order.push(e),this.pollingQueue[e]=[...this.trackedFrames]},this.bootChildrenFrames=async()=>{await this.waitStarted(),this.addCommand(f.startIframe)},this.killChildrenFrames=()=>{this.addCommand(f.killIframe)},this.signalIframeTracker=()=>{let e=this.session.getTabId();window.parent.postMessage({line:f.iframeSignal,source:e,context:this.contextId},this.options.crossdomain?.parentDomain??"*");let t=0,s=250,i=0,n=!1,r=()=>{n||this.checkStatus()?n=!0:(window.parent.postMessage({line:f.iframeSignal,source:e,context:this.contextId},this.options.crossdomain?.parentDomain??"*"),this.debug.info("Trying to signal to parent, attempt:",t+1),t++)};for(let e=0;e<10;e++){if(this.checkStatus()){n=!0;break}i+=s,setTimeout(()=>{r()},i),s*=1.5}},this.startTimeout=null,this.send=(e,t=!1)=>{this.activityState!==L.NotActive&&(this.activityState===L.ColdStart?(this.bufferedMessages1.push(e),this.singleBuffer||this.bufferedMessages2.push(e),this.conditionsManager?.processMessage(e)):this.messages.push(e),this.activityState===L.Active)&&t&&this.commit()},this.coldStartCommitN=0,this.delay=0,this.attachStartCallback=(e,t=!1)=>{t&&(e=this.safe(e)),this.startCallbacks.push(e)},this.attachStopCallback=(e,t=!1)=>{t&&(e=this.safe(e)),this.stopCallbacks.push(e)},this.attachEventListener=(e,t,s,i=!0,n=!0)=>{i&&(s=this.safe(s));this.attachStartCallback(()=>e?_i(e,t,s,n,this.options.forceNgOff):null,i),this.attachStopCallback(()=>e?Ci(e,t,s,n,this.options.forceNgOff):null,i)},this.coldInterval=null,this.orderNumber=0,this.coldStartTs=0,this.singleBuffer=!1,this.onSessionSent=()=>{},this.prevOpts={},this.restartCanvasTracking=()=>{this.canvasRecorder?.restartTracking()},this.flushBuffer=async n=>new Promise((s,i)=>{if(0===n.length)s(null);else{let t=1;for(;t<n.length&&0!==n[t][0];)t++;xi(()=>{try{var e=n.splice(0,t);this.postToWorker(e.map(e=>[...e])),s(null)}catch(e){this._debug("flushBuffer",e),i(new Error("flushBuffer failed"))}})}}),this.onUxtCb=[],this.contextId=Math.random().toString(36).slice(2),this.projectKey=e,this.networkOptions=s.network;i={revID:"",node_id:"__openreplay_id",session_token_key:"__openreplay_token",session_pageno_key:"__openreplay_pageno",session_reset_key:"__openreplay_reset",session_tabid_key:"__openreplay_tabid",local_uuid_key:"__openreplay_uuid",ingestPoint:"https://api.openreplay.com/ingest",resourceBaseHref:null,__is_snippet:!1,__debug_report_edp:null,__debug__:Fn.Silent,localStorage:null,sessionStorage:null,forceSingleTab:!1,assistSocketHost:"",captureIFrames:!0,obscureTextEmails:!1,obscureTextNumbers:!1,disableStringDict:!1,crossdomain:{parentDomain:"*"},canvas:{disableCanvas:!1,fixedCanvasScaling:!1,__save_canvas_locally:!1,useAnimationFrame:!1},forceNgOff:!1,inlineCss:0,disableSprites:!1};this.options=function e(t,s){var i,n,r,o={...t};for(i in s)s.hasOwnProperty(i)&&(n=s[i],r=t[i],"object"!=typeof n||Array.isArray(n)||null===n?o[i]=n:o[i]=e(r||{},n));return o}(i,s),!this.insideIframe&&!this.options.forceSingleTab&&globalThis&&"BroadcastChannel"in globalThis?(n=location.hostname.split(".").slice(-2).join("_"),this.bc=new BroadcastChannel("rick_"+n)):this.options.forceSingleTab&&this.allowAppStart(),this.revID=this.options.revID,this.localStorage=this.options.localStorage??window.localStorage,this.sessionStorage=this.options.sessionStorage??window.sessionStorage,this.sanitizer=new ar({app:this,options:s}),this.nodes=new zn({node_id:this.options.node_id,forceNgOff:Boolean(s.forceNgOff),maintainer:this.options.nodes?.maintainer}),this.observer=new rr({app:this,options:s}),this.ticker=new lr(this),this.ticker.attach(()=>this.commit()),this.debug=new Pn(this.options.__debug__),this.session=new hr({app:this,options:this.options}),this.attributeSender=new oi({app:this,isDictDisabled:Boolean(this.options.disableStringDict||this.options.crossdomain?.enabled)}),this.featureFlags=new ci(this),this.tagWatcher=new Yi({sessionStorage:this.sessionStorage,errLog:this.debug.error,onTag:e=>this.send([120,e])}),this.session.attachUpdateCallback(({userID:e,metadata:t})=>{null!=e&&this.send([28,e]),null!=t&&Object.entries(t).forEach(([e,t])=>this.send(Ri(e,t)))}),null!=t&&this.session.applySessionHash(t);let r=this.session.getTabId();this.insideIframe?(window.addEventListener("message",this.parentCrossDomainFrameListener),setInterval(()=>{document.hidden||window.parent.postMessage({line:f.polling,context:this.contextId},s.crossdomain?.parentDomain??"*")},250)):(this.initWorker(),window.addEventListener("message",this.crossDomainIframeListener)),null!==this.bc&&(this.bc.postMessage({line:f.ask,source:r,context:this.contextId}),this.startTimeout=setTimeout(()=>{this.allowAppStart()},250),this.bc.onmessage=e=>{var t,s;e.data.context!==this.contextId&&(this.debug.log(e),e.data.line===f.resp&&(t=e.data.token,this.session.setSessionToken(t),this.allowAppStart()),e.data.line===f.reg&&(t=e.data.token,this.session.regenerateTabId(),this.session.setSessionToken(t),this.allowAppStart()),e.data.line===f.ask)&&(s=this.session.getSessionToken())&&this.bc&&this.bc.postMessage({line:e.data.source===r?f.reg:f.resp,token:s,source:r,context:this.contextId})})}allowAppStart(){this.canStart=!0,this.startTimeout&&(clearTimeout(this.startTimeout),this.startTimeout=null)}async checkNodeId(t){let s;var e;if((s=0<this.pageFrames.length?this.pageFrames.find(e=>e.contentWindow===t):s)&&this.pageFrames.length||(e=Array.from(document.querySelectorAll("iframe")),this.pageFrames=e,s=e.find(e=>e.contentWindow===t)),s){let e=0;for(;e<100;){var i=s[this.options.node_id];if(void 0!==i)return e=100,i;e++,await(t=>new Promise(e=>setTimeout(e,t)))(100)}}return null}initWorker(){try{this.worker=new Worker(URL.createObjectURL(new Blob(['!function(){"use strict";class t{constructor(t,s,i,e=10,n=250,h,r){this.onUnauthorised=s,this.onFailure=i,this.MAX_ATTEMPTS_COUNT=e,this.ATTEMPT_TIMEOUT=n,this.onCompress=h,this.pageNo=r,this.attemptsCount=0,this.busy=!1,this.queue=[],this.token=null,this.lastBatchNum=0,this.ingestURL=t+"/v1/web/i",this.isCompressing=void 0!==h}getQueueStatus(){return 0===this.queue.length&&!this.busy}authorise(t){this.token=t,this.busy||this.sendNext()}push(t){if(this.busy||!this.token)this.queue.push(t);else if(this.busy=!0,this.isCompressing&&this.onCompress)this.onCompress(t);else{const s=++this.lastBatchNum;this.sendBatch(t,!1,s)}}sendNext(){const t=this.queue.shift();if(t)if(this.busy=!0,this.isCompressing&&this.onCompress)this.onCompress(t);else{const s=++this.lastBatchNum;this.sendBatch(t,!1,s)}else this.busy=!1}retry(t,s,i){this.attemptsCount>=this.MAX_ATTEMPTS_COUNT?this.onFailure(`Failed to send batch after ${this.attemptsCount} attempts.`):(this.attemptsCount++,setTimeout((()=>this.sendBatch(t,s,i)),this.ATTEMPT_TIMEOUT*this.attemptsCount))}sendBatch(t,s,i){var e;const n=null==i?void 0:i.toString().replace(/^([^_]+)_([^_]+).*/,"$1_$2_$3");this.busy=!0;const h={Authorization:`Bearer ${this.token}`};s&&(h["Content-Encoding"]="gzip"),null!==this.token?fetch(`${this.ingestURL}?batch=${null!==(e=this.pageNo)&&void 0!==e?e:"noPageNum"}_${null!=n?n:"noBatchNum"}`,{body:t,method:"POST",headers:h,keepalive:t.length<65536}).then((e=>{if(401===e.status)return this.busy=!1,void this.onUnauthorised();e.status>=400?this.retry(t,s,`${null!=i?i:"noBatchNum"}_network:${e.status}`):(this.attemptsCount=0,this.sendNext())})).catch((e=>{console.warn("OpenReplay:",e),this.retry(t,s,`${null!=i?i:"noBatchNum"}_reject:${e.message}`)})):setTimeout((()=>{this.sendBatch(t,s,`${null!=i?i:"noBatchNum"}_newToken`)}),500)}sendCompressed(t){const s=++this.lastBatchNum;this.sendBatch(t,!0,s)}sendUncompressed(t){const s=++this.lastBatchNum;this.sendBatch(t,!1,s)}clean(){this.sendNext(),setTimeout((()=>{this.token=null,this.queue.length=0}),10)}}const s="function"==typeof TextEncoder?new TextEncoder:{encode(t){const s=t.length,i=new Uint8Array(3*s);let e=-1;for(let n=0,h=0,r=0;r!==s;){if(n=t.charCodeAt(r),r+=1,n>=55296&&n<=56319){if(r===s){i[e+=1]=239,i[e+=1]=191,i[e+=1]=189;break}if(h=t.charCodeAt(r),!(h>=56320&&h<=57343)){i[e+=1]=239,i[e+=1]=191,i[e+=1]=189;continue}if(n=1024*(n-55296)+h-56320+65536,r+=1,n>65535){i[e+=1]=240|n>>>18,i[e+=1]=128|n>>>12&63,i[e+=1]=128|n>>>6&63,i[e+=1]=128|63&n;continue}}n<=127?i[e+=1]=0|n:n<=2047?(i[e+=1]=192|n>>>6,i[e+=1]=128|63&n):(i[e+=1]=224|n>>>12,i[e+=1]=128|n>>>6&63,i[e+=1]=128|63&n)}return i.subarray(0,e+1)}};class i{constructor(t){this.size=t,this.offset=0,this.checkpointOffset=0,this.data=new Uint8Array(t)}getCurrentOffset(){return this.offset}checkpoint(){this.checkpointOffset=this.offset}get isEmpty(){return 0===this.offset}skip(t){return this.offset+=t,this.offset<=this.size}set(t,s){this.data.set(t,s)}boolean(t){return this.data[this.offset++]=+t,this.offset<=this.size}uint(t){for((t<0||t>Number.MAX_SAFE_INTEGER)&&(t=0);t>=128;)this.data[this.offset++]=t%256|128,t=Math.floor(t/128);return this.data[this.offset++]=t,this.offset<=this.size}int(t){return t=Math.round(t),this.uint(t>=0?2*t:-2*t-1)}string(t){const i=s.encode(t),e=i.byteLength;return!(!this.uint(e)||this.offset+e>this.size)&&(this.data.set(i,this.offset),this.offset+=e,!0)}reset(){this.offset=0,this.checkpointOffset=0}flush(){const t=this.data.slice(0,this.checkpointOffset);return this.reset(),t}}class e extends i{encode(t){switch(t[0]){case 0:case 11:case 114:case 115:return this.uint(t[1]);case 4:case 44:case 47:return this.string(t[1])&&this.string(t[2])&&this.uint(t[3]);case 5:case 20:case 70:case 75:case 76:case 77:case 82:return this.uint(t[1])&&this.uint(t[2]);case 6:return this.int(t[1])&&this.int(t[2]);case 7:return!0;case 8:return this.uint(t[1])&&this.uint(t[2])&&this.uint(t[3])&&this.string(t[4])&&this.boolean(t[5]);case 9:case 10:case 24:case 35:case 51:return this.uint(t[1])&&this.uint(t[2])&&this.uint(t[3]);case 12:case 52:case 61:case 71:return this.uint(t[1])&&this.string(t[2])&&this.string(t[3]);case 13:case 14:case 17:case 34:case 50:case 54:return this.uint(t[1])&&this.string(t[2]);case 16:return this.uint(t[1])&&this.int(t[2])&&this.int(t[3]);case 18:return this.uint(t[1])&&this.string(t[2])&&this.int(t[3]);case 19:return this.uint(t[1])&&this.boolean(t[2]);case 21:return this.string(t[1])&&this.string(t[2])&&this.string(t[3])&&this.string(t[4])&&this.string(t[5])&&this.uint(t[6])&&this.uint(t[7])&&this.uint(t[8]);case 22:case 27:case 30:case 41:case 45:case 46:case 43:case 63:case 64:case 79:case 124:return this.string(t[1])&&this.string(t[2]);case 23:return this.uint(t[1])&&this.uint(t[2])&&this.uint(t[3])&&this.uint(t[4])&&this.uint(t[5])&&this.uint(t[6])&&this.uint(t[7])&&this.uint(t[8])&&this.uint(t[9]);case 28:case 29:case 42:case 117:case 118:return this.string(t[1]);case 40:return this.string(t[1])&&this.uint(t[2])&&this.string(t[3])&&this.string(t[4]);case 48:return this.string(t[1])&&this.string(t[2])&&this.string(t[3])&&this.string(t[4])&&this.int(t[5]);case 49:return this.int(t[1])&&this.int(t[2])&&this.uint(t[3])&&this.uint(t[4]);case 53:return this.uint(t[1])&&this.uint(t[2])&&this.uint(t[3])&&this.uint(t[4])&&this.uint(t[5])&&this.uint(t[6])&&this.string(t[7])&&this.string(t[8]);case 55:return this.boolean(t[1]);case 57:case 60:return this.uint(t[1])&&this.string(t[2])&&this.string(t[3])&&this.string(t[4]);case 58:case 120:return this.int(t[1]);case 68:return this.uint(t[1])&&this.uint(t[2])&&this.string(t[3])&&this.string(t[4])&&this.uint(t[5])&&this.uint(t[6]);case 69:return this.uint(t[1])&&this.uint(t[2])&&this.string(t[3])&&this.string(t[4]);case 73:return this.uint(t[1])&&this.string(t[2])&&this.uint(t[3])&&this.string(t[4]);case 78:return this.string(t[1])&&this.string(t[2])&&this.string(t[3])&&this.string(t[4]);case 81:return this.uint(t[1])&&this.uint(t[2])&&this.uint(t[3])&&this.int(t[4])&&this.string(t[5]);case 83:return this.string(t[1])&&this.string(t[2])&&this.string(t[3])&&this.string(t[4])&&this.string(t[5])&&this.uint(t[6])&&this.uint(t[7])&&this.uint(t[8])&&this.uint(t[9]);case 84:return this.string(t[1])&&this.string(t[2])&&this.string(t[3])&&this.uint(t[4])&&this.string(t[5])&&this.string(t[6]);case 112:return this.uint(t[1])&&this.string(t[2])&&this.boolean(t[3])&&this.string(t[4])&&this.int(t[5])&&this.int(t[6]);case 113:return this.uint(t[1])&&this.uint(t[2])&&this.string(t[3]);case 116:return this.uint(t[1])&&this.uint(t[2])&&this.uint(t[3])&&this.uint(t[4])&&this.uint(t[5])&&this.uint(t[6])&&this.string(t[7])&&this.string(t[8])&&this.uint(t[9])&&this.boolean(t[10]);case 119:return this.string(t[1])&&this.uint(t[2]);case 121:return this.string(t[1])&&this.string(t[2])&&this.uint(t[3])&&this.uint(t[4]);case 122:return this.string(t[1])&&this.string(t[2])&&this.uint(t[3])&&this.string(t[4]);case 123:return this.string(t[1])&&this.string(t[2])&&this.string(t[3])&&this.string(t[4])&&this.uint(t[5])}}}class n{constructor(t,s,i,n,h,r){this.pageNo=t,this.timestamp=s,this.url=i,this.onBatch=n,this.tabId=h,this.onOfflineEnd=r,this.nextIndex=0,this.beaconSize=2e5,this.encoder=new e(this.beaconSize),this.sizeBuffer=new Uint8Array(3),this.isEmpty=!0,this.beaconSizeLimit=1e6,this.prepare()}writeType(t){return this.encoder.uint(t[0])}writeFields(t){return this.encoder.encode(t)}writeSizeAt(t,s){for(let s=0;s<3;s++)this.sizeBuffer[s]=t>>8*s;this.encoder.set(this.sizeBuffer,s)}prepare(){if(!this.encoder.isEmpty)return;const t=[81,1,this.pageNo,this.nextIndex,this.timestamp,this.url],s=[0,this.timestamp],i=[118,this.tabId];this.writeType(t),this.writeFields(t),this.writeWithSize(s),this.writeWithSize(i),this.isEmpty=!0}writeWithSize(t){const s=this.encoder;if(!this.writeType(t)||!s.skip(3))return!1;const i=s.getCurrentOffset(),e=this.writeFields(t);if(e){const e=s.getCurrentOffset()-i;if(e>16777215)return console.warn("OpenReplay: max message size overflow."),!1;this.writeSizeAt(e,i-3),s.checkpoint(),this.isEmpty=this.isEmpty&&0===t[0],this.nextIndex++}return e}setBeaconSizeLimit(t){this.beaconSizeLimit=t}writeMessage(t){if("q_end"===t[0])return this.finaliseBatch(),this.onOfflineEnd();0===t[0]&&(this.timestamp=t[1]),122===t[0]&&(this.url=t[1]),this.writeWithSize(t)||(this.finaliseBatch(),this.writeWithSize(t)||(this.encoder=new e(this.beaconSizeLimit),this.prepare(),this.writeWithSize(t)?this.finaliseBatch():console.warn("OpenReplay: beacon size overflow. Skipping large message.",t,this),this.encoder=new e(this.beaconSize),this.prepare()))}finaliseBatch(){if(this.isEmpty)return;const t=this.encoder.flush();this.onBatch(t),this.prepare()}clean(){this.encoder.reset()}}var h;!function(t){t[t.NotActive=0]="NotActive",t[t.Starting=1]="Starting",t[t.Stopping=2]="Stopping",t[t.Active=3]="Active",t[t.Stopped=4]="Stopped"}(h||(h={}));let r=null,a=null,u=h.NotActive;function o(){a&&a.finaliseBatch()}function c(){return new Promise((t=>{u=h.Stopping,null!==p&&(clearInterval(p),p=null),a&&(a.clean(),a=null),r&&(r.clean(),setTimeout((()=>{r=null}),20)),setTimeout((()=>{u=h.NotActive,t(null)}),100)}))}function l(){[h.Stopped,h.Stopping].includes(u)||(postMessage("a_stop"),c().then((()=>{postMessage("a_start")})))}let g,p=null;self.onmessage=({data:s})=>{if(null!=s){if("stop"===s)return o(),void c().then((()=>{u=h.Stopped}));if("forceFlushBatch"!==s){if(!Array.isArray(s)){if("compressed"===s.type){if(!r)return console.debug("OR WebWorker: sender not initialised. Compressed batch."),void l();s.batch&&r.sendCompressed(s.batch)}if("uncompressed"===s.type){if(!r)return console.debug("OR WebWorker: sender not initialised. Uncompressed batch."),void l();s.batch&&r.sendUncompressed(s.batch)}return"start"===s.type?(u=h.Starting,r=new t(s.ingestPoint,(()=>{l()}),(t=>{!function(t){postMessage({type:"failure",reason:t}),c()}(t)}),s.connAttemptCount,s.connAttemptGap,(t=>{postMessage({type:"compress",batch:t},[t.buffer])}),s.pageNo),a=new n(s.pageNo,s.timestamp,s.url,(t=>{r&&r.push(t)}),s.tabId,(()=>postMessage({type:"queue_empty"}))),null===p&&(p=setInterval(o,1e4)),u=h.Active):"auth"===s.type?r?a?(r.authorise(s.token),void(s.beaconSizeLimit&&a.setBeaconSizeLimit(s.beaconSizeLimit))):(console.debug("OR WebWorker: writer not initialised. Received auth."),void l()):(console.debug("OR WebWorker: sender not initialised. Received auth."),void l()):void 0}if(a){const t=a;s.forEach((s=>{55===s[0]&&(s[1]?g=setTimeout((()=>l()),18e5):clearTimeout(g)),t.writeMessage(s)}))}else postMessage("not_init"),l()}else o()}else o()}}();\n'],{type:"text/javascript"}))),this.worker.onerror=e=>{this._debug("webworker_error",e)},this.worker.onmessage=({data:e})=>{this.handleWorkerMsg(e)};var e=()=>{this.worker&&this.worker.postMessage(null)};this.attachEventListener(window,"beforeunload",e,!1),this.attachEventListener(document.body,"mouseleave",e,!1,!1),this.attachEventListener(document,"visibilitychange",e,!1)}catch(e){this._debug("worker_start",e)}}handleWorkerMsg(e){if("a_stop"===e)this.stop(!1);else if("a_start"===e)this.waitStatus(L.NotActive).then(()=>{this.allowAppStart(),this.start(this.prevOpts,!0).then(e=>{this.debug.info("Worker restart, session too long",e)}).catch(e=>{this.debug.error("Worker restart failed",e)})});else if("not_init"===e)this.debug.warn("OR WebWorker: writer not initialised. Restarting tracker");else if("failure"===e.type)this.stop(!1),this.debug.error("worker_failed",e.reason),this._debug("worker_failed",e.reason);else if("compress"===e.type){let s=e.batch;s.byteLength>this.compressionThreshold?ii(e.batch,{mtime:0},(e,t)=>{e?(this.debug.error("Openreplay compression error:",e),this.worker?.postMessage({type:"uncompressed",batch:s})):this.worker?.postMessage({type:"compressed",batch:t})}):this.worker?.postMessage({type:"uncompressed",batch:s})}else"queue_empty"===e.type&&this.onSessionSent()}_debug(e,t){null!==this.options.__debug_report_edp&&fetch(this.options.__debug_report_edp,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context:e,error:""+t})}),this.debug.error("OpenReplay error: ",e,t)}_nCommit(){if(this.socketMode)this.messages.unshift([0,this.timestamp()],$i(this.session.getTabId())),this.commitCallbacks.forEach(e=>e(this.messages)),this.messages.length=0;else if(this.insideIframe)window.parent.postMessage({line:f.iframeBatch,messages:this.messages},this.options.crossdomain?.parentDomain??"*"),this.commitCallbacks.forEach(e=>e(this.messages)),this.messages.length=0;else if(void 0!==this.worker&&this.messages.length)if(!this.messages.length&&this.emptyBatchCounter<1e3)this.emptyBatchCounter++;else{this.emptyBatchCounter=0;try{xi(()=>{this.messages.unshift([0,this.timestamp()],$i(this.session.getTabId())),this.worker?.postMessage(this.messages),this.commitCallbacks.forEach(e=>e(this.messages)),this.messages.length=0})}catch(e){this._debug("worker_commit",e),this.stop(!0),setTimeout(()=>{this.start()},500)}}}_cStartCommit(){var e;this.coldStartCommitN+=1,2===this.coldStartCommitN&&(e=[[0,this.timestamp()],$i(this.session.getTabId())],this.bufferedMessages1.push(...e),this.bufferedMessages2.push(...e),this.coldStartCommitN=0)}commit(){this.activityState===L.ColdStart?this._cStartCommit():this._nCommit()}postToWorker(t){this.worker?.postMessage(t),this.commitCallbacks.forEach(e=>e(t))}timestamp(){return U()+this.delay}safe(t){let s=this;return function(...e){try{t.apply(this,e)}catch(e){s._debug("safe_fn_call",e)}}}attachCommitCallback(e){this.commitCallbacks.push(e)}checkRequiredVersion(e){var t=e.split(/[.-]/),s=this.version.split(/[.-]/);for(let e=0;e<3;e++){if(isNaN(Number(s[e]))||isNaN(Number(t[e])))return!1;if(Number(s[e])>Number(t[e]))return!0;if(Number(s[e])<Number(t[e]))return!1}return!0}getTrackerInfo(){return{userUUID:this.localStorage.getItem(this.options.local_uuid_key),projectKey:this.projectKey,revID:this.revID,trackerVersion:this.version,isSnippet:this.options.__is_snippet}}getSessionInfo(){return{...this.session.getInfo(),...this.getTrackerInfo()}}getSessionToken(){return this.session.getSessionToken()}getSessionID(){return this.session.getInfo().sessionID||void 0}getSessionURL(e){var t,{projectID:s,sessionID:i,timestamp:n}=this.session.getInfo();if(s&&i)return t=this.options.ingestPoint,t=(/api\.openreplay\.com/.test(t)?"https://app.openreplay.com/ingest":t).replace(/ingest$/,s+"/session/"+i),e?.withCurrentTime?t+"?jumpto="+(U()-n):t;this.debug.error("OpenReplay error: Unable to build session URL")}getHost(){return new URL(this.options.ingestPoint).host}getProjectKey(){return this.projectKey}getBaseHref(){return"string"==typeof this.options.resourceBaseHref?this.options.resourceBaseHref:(this.options.resourceBaseHref,document.baseURI||document.head?.getElementsByTagName("base")[0]?.getAttribute("href")||location.origin+location.pathname)}resolveResourceURL(e){var t=new URL(this.getBaseHref());return t.pathname+="/"+new URL(e).pathname,t.pathname.replace(/\/+/g,"/"),t.toString()}isServiceURL(e){return e.startsWith(this.options.ingestPoint)}active(){return this.activityState===L.Active}resetNextPageSession(e){e?this.sessionStorage.setItem(this.options.session_reset_key,"t"):this.sessionStorage.removeItem(this.options.session_reset_key)}checkSessionToken(e){var t=null!==this.sessionStorage.getItem(this.options.session_reset_key),e=e||t,t=this.session.getSessionToken();return e||!t}async coldStart(e={},t){this.singleBuffer=!1;let s=this.checkSessionToken(e.forceNew),i=(t&&await this.setupConditionalStart(e),()=>{this.orderNumber+=1,pi(),this.coldStartTs=U(),(this.orderNumber%2==0?(this.bufferedMessages1.length=0,this.bufferedMessages1.push([0,this.timestamp()]),this.bufferedMessages1):(this.bufferedMessages2.length=0,this.bufferedMessages2.push([0,this.timestamp()]),this.bufferedMessages2)).push($i(this.session.getTabId())),this.stop(!1),this.activityState=L.ColdStart,e.sessionHash&&this.session.applySessionHash(e.sessionHash),e.forceNew&&this.session.reset(),this.session.assign({userID:e.userID,metadata:e.metadata}),s||(this.debug.log("continuing session on new tab",this.session.getTabId()),this.send(Vi(this.session.getTabId()))),this.observer.observe(),this.ticker.start()});this.coldInterval=setInterval(()=>{i()},3e4),i()}async setupConditionalStart(e){this.conditionsManager=new ai(this,e);var{token:e,userBrowser:t,userCity:s,userCountry:i,userDevice:n,userOS:r,userState:o,projectID:a,features:h}=await(await fetch(this.options.ingestPoint+"/v1/web/start",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...this.getTrackerInfo(),timestamp:U(),doNotRecord:!0,bufferDiff:0,userID:this.session.getInfo().userID,token:void 0,deviceMemory:Ki,jsHeapSizeLimit:Ji,timezone:fr(),width:window.screen.width,height:window.screen.height})})).json();this.features=h||this.features,this.session.assign({projectID:a}),this.session.setUserInfo({userBrowser:t,userCity:s,userCountry:i,userDevice:n,userOS:r,userState:o});let l={sessionToken:e,userUUID:"",sessionID:""};this.startCallbacks.forEach(e=>e(l)),await this.conditionsManager?.fetchConditions(a,e),this.features["feature-flags"]&&(await this.featureFlags.reloadFlags(e),this.conditionsManager?.processFlags(this.featureFlags.flags)),await this.tagWatcher.fetchTags(this.options.ingestPoint,e)}offlineRecording(e={},t){this.onSessionSent=t,this.singleBuffer=!0;var t=this.checkSessionToken(e.forceNew),s=(pi(),this.coldStartTs=U(),this.localStorage.getItem(ur));s&&(s=JSON.parse(s),this.bufferedMessages1=Array.isArray(s)?s:this.bufferedMessages1,this.localStorage.removeItem(ur)),this.bufferedMessages1.push([0,this.timestamp()]),this.bufferedMessages1.push($i(this.session.getTabId())),this.activityState=L.ColdStart,e.sessionHash&&this.session.applySessionHash(e.sessionHash),e.forceNew&&this.session.reset(),this.session.assign({userID:e.userID,metadata:e.metadata});let i={sessionToken:"",userUUID:"",sessionID:""};return this.startCallbacks.forEach(e=>e(i)),t||this.send(Vi(this.session.getTabId())),this.observer.observe(),this.ticker.start(),{saveBuffer:this.saveBuffer,getBuffer:this.getBuffer,setBuffer:this.setBuffer}}saveBuffer(){this.localStorage.setItem(ur,JSON.stringify(this.bufferedMessages1))}getBuffer(){return this.bufferedMessages1}setBuffer(e){this.bufferedMessages1=e}async uploadOfflineRecording(){this.stop(!1);var e=U();this.worker?.postMessage({type:"start",pageNo:this.session.incPageNo(),ingestPoint:this.options.ingestPoint,timestamp:this.coldStartTs,url:document.URL,connAttemptCount:this.options.connAttemptCount,connAttemptGap:this.options.connAttemptGap,tabId:this.session.getTabId()});var{token:e,userBrowser:t,userCity:s,userCountry:i,userDevice:n,userOS:r,userState:o,beaconSizeLimit:a,projectID:h}=await(await fetch(this.options.ingestPoint+"/v1/web/start",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...this.getTrackerInfo(),timestamp:e,doNotRecord:!1,bufferDiff:e-this.coldStartTs,userID:this.session.getInfo().userID,token:void 0,deviceMemory:Ki,jsHeapSizeLimit:Ji,timezone:fr()})})).json();for(this.worker?.postMessage({type:"auth",token:e,beaconSizeLimit:a}),this.session.assign({projectID:h}),this.session.setUserInfo({userBrowser:t,userCity:s,userCountry:i,userDevice:n,userOS:r,userState:o});0<this.bufferedMessages1.length;)await this.flushBuffer(this.bufferedMessages1);this.postToWorker([["q_end"]]),this.clearBuffers()}async _start(e={},t,s){0!==Object.keys(e).length&&(this.prevOpts=e);var i=this.activityState===L.ColdStart;if(i&&this.coldInterval&&clearInterval(this.coldInterval),!this.worker&&!this.insideIframe)return this.signalError(n="No worker found: perhaps, CSP is not set.",[]),Promise.resolve(q(n));if(this.activityState===L.Active||this.activityState===L.Starting)return Promise.resolve(q("OpenReplay: trying to call `start()` on the instance that has been started already."));this.activityState=L.Starting,i||pi(),e.sessionHash&&this.session.applySessionHash(e.sessionHash),e.forceNew&&this.session.reset(),this.session.assign({userID:e.userID,metadata:e.metadata});var n=U(),r=(this.worker?.postMessage({type:"start",pageNo:this.session.incPageNo(),ingestPoint:this.options.ingestPoint,timestamp:i?this.coldStartTs:n,url:document.URL,connAttemptCount:this.options.connAttemptCount,connAttemptGap:this.options.connAttemptGap,tabId:this.session.getTabId()}),this.session.getSessionToken()),o=this.checkSessionToken(e.forceNew);this.sessionStorage.removeItem(this.options.session_reset_key),this.debug.log("OpenReplay: starting session; need new session id?",o,"session token: ",r);try{var a,h,l,c=await window.fetch(this.options.ingestPoint+"/v1/web/start",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...this.getTrackerInfo(),timestamp:n,doNotRecord:!1,bufferDiff:n-this.coldStartTs,userID:this.session.getInfo().userID,token:o?void 0:r,deviceMemory:Ki,jsHeapSizeLimit:Ji,timezone:fr(),condition:s,assistOnly:e.assistOnly??this.socketMode,width:window.screen.width,height:window.screen.height})});if(200!==c.status)return h=(a=await c.text())===cr?cr:`Server error: ${c.status}. `+a,q(h);if(!this.worker&&!this.insideIframe)return l="no worker found after start request (this should not happen in real world)",this.signalError(l,[]),q(l);var d,{token:u,userUUID:p,projectID:f,beaconSizeLimit:g,compressionThreshold:m,delay:v,sessionID:y,startTimestamp:b,userBrowser:w,userCity:S,userCountry:k,userDevice:T,userOS:E,userState:_,canvasEnabled:C,canvasQuality:I,canvasFPS:x,assistOnly:O,features:R}=await c.json();if(this.features=R||this.features,"string"!=typeof u||"string"!=typeof p||"number"!=typeof b&&void 0!==b||"string"!=typeof y||"number"!=typeof v||"number"!=typeof g&&void 0!==g)return d="Incorrect server response: "+JSON.stringify(c),this.signalError(d,[]),q(d);this.delay=v,this.session.setSessionToken(u),this.session.setUserInfo({userBrowser:w,userCity:S,userCountry:k,userDevice:T,userOS:E,userState:_}),this.session.assign({sessionID:y,timestamp:b||n,projectID:f}),O?(this.socketMode=!0,this.worker?.postMessage("stop")):this.worker?.postMessage({type:"auth",token:u,beaconSizeLimit:g}),o||u!==r||(this.debug.log("continuing session on new tab",this.session.getTabId()),this.send(Vi(this.session.getTabId()))),Object.entries(this.session.getInfo().metadata).forEach(([e,t])=>this.send(Ri(e,t))),this.localStorage.setItem(this.options.local_uuid_key,p),this.compressionThreshold=m;let t={sessionToken:u,userUUID:p,sessionID:y};if(this.startCallbacks.forEach(e=>e(t)),e.startCallback&&e.startCallback(pr(t)),this.features["feature-flags"]&&this.featureFlags.reloadFlags(),await this.tagWatcher.fetchTags(this.options.ingestPoint,u),this.activityState=L.Active,this.options.crossdomain?.enabled&&!this.insideIframe&&this.bootChildrenFrames(),C&&!this.options.canvas.disableCanvas&&(this.canvasRecorder=this.canvasRecorder??new Bn(this,{fps:x,quality:I,isDebug:this.options.canvas.__save_canvas_locally,fixedScaling:this.options.canvas.fixedCanvasScaling,useAnimationFrame:this.options.canvas.useAnimationFrame})),i){for(var N=this.bufferedMessages1.length>this.bufferedMessages2.length?this.bufferedMessages1:this.bufferedMessages2;0<N.length;)await this.flushBuffer(N);this.clearBuffers(),this.commit()}else this.insideIframe&&this.rootId?this.observer.crossdomainObserve(this.rootId,this.frameOderNumber):this.observer.observe(),this.ticker.start();if(this.canvasRecorder?.startTracking(),this.features["usability-test"]&&!this.insideIframe){this.uxtManager=this.uxtManager||new Rn(this,dr);let t;var A,D,M=this.localStorage.getItem(dr);M&&(t=parseInt(M,10)),location?.search&&(A=new URLSearchParams(location.search)).has("oruxt")&&(D=A.get("oruxt"),t=D?parseInt(D,10):void 0),t&&(this.uxtManager.isActive?this.onUxtCb.forEach(e=>e(t)):this.uxtManager.getTest(t,u,Boolean(M)).then(t=>{t&&this.onUxtCb.forEach(e=>e(t))}))}return pr(t)}catch(e){if(this.stop(),this.session.reset(),!e)return console.error("Unknown error during start"),this.signalError("Unknown error",[]),q("Unknown error");if(e===cr)return this.signalError(cr,[]),q(cr);this._debug("session_start",e);s=e instanceof Error?e.message:e.toString();return this.signalError(s,[]),q(s)}}addOnUxtCb(e){this.onUxtCb.push(e)}getUxtId(){return this.uxtManager?.getTestId()}async waitStart(){return new Promise(e=>{let t=setInterval(()=>{this.canStart&&(clearInterval(t),e(!0))},100)})}async waitStarted(){return this.waitStatus(L.Active)}async waitStatus(s){return new Promise(e=>{let t=()=>{this.activityState===s?e(!0):setTimeout(t,25)};t()})}async start(...s){return this.activityState===L.Active||this.activityState===L.Starting?Promise.resolve(q("OpenReplay: trying to call `start()` on the instance that has been started already.")):(this.insideIframe&&this.signalIframeTracker(),document.hidden?new Promise(e=>{let t=async()=>{document.hidden||(await this.waitStart(),document.removeEventListener("visibilitychange",t),e(this._start(...s)))};document.addEventListener("visibilitychange",t)}):(await this.waitStart(),this._start(...s)))}forceFlushBatch(){this.worker?.postMessage("forceFlushBatch")}getTabId(){return this.session.getTabId()}clearBuffers(){this.bufferedMessages1.length=0,this.bufferedMessages2.length=0}trackWs(e){let i=e;return(e,t,s="down")=>{"string"!=typeof e||"string"!=typeof t||5242880<t.length||255<e.length||this.send([84,"websocket",i,t,this.timestamp(),s,e])}}stop(e=!0){if(this.activityState!==L.NotActive)try{!this.insideIframe&&this.options.crossdomain?.enabled&&this.killChildrenFrames(),this.attributeSender.clear(),this.sanitizer.clear(),this.observer.disconnect(),this.nodes.clear(),this.ticker.stop(),this.stopCallbacks.forEach(e=>e()),this.tagWatcher.clear(),this.worker&&e&&this.worker.postMessage("stop"),this.canvasRecorder?.clear(),this.messages.length=0,this.parentActive=!1}finally{this.activityState=L.NotActive,this.debug.log("OpenReplay tracking stopped.")}}}let mr=S&&"InstallTrigger"in window?e=>e.message+"\n"+e.stack:e=>e.stack||e.message;function vr(e){return void 0===e?"undefined":null===e?"null":e instanceof Error?mr(e):Array.isArray(e)?`Array(${e.length})`:String(e)}function yr(t){if(void 0===t)return"undefined";if(null===t)return"null";if(t instanceof Error)return mr(t);if(Array.isArray(t))return`Array(${t.length})[${t.slice(0,10).map(vr).join(", ")}]`;if("object"!=typeof t)return t.toString();{var s,i=[];let e=0;for(s in t){if(10==++e)break;var n=t[s];i.push(s+": "+vr(n))}return"{"+i.join(", ")+"}"}}function br(n){return"string"==typeof n[0]&&n.unshift(n.shift().replace(/%(o|s|f|d|i)/g,(e,t)=>{var s,i=n.shift();if(void 0===i)return e;switch(t){case"o":return yr(i);case"s":return vr(i);case"f":return"number"!=typeof(s=i)?"NaN":s.toString();case"d":case"i":return"number"!=typeof(s=i)?"NaN":Math.floor(s).toString();default:return e}})),n.map(yr).join(" ")}let wr=["log","info","warn","error","debug","assert"];function Sr(a,e){let h=Object.assign({consoleMethods:wr,consoleThrottling:30},e);if(Array.isArray(h.consoleMethods)&&0!==h.consoleMethods.length){let r=a.safe((e,t)=>{let s=br(t);a.sanitizer.privateMode&&(s=s.replaceAll(/./g,"*")),a.send([22,e,s])}),o=0;e=()=>{o=0};a.attachStartCallback(e),a.ticker.attach(e,33,!1);e=a.safe(e=>((s,i)=>{let n={apply:function(e,t,s){Reflect.apply(e,i,s),(o+=1)>h.consoleThrottling||r(e.name,s)}};h.consoleMethods.forEach(e=>{var t;-1===wr.indexOf(e)?a.debug.error(`OpenReplay: unsupported console method "${e}"`):(t=i.console[e],s[e]=new Proxy(t,n))})})(e.console,e));e(window),a.observer.attachContextCallback(e)}}let kr=/(^|@)\S+:\d+/,Tr=/^\s*at .*(\S+:\d+|\(native\))/m,Er=/^(eval@)?(\[native code\])?$/;function _r(e){if(void 0!==e.stacktrace||void 0!==e["opera#sourceloc"])return(!(t=e).stacktrace||t.message.includes("\n")&&t.message.split("\n").length>t.stacktrace.split("\n").length?e=>{var s=/Line (\d+).*script (?:in )?(\S+)/i,i=e.message.split("\n"),n=[];for(let e=2,t=i.length;e<t;e+=2){var r=s.exec(i[e]);r&&n.push({file:r[2],line:+r[1],raw:i[e]})}return n}:t.stack?e=>(e=Ir(e.stack.split("\n").filter(e=>!!e.match(kr)&&!e.match(/^Error created at/)))).map(e=>{var t=e.split("@"),s=Cr(t.pop()),t=t.shift()||"";let i;return{function:t.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,args:void 0===(i=t.match(/\(([^)]*)\)/)?t.replace(/^[^(]+\(([^)]*)\)$/,"$1"):i)||"[arguments not available]"===i?void 0:i.split(","),file:s[0],line:s[1]?+s[1]:void 0,col:s[2]?+s[2]:void 0,raw:e}}):e=>{var s=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,i=e.stacktrace.split("\n"),n=[];for(let e=0,t=i.length;e<t;e+=2){var r=s.exec(i[e]);r&&n.push({function:r[3]||void 0,file:r[2],line:r[1]?+r[1]:void 0,raw:i[e]})}return n})(t);var t;if(e.stack&&e.stack.match(Tr))return Ir(e.stack.split("\n").filter(e=>!!e.match(Tr))).map(e=>{let t=(e=e.includes("(eval ")?e.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""):e).replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,"");var s=t.match(/ (\(.+\)$)/),i=(t=s?t.replace(s[0],""):t,Cr(s?s[1]:t));return{function:s&&t||void 0,file:["eval","<anonymous>"].includes(i[0])?void 0:i[0],line:i[1]?+i[1]:void 0,col:i[2]?+i[2]:void 0,raw:e}});if(e.stack)return Ir(e.stack.split("\n").filter(e=>!e.match(Er))).map(e=>{var t,s;return(e=e.includes(" > eval")?e.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1"):e).includes("@")||e.includes(":")?{function:(s=e.match(t=/(([^\n\r"\u2028\u2029]*".[^\n\r"\u2028\u2029]*"[^\n\r@\u2028\u2029]*(?:@[^\n\r"\u2028\u2029]*"[^\n\r@\u2028\u2029]*)*(?:[\n\r\u2028\u2029][^@]*)?)?[^@]*)@/))&&s[1]?s[1]:void 0,file:(s=Cr(e.replace(t,"")))[0],line:s[1]?+s[1]:void 0,col:s[2]?+s[2]:void 0,raw:e}:{function:e}});throw new Error("Cannot parse given Error object")}function Cr(e){var t;return e.includes(":")?[(t=/(.+?)(?::(\d+))?(?::(\d+))?$/.exec(e.replace(/[()]/g,"")))[1],t[2]||void 0,t[3]||void 0]:[e,void 0,void 0]}function Ir(e){return e}function xr(e){return[{columnNumber:e.colno,lineNumber:e.lineno,fileName:e.filename,functionName:"",source:""}]}function Or(e,t,s={}){let i=t;try{i=_r(e).map(e=>({functionName:e.function,args:e.args,fileName:e.file,lineNumber:e.line,columnNumber:e.col,source:e.raw}))}catch(e){}return Ui(e.name,e.message,JSON.stringify(i),JSON.stringify(s))}function Rr(s,e=window,i={}){if(s instanceof ErrorEvent){if(s.error instanceof Error)return Or(s.error,xr(s),i);{let[e,t]=s.message.split(":");return t||(e="Error",t=s.message),Ui(e,t,JSON.stringify(xr(s)),JSON.stringify(i))}}if("PromiseRejectionEvent"in e&&s instanceof e.PromiseRejectionEvent){if(s.reason instanceof Error)return Or(s.reason,[],i);{let t;try{t=JSON.stringify(s.reason)}catch(e){t=String(s.reason)}return Ui("Unhandled Promise Rejection",t,"[]",JSON.stringify(i))}}return null}function Nr(e,t=document.location){return(e=e.trim()).startsWith("//")||e.startsWith("http://")||e.startsWith("https://")||e.startsWith("data:")?e:e.startsWith("/")?t.origin+e:t.origin+t.pathname+e}function Ar(n){function i(e,t){n.attributeSender.sendSetAttribute(e,"src","https://static.openreplay.com/tracker/placeholder.jpeg");var{width:s,height:i}=t.getBoundingClientRect();t.hasAttribute("width")||n.attributeSender.sendSetAttribute(e,"width",String(s)),t.hasAttribute("height")||n.attributeSender.sendSetAttribute(e,"height",String(i))}function r(e,t){(t=t.srcset)&&(t=t.split(t.match(/,\s+/)?/,\s+/:",").map(e=>Nr(e)).join(", "),n.attributeSender.sendSetAttribute(e,"srcset",t))}function o(e,t){1e5<t.src.length&&i(e,t),n.send(Di(e,"src",t.src,n.getBaseHref()))}let a=n.safe(function(e){e=Nr(e.src||"");mi(e)&&n.send(Wi(n.timestamp(),0,0,0,0,0,e,"img",0,!1))}),t=n.safe(function(e){var t,s=n.nodes.getID(e);void 0!==s&&e.complete&&(0!==e.naturalHeight||0!==e.naturalWidth||(t=e.src,ui&&(t.startsWith("data:image/svg+xml")||t.match(/.svg$|/i)))?(n.sanitizer.isHidden(s)||n.sanitizer.isObscured(s)?i:(o(s,e),r))(s,e):a(e))}),s=Ei(n.safe(e=>{for(var t of e)if("attributes"===t.type){var s=t.target,i=n.nodes.getID(s);if(void 0===i)return;"src"===t.attributeName&&o(i,s),"srcset"===t.attributeName&&r(i,s)}}),n.options.forceNgOff);n.attachStopCallback(()=>{s.disconnect()}),n.nodes.attachNodeCallback(e=>{E(e,"img")&&(n.nodes.attachNodeListener(e,"error",()=>a(e)),n.nodes.attachNodeListener(e,"load",()=>t(e)),t(e),s.observe(e,{attributes:!0,attributeFilter:["src","srcset"]}))})}let Dr=["text","password","email","search","number","range","date","tel","time"],Mr=S&&"labels"in HTMLInputElement.prototype?e=>{let t=e;for(;null!==(t=t.parentNode);)if(E(t,"label"))return t;e=e.labels;if(null!==e&&1===e.length)return e[0]}:e=>{let t=e;for(;null!==(t=t.parentNode);)if(E(t,"label"))return t;var s=e.id;if(s){e=e.ownerDocument.querySelectorAll('label[for="'+s+'"]');if(null!==e&&1===e.length)return e[0]}};function Lr(e){let t=bi(e);var s;return null===t&&(s=Mr(e),t=s&&s.innerText||e.placeholder||e.name||e.id||e.className||e.type),gi(t).slice(0,100)}let Br={Plain:0,Obscured:1,Hidden:2};function jr(d,e){let r=Object.assign({obscureInputNumbers:!0,obscureInputEmails:!0,defaultInputMode:Br.Obscured,obscureInputDates:!1},e);function u(e,t){let s=t.value,i=r.defaultInputMode,n=("password"===t.type||d.sanitizer.isHidden(e)?i=Br.Hidden:(d.sanitizer.isObscured(e)||i===Br.Plain&&(r.obscureInputNumbers&&"date"!==t.type&&/\d\d\d\d/.test(s)||r.obscureInputDates&&"date"===t.type||r.obscureInputEmails&&("email"===t.type||~s.indexOf("@"))))&&(i=Br.Obscured),0);switch(i){case Br.Hidden:n=-1,s="";break;case Br.Obscured:n=s.length,s=""}return{value:s,mask:n}}function s(e,t){var{value:t,mask:s}=u(e,t);d.send([18,e,t,s])}let i=new Map,n=new Map;function o(e,t){i.get(e)!==t.value&&(i.set(e,t.value),s(e,t))}function a(e,t){n.get(e)!==t&&(n.set(e,t),d.send([19,e,t]))}d.attachStopCallback(()=>{i.clear(),n.clear()}),d.ticker.attach(()=>{i.forEach((e,t)=>{var s=d.nodes.getNode(t);if(!s)return i.delete(t);o(t,s)}),n.forEach((e,t)=>{var s=d.nodes.getNode(t);if(!s)return n.delete(t);a(t,s.checked)})},3),d.nodes.attachNodeCallback(d.safe(l=>{let c=d.nodes.getID(l);if(void 0!==c)if(E(l,"select")&&(s(c,l),d.nodes.attachNodeListener(l,"change",()=>s(c,l))),E(e=l,"textarea")||E(e,"input")&&Dr.includes(e.type)){o(c,l);let e=0,a=0,h=0;d.nodes.attachNodeListener(l,"focus",()=>{e=U()}),d.nodes.attachNodeListener(l,"input",()=>{0===a&&0!==e&&(a=U()-e)}),void d.nodes.attachNodeListener(l,"change",()=>{0!==e&&(h=U()-e);{var t=c,s=l,i=a,n=h,{value:r,mask:o}=u(t,s);let e=Lr(s);d.sanitizer.privateMode&&(e=e.replaceAll(/./g,"*")),d.send([112,t,r,0!==o,e,i,n])}a=0,h=0,e=0})}else{var e;(e=>E(e,"input")&&("checkbox"===(e=e.type)||"radio"===e))(l)&&(a(c,l.checked),d.nodes.attachNodeListener(l,"change",()=>a(c,l.checked)))}}))}let Fr=new Set(["role","name","aria-label","rel","href"]);function Pr(e,t){var s=Fr.has(e),e=(s||=e.startsWith("data-")&&Wr(e),Wr(t)&&t.length<100);return e||=t.startsWith("#")&&Wr(t.slice(1)),s&&e}function Ur(e){return Wr(e)}function qr(e){return Wr(e)}function Hr(e){return!0}function zr(e,t){if(e.nodeType!==Node.ELEMENT_NODE)throw new Error("Can't generate CSS selector for non-element node type.");if("html"===e.tagName.toLowerCase())return"html";var s,i={root:document.body,idName:Ur,className:qr,tagName:Hr,attr:Pr,timeoutMs:1e3,seedMinLength:3,optimizedMinLength:2,maxNumberOfPathChecks:1/0},n=new Date,r={...i,...t},o=(t=i,(i=r.root).nodeType===Node.DOCUMENT_NODE||i!==t.root?i:i.ownerDocument);let a,h=0;for(s of function*(e,t,s){let i=[],n=[],r=e,o=0;for(;r&&r!==s;){var a,h=((t,s)=>{var i=[],e=t.getAttribute("id");e&&s.idName(e)&&i.push({name:"#"+CSS.escape(e),penalty:0});for(let e=0;e<t.classList.length;e++){var n=t.classList[e];s.className(n)&&i.push({name:"."+CSS.escape(n),penalty:1})}for(let e=0;e<t.attributes.length;e++){var r=t.attributes[e];s.attr(r.name,r.value)&&i.push({name:`[${CSS.escape(r.name)}="${CSS.escape(r.value)}"]`,penalty:2})}e=t.tagName.toLowerCase(),s.tagName(e)&&(i.push({name:e,penalty:5}),void 0!==(o=Kr(t,e)))&&i.push({name:Jr(e,o),penalty:10});var o=Kr(t);return void 0!==o&&i.push({name:((e,t)=>"html"!==e?e+`:nth-child(${t})`:"html")(e,o),penalty:50}),i})(r,t);for(a of h)a.level=o;if(i.push(h),r=r.parentElement,o++,n.push(...function*e(t,s=[]){if(0<t.length)for(var i of t[0])yield*e(t.slice(1,t.length),s.concat(i));else yield s}(i)),o>=t.seedMinLength){n.sort(Xr);for(var l of n)yield l;n=[]}}n.sort(Xr);for(var c of n)yield c}(e,r,o)){var l=(new Date).getTime()-n.getTime();if(r.timeoutMs<l||h>=r.maxNumberOfPathChecks){l=((e,t)=>{let s=0,i=e,n=[];for(;i&&i!==t;){var r=i.tagName.toLowerCase(),o=Kr(i,r);if(void 0===o)return;n.push({name:Jr(r,o),penalty:NaN,level:s}),i=i.parentElement,s++}if(Gr(n,t))return n})(e,o);if(l)return Vr(l);throw new Error(`Timeout: Can't find a unique selector after ${r.timeoutMs}ms`)}if(h++,Gr(s,o)){a=s;break}}if(a)return(t=[...function*i(n,r,o,a,h){if(2<n.length&&n.length>o.optimizedMinLength)for(let s=1;s<n.length-1;s++){let e=(new Date).getTime()-h.getTime();if(e>o.timeoutMs)return;let t=[...n];t.splice(s,1),Gr(t,a)&&a.querySelector(Vr(t))===r&&(yield t,yield*i(t,r,o,a,h))}}(a,e,r,o,n)]).sort(Xr),Vr(0<t.length?t[0]:a);throw new Error("Selector was not found.")}function Wr(e){if(/^[a-z\-]{3,}$/i.test(e)){var t;for(t of e.split(/-|[A-Z]/)){if(t.length<=2)return!1;if(/[^aeiou]{4,}/i.test(t))return!1}return!0}return!1}function Vr(t){let s=t[0],i=s.name;for(let e=1;e<t.length;e++){var n=t[e].level||0;i=s.level===n-1?t[e].name+" > "+i:t[e].name+" "+i,s=t[e]}return i}function $r(e){return e.map(e=>e.penalty).reduce((e,t)=>e+t,0)}function Xr(e,t){return $r(e)-$r(t)}function Kr(s,i){var e=s.parentNode;if(e){let t=e.firstChild;if(t){let e=0;for(;t&&(t.nodeType!==Node.ELEMENT_NODE||void 0!==i&&t.tagName.toLowerCase()!==i||e++,t!==s);)t=t.nextSibling;return e}}}function Jr(e,t){return"html"===e?"html":e+`:nth-of-type(${t})`}function Gr(e,t){var s=Vr(e);switch(t.querySelectorAll(s).length){case 0:throw new Error("Can't select any node with this selector: "+s);case 1:return!0;default:return!1}}function Yr(e){var t=e.tagName.toUpperCase();return"BUTTON"===t||"A"===t||"LI"===t||"SELECT"===t||"TR"===t||"TH"===t||null!=e.onclick||"button"===e.getAttribute("role")}function Qr(t,s){if(t instanceof Element){var i=t;var n=s;let e=i;for(;null!==e&&e!==n.documentElement;){if(l(e,"masked"))return null;e=e.parentElement}if(An(i)){let e=i.ownerSVGElement;for(;null!==e;)e=(i=e).ownerSVGElement}for(e=i;null!==e&&e!==n.documentElement;){var r=e.tagName.toUpperCase();if("LABEL"===r)return null;if("INPUT"===r)return e;if(Yr(e)||null!==bi(e))return e;e=e.parentElement}return i===n.documentElement?null:i}return null}function Zr(h,l){let{disableClickmaps:c=!1}=l||{};let i=-1,n=-1,r=!1,d=null,u=0,p={},s=0,f=0,g=0,m=0,e;h.attachStartCallback(()=>{e=setInterval(()=>{var e,t;t=m/225,s=(s&&(e=(t-s)/225,4<g&&.008<e&&h.send([114,U()]),m=0,g=0),t)},225)}),h.attachStopCallback(()=>{i=-1,n=-1,r=!1,d=null,p={},e&&clearInterval(e)});let v=()=>{r&&(h.send([20,i,n]),r=!1)},t=(o,e=!1)=>{function a(e,t,s){return p[e]=p[e]||zr(t,{root:o.body,seedMinLength:3,optimizedMinLength:s?.minSelectorDepth||2,maxNumberOfPathChecks:s?.maxOptimiseTries||1e4})}e=e?h.attachEventListener.bind(h):h.nodes.attachNodeListener.bind(h.nodes);e(o.documentElement,"mouseover",e=>{e=Qr(e.target,o);e!==d&&(d=e,u=performance.now())}),e(o,"mousemove",e=>{var[t,s]=h.observer.getDocumentOffset(o),t=(i=e.clientX+t,n=e.clientY+s,r=!0,Math.sign(e.movementX));m+=Math.abs(e.movementX)+Math.abs(e.movementY),t!==f&&(f=t,g++)},!1),e(o,"click",e=>{var t,s,i,n,r=Qr(e.target,o);(e.clientX||e.clientY)&&null!==r&&(void 0!==(t=h.nodes.getID(r))&&(i=e.pageX,e=e.pageY,n=o.documentElement.scrollWidth,s=o.documentElement.scrollHeight,i=eo(i/n),n=eo(e/s),v(),e=(t=>{var e=bi(t);if(null!==e)return e;if(E(t,"input"))return Lr(t);if(Yr(t)){let e="";return gi(e=(e=t instanceof HTMLElement?h.sanitizer.getInnerTextSecure(t):e)||t.id||t.className).slice(0,100)}return""})(r),h.send([68,t,d===r?Math.round(performance.now()-u):0,h.sanitizer.privateMode?e.replaceAll(/./g,"*"):e,Yr(r)&&!c?a(t,r,l):"",i,n],!0)),d=null)})};h.nodes.attachNodeCallback(e=>{Mn(e)&&t(e)}),t(document,!0),h.ticker.attach(v,l?.trackingOffset||7)}function eo(e){return Math.round(1e4*e)}function to(o,a){a=a||{},To(fo(function(){function e(e){e.forEach(function(e){var t,s;e.hadRecentInput||(t=n[0],s=n[n.length-1],i&&e.startTime-s.startTime<1e3&&e.startTime-t.startTime<5e3?(i+=e.value,n.push(e)):(i=e.value,n=[e]))}),i>s.value&&(s.value=i,s.entries=n,t())}var t,s=g("CLS",0),i=0,n=[],r=co("layout-shift",e);r&&(t=m(o,s,Eo,a.reportAllChanges),po(function(){e(r.takeRecords()),t(!0)}),ao(function(){s=g("CLS",i=0),t=m(o,s,Eo,a.reportAllChanges),uo(function(){return t()})}),setTimeout(t,0))}))}function so(r,o){"PerformanceEventTiming"in self&&"interactionId"in PerformanceEventTiming.prototype&&(o=o||{},So(function(){var e;Ro();function t(t){Bo(function(){t.forEach(Lo);var e=Do();e&&e.latency!==s.value&&(s.value=e.latency,s.entries=e.entries,n())})}var s=g("INP"),i=co("event",t,{durationThreshold:null!=(e=o.durationThreshold)?e:40}),n=m(r,s,jo,o.reportAllChanges);i&&(i.observe({type:"first-input",buffered:!0}),po(function(){t(i.takeRecords()),n(!0)}),ao(function(){Ao=Oo(),y.length=0,No.clear(),s=g("INP"),n=m(r,s,jo,o.reportAllChanges)}))}))}function io(o,a){a=a||{},So(function(){function e(e){(e=a.reportAllChanges?e:e.slice(-1)).forEach(function(e){e.startTime<i.firstHiddenTime&&(n.value=Math.max(e.startTime-lo(),0),n.entries=[e],t())})}var t,s,i=wo(),n=g("LCP"),r=co("largest-contentful-paint",e);r&&(t=m(o,n,Fo,a.reportAllChanges),s=fo(function(){Po[n.id]||(e(r.takeRecords()),r.disconnect(),Po[n.id]=!0,t(!0))}),["keydown","click"].forEach(function(e){addEventListener(e,function(){return Bo(s)},{once:!0,capture:!0})}),po(s),ao(function(e){n=g("LCP"),t=m(o,n,Fo,a.reportAllChanges),uo(function(){n.value=performance.now()-e.timeStamp,Po[n.id]=!0,t(!0)})}))})}var no,p,ro,oo=-1,ao=function(t){addEventListener("pageshow",function(e){e.persisted&&(oo=e.timeStamp,t(e))},!0)},ho=function(){var e=self.performance&&performance.getEntriesByType&&performance.getEntriesByType("navigation")[0];if(e&&0<e.responseStart&&e.responseStart<performance.now())return e},lo=function(){var e=ho();return e&&e.activationStart||0},g=function(e,t){var s=ho(),i="navigate";return 0<=oo?i="back-forward-cache":s&&(document.prerendering||0<lo()?i="prerender":document.wasDiscarded?i="restore":s.type&&(i=s.type.replace(/_/g,"-"))),{name:e,value:void 0===t?-1:t,rating:"good",delta:0,entries:[],id:"v4-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12),navigationType:i}},co=function(e,t,s){try{var i;if(PerformanceObserver.supportedEntryTypes.includes(e))return(i=new PerformanceObserver(function(e){Promise.resolve().then(function(){t(e.getEntries())})})).observe(Object.assign({type:e,buffered:!0},s||{})),i}catch(e){}},m=function(t,s,i,n){var r,o;return function(e){0<=s.value&&(e||n)&&((o=s.value-(r||0))||void 0===r)&&(r=s.value,s.delta=o,s.rating=(e=s.value)>i[1]?"poor":e>i[0]?"needs-improvement":"good",t(s))}},uo=function(e){requestAnimationFrame(function(){return requestAnimationFrame(function(){return e()})})},po=function(e){document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState&&e()})},fo=function(e){var t=!1;return function(){t||(e(),t=!0)}},go=-1,mo=function(){return"hidden"!==document.visibilityState||document.prerendering?1/0:0},vo=function(e){"hidden"===document.visibilityState&&-1<go&&(go="visibilitychange"===e.type?e.timeStamp:0,bo())},yo=function(){addEventListener("visibilitychange",vo,!0),addEventListener("prerenderingchange",vo,!0)},bo=function(){removeEventListener("visibilitychange",vo,!0),removeEventListener("prerenderingchange",vo,!0)},wo=function(){return go<0&&(go=mo(),yo(),ao(function(){setTimeout(function(){go=mo(),yo()},0)})),{get firstHiddenTime(){return go}}},So=function(e){document.prerendering?addEventListener("prerenderingchange",function(){return e()},!0):e()},ko=[1800,3e3],To=function(r,o){o=o||{},So(function(){var t,s=wo(),i=g("FCP"),n=co("paint",function(e){e.forEach(function(e){"first-contentful-paint"===e.name&&(n.disconnect(),e.startTime<s.firstHiddenTime)&&(i.value=Math.max(e.startTime-lo(),0),i.entries.push(e),t(!0))})});n&&(t=m(r,i,ko,o.reportAllChanges),ao(function(e){i=g("FCP"),t=m(r,i,ko,o.reportAllChanges),uo(function(){i.value=performance.now()-e.timeStamp,t(!0)})}))})},Eo=[.1,.25],_o=0,Co=1/0,Io=0,xo=function(e){e.forEach(function(e){e.interactionId&&(Co=Math.min(Co,e.interactionId),Io=Math.max(Io,e.interactionId),_o=Io?(Io-Co)/7+1:0)})},Oo=function(){return no?_o:performance.interactionCount||0},Ro=function(){"interactionCount"in performance||(no=no||co("event",xo,{type:"event",buffered:!0,durationThreshold:0}))},y=[],No=new Map,Ao=0,Do=function(){var e=Math.min(y.length-1,Math.floor((Oo()-Ao)/50));return y[e]},Mo=[],Lo=function(t){var e,s;Mo.forEach(function(e){return e(t)}),!t.interactionId&&"first-input"!==t.entryType||(s=y[y.length-1],((e=No.get(t.interactionId))||y.length<10||t.duration>s.latency)&&(e?t.duration>e.latency?(e.entries=[t],e.latency=t.duration):t.duration===e.latency&&t.startTime===e.entries[0].startTime&&e.entries.push(t):(s={id:t.interactionId,latency:t.duration,entries:[t]},No.set(s.id,s),y.push(s)),y.sort(function(e,t){return t.latency-e.latency}),10<y.length)&&y.splice(10).forEach(function(e){return No.delete(e.id)}))},Bo=function(e){var t=self.requestIdleCallback||self.setTimeout,s=-1;return e=fo(e),"hidden"===document.visibilityState?e():(s=t(e),po(e)),s},jo=[200,500],Fo=[2500,4e3],Po={},Uo=[800,1800],qo=function e(t){document.prerendering?So(function(){return e(t)}):"complete"!==document.readyState?addEventListener("load",function(){return e(t)},!0):setTimeout(t,0)};function Ho(d,e){let i=Object.assign({captureResourceTimings:!0,capturePageLoadTimings:!0,capturePageRenderTimings:!0,excludedResourceUrls:[]},e);if("PerformanceObserver"in window||(i.captureResourceTimings=!1),i.captureResourceTimings){let h={},r=new PerformanceObserver(e=>e.getEntries().forEach(a)),o,l=(d.attachStartCallback(function({sessionID:e}){var t,s,i,n;e!==o&&(performance.getEntriesByType("resource").forEach(a),o=e),r.observe({entryTypes:["resource"]}),to(u),so(u),io(u),t=u,s=s||{},i=g("TTFB"),n=m(t,i,Uo,s.reportAllChanges),qo(function(){var e=ho();e&&(i.value=Math.max(e.responseStart-lo(),0),i.entries=[e],n(!0),ao(function(){i=g("TTFB",0),(n=m(t,i,Uo,s.reportAllChanges))(!0)}))})}),d.attachStopCallback(function(){r.disconnect()}),0),c=0;if(i.capturePageLoadTimings){let h=!1;d.ticker.attach(()=>{var e,t,s,i,n,r,o,a;!h&&(0!==l&&0!==c||performance.getEntriesByType("paint").forEach(e=>{var{name:e,startTime:t}=e;switch(e){case"first-paint":l=t;break;case"first-contentful-paint":c=t}}),performance.timing.loadEventEnd||3e4<performance.now())&&(h=!0,{navigationStart:e,requestStart:t,responseStart:s,responseEnd:i,domContentLoadedEventStart:n,domContentLoadedEventEnd:r,loadEventStart:o,loadEventEnd:a}=performance.timing,d.send([23,t-e||0,s-e||0,i-e||0,n-e||0,r-e||0,o-e||0,a-e||0,l,c]))},30)}if(i.capturePageRenderTimings){let i=0,n=0,r=0,o=null,a=!1;d.ticker.attach(()=>{var e,t,s;!a&&(e=performance.now(),null!==h&&1e3<e-(i=Math.max.apply(null,Object.keys(h).map(e=>h[e])))&&(o=(s=>{var i=[],n=document.getElementsByTagName("*"),r=/url\(("[^"]*"|'[^']*'|[^)]*)\)/i;for(let t=0;t<n.length;t++){var o,a,h,l,c=n[t];let e="";(e=E(c,"img")?c.currentSrc||c.src:e)||(o=getComputedStyle(c).getPropertyValue("background-image"))&&null!==(o=r.exec(o))&&((e=o[1]).startsWith('"')||e.startsWith("'"))&&(e=e.substr(1,e.length-2)),e&&(void 0===(o="data:image"===e.substr(0,10)?0:s[e])||(c=c.getBoundingClientRect(),a=Math.max(c.top,0),h=Math.max(c.left,0),l=Math.min(c.bottom,window.innerHeight||document.documentElement&&document.documentElement.clientHeight||0),c=Math.min(c.right,window.innerWidth||document.documentElement&&document.documentElement.clientWidth||0),l<=a)||c<=h||i.push({time:o,area:(l-a)*(c-h)}))}return i})(h),h=null),null!==r&&(50<e-r&&(n=e),r=5e3<e-n?null:e),null!==o&&null===r||3e4<e)&&(a=!0,e=(h=null)===o?0:((t,s)=>{let i=Math.max(document.documentElement&&document.documentElement.clientWidth||0,window.innerWidth||0)*Math.max(document.documentElement&&document.documentElement.clientHeight||0,window.innerHeight||0)/10,n=i*t;for(let e=0;e<s.length;e++){var{time:r,area:o}=s[e];i+=o,n+=o*(t<r?r:t)}return 0===i?0:n/i})(c||l,o),{domContentLoadedEventEnd:s,navigationStart:t}=performance.timing,s=null===r?Math.max(n,c,s-t||0):0,d.send([24,e,c>i?c:i,s]))})}function a(s){if(!(s.duration<0||!mi(s.name)||d.isServiceURL(s.name))){null!==h&&(h[s.name]=s.startTime+s.duration);let t=!1;i.excludedResourceUrls?.forEach(e=>{s.name.startsWith(e)&&(t=!0)}),t||((0===s.responseEnd||0===s.transferSize&&0===s.decodedBodySize)&&d.send(Wi(s.startTime+k,0,0,0,0,0,s.name,s.initiatorType,0,!0)),d.send(Wi(s.startTime+k,s.duration,s.responseStart&&s.startTime?s.responseStart-s.startTime:0,s.encodedBodySize<s.transferSize?s.transferSize-s.encodedBodySize:0,s.encodedBodySize||0,s.decodedBodySize||0,d.sanitizer.privateMode?s.name.replaceAll(/./g,"*"):s.name,s.initiatorType,s.transferSize,s.responseStatus&&304===s.responseStatus||0===s.transferSize)))}}function u(e){if(d.active())return d.send([124,e.name,String(e.value)])}}}function zo(e){var t=e.defaultView;return[t&&t.scrollX||e.documentElement&&e.documentElement.scrollLeft||e.body&&e.body.scrollLeft||0,t&&t.scrollY||e.documentElement&&e.documentElement.scrollTop||e.body&&e.body.scrollTop||0]}function Wo(s,i){let t=!1,n=new Map;function r(e){Nn(e)&&(u(e)&&n.set(e,[e.scrollLeft,e.scrollTop]),Mn(e))&&n.set(e,zo(e))}let e=s.safe(()=>{var e,t;i||s.send(([e,t]=[...zo(document)],[6,e,t]))}),o=s.safe((e,t)=>{t=s.nodes.getID(t);void 0!==t&&s.send([16,t,e[0],e[1]])});s.attachStartCallback(e),s.attachStopCallback(()=>{t=!1,n.clear()}),s.nodes.attachNodeCallback((e,t)=>{t&&(u(e)&&0<e.scrollLeft+e.scrollTop?n.set(e,[e.scrollLeft,e.scrollTop]):Mn(e)&&n.set(e,zo(e))),Ln(e)&&s.nodes.attachNodeListener(e,"scroll",e=>{r(e.target)})}),s.attachEventListener(document,"scroll",e=>{e=e.target;e===document?t=!0:r(e)}),s.ticker.attach(()=>{t&&(e(),t=!1),n.forEach(o),n.clear()},5,!1)}function Vo(m,e,v,y,b){function s(e){m.debug.log("Openreplay: capturing axios response data",e);var{headers:t,data:s,method:i,url:n}=e.config,{data:r,headers:o,status:a,response:h}=e,{data:h,headers:l,status:c}=h||{};let d=v.ignoreHeaders,u=Array.isArray(d)?e=>d.includes(e):()=>d;function p(e,t){u(t[0])||(e[t[0]]=t[1])}let f={},g={};t.toJSON?f=t.toJSON():t instanceof Headers?t.forEach((e,t)=>p(f,[t,e])):Array.isArray(t)?t.forEach(e=>p(f,e)):"object"==typeof t&&Object.entries(t).forEach(e=>p(f,e));var t=l||o,l=(t.toJSON?g=t.toJSON():t instanceof Headers?t.forEach((e,t)=>p(g,[t,e])):Array.isArray(t)?t.forEach(e=>p(g,e)):"object"==typeof t&&Object.entries(t).forEach(([e,t])=>{u(e)||(g[e]=t)}),y({url:n,method:i||"",status:a||c||0,request:{headers:f,body:s},response:{headers:g,body:h||r}}));l?(o=e.config.__openreplay_timing,t=performance.now()-o,m.debug.log("Openreplay: final req object",l),m.send(qi("xhr",String(i),String(l.url),b(l.request),b(l.response),l.status,o+k,t,0))):m.debug.log("Openreplay: empty request/response info, skipping")}m.debug.log("Openreplay: attaching axios spy to instance",e);let t=e.interceptors.request.use(function(e){var t,s;return m.debug.log("Openreplay: capturing API request",e),e.__openreplay_timing=performance.now(),v.sessionTokenHeader&&(t="string"==typeof v.sessionTokenHeader?v.sessionTokenHeader:"X-OpenReplay-Session-Token",s=m.getSessionToken())&&e.headers.set(t,s),e},function(e){m.debug.log("Openreplay: failed API request, skipping",e)},{synchronous:!0}),i=e.interceptors.response.use(function(e){return v.failuresOnly||s(e),e},function(e){var t;return m.debug.log("Openreplay: capturing API request error",e),(e=>null!==e&&"object"==typeof e)(t=e)&&!0===t.isAxiosError&&Boolean(e.response)?s(e.response):e instanceof Error&&m.send(Or(e,[])),Promise.reject(e)},{synchronous:!0});m.attachStopCallback(()=>{e.interceptors.request.eject?.(t),e.interceptors.response.eject?.(i)})}class $o{constructor(e=[],t,s){this.ignoredHeaders=e,this.setSessionTokenHeader=t,this.sanitize=s,this.id="",this.name="",this.method="",this.url="",this.status=0,this.statusText="",this.cancelState=0,this.readyState=0,this.header={},this.responseType="",this.requestType="xhr",this.requestHeader={},this.responseSize=0,this.responseSizeText="",this.startTime=0,this.endTime=0,this.duration=0,this.getData={},this.requestData=null}getMessage(){var{reqHs:e,resHs:t}=this.writeHeaders(),e={headers:e,body:"GET"===this.method?JSON.stringify(this.getData):this.requestData},t={headers:t,body:this.response},e=this.sanitize({url:this.url,method:this.method,status:this.status,request:e,response:t});return e?(e.url.includes("/graphql")&&e.response.body&&"string"==typeof e.response.body&&(t=e.response.body.includes("errors"),e.status=t?400:200,this.requestType="graphql"),{requestType:this.requestType,method:e.method,url:e.url,request:JSON.stringify(e.request),response:JSON.stringify(e.response),status:e.status,startTime:this.startTime,duration:this.duration,responseSize:this.responseSize}):null}writeHeaders(){let s={},i=(Object.entries(this.requestHeader).forEach(([e,t])=>{this.isHeaderIgnored(e)||(s[e]=t)}),this.setSessionTokenHeader((e,t)=>{s[e]=t}),{});return Object.entries(this.header).forEach(([e,t])=>{this.isHeaderIgnored(e)||(i[e]=t)}),{reqHs:s,resHs:i}}isHeaderIgnored(e){return Array.isArray(this.ignoredHeaders)?this.ignoredHeaders.map(e=>e.toLowerCase()).includes(e.toLowerCase()):this.ignoredHeaders}}let Xo=(e,t)=>{let s="";switch(e){case"":case"text":case"json":"string"==typeof t?s=t:Jo(t)||Array.isArray(t)?s=JSON.stringify(t):void 0!==t&&(s=Object.prototype.toString.call(t));break;default:void 0!==t&&(s=Object.prototype.toString.call(t))}return s},Ko=e=>{if(!e)return null;let t;if("string"==typeof e){"{"!==e[0]&&"["!==e[0]||(t=e);var s=e.split("&");t=1===s.length?e:s.join(",")}else if((e=>null!=e&&!ArrayBuffer.isView(e)&&"undefined"!=typeof Symbol&&"function"==typeof e[Symbol.iterator])(e)){var i,n,r=[];for([i,n]of e)r.push(i+"="+("string"==typeof n?n:"[object Object]"));t=r.join(",")}else t=e instanceof Blob||e instanceof ReadableStream||e instanceof ArrayBuffer?"byte data":Jo(e)?e:"can't parse body "+typeof e;return t};function Jo(e){return null!==e&&"object"==typeof e}function Go(e){return e<=0?"":1e6<=e?(e/1e3/1e3).toFixed(1)+" MB":1e3<=e?(e/1e3).toFixed(1)+" KB":e+"B"}let Yo=e=>(e=e.startsWith("//")?""+new URL(window.location.href).protocol+e:e).startsWith("http")?new URL(e):new URL(e,window.location.href);class Qo{constructor(e,t,s,i,n){this.ignoredHeaders=e,this.setSessionTokenHeader=t,this.sanitize=s,this.sendMessage=i,this.isServiceUrl=n}apply(e,t,s){var i=s[0],n=s[1],r=new $o(this.ignoredHeaders,this.setSessionTokenHeader,this.sanitize);if(this.isServiceUrl(i))return e.apply(t,s);var o=Yo(i);if(r.method="POST",r.url=i,r.name=(o.pathname.split("/").pop()||"")+o.search,r.requestType="beacon",r.requestHeader={"Content-Type":(i=n)instanceof Blob?i.type:i instanceof FormData?"multipart/form-data":i instanceof URLSearchParams?"application/x-www-form-urlencoded;charset=UTF-8":"text/plain;charset=UTF-8"},r.status=0,r.statusText="Pending",o.search&&o.searchParams){r.getData={};for(var[a,h]of o.searchParams)r.getData[a]=h}r.requestData=Ko(n),r.startTime||(r.startTime=performance.now());i=e.apply(t,s),i?(r.endTime=performance.now(),r.duration=r.endTime-(r.startTime||r.endTime),r.status=0,r.statusText="Sent",r.readyState=4):(r.status=500,r.statusText="Unknown"),o=r.getMessage();return o&&this.sendMessage(o),i}}class Zo{static create(e,t,s,i,n,r){if(e)return new Proxy(e,new Qo(t,s,i,n,r))}}(t=p=p||{})[t.UNSENT=0]="UNSENT",t[t.OPENED=1]="OPENED",t[t.HEADERS_RECEIVED=2]="HEADERS_RECEIVED",t[t.LOADING=3]="LOADING",t[t.DONE=4]="DONE";class ea{constructor(e,t){this.resp=e,this.item=t,this.mockReader()}set(e,t,s){return Reflect.set(e,t,s)}get(e,t){let s=Reflect.get(e,t);switch(t){case"arrayBuffer":case"blob":case"formData":case"json":case"text":return()=>(this.item.responseType=t.toLowerCase(),s.apply(e).then(e=>(this.item.response=Xo(this.item.responseType,e),e)))}return"function"==typeof s?s.bind(e):s}mockReader(){let i;if(this.resp.body&&"function"==typeof this.resp.body.getReader){let e=this.resp.body.getReader;this.resp.body.getReader=()=>{let s=e.apply(this.resp.body);if(this.item.readyState!==p.DONE){let e=s.read,t=s.cancel;this.item.responseType="arraybuffer",s.read=()=>e.apply(s).then(e=>{var t;return i=i?((t=new Uint8Array(i.length+e.value.length)).set(i),t.set(e.value,i.length),t):new Uint8Array(e.value),this.item.endTime=performance.now(),this.item.duration=this.item.endTime-(this.item.startTime||this.item.endTime),this.item.readyState=e.done?4:3,this.item.statusText=e.done?String(this.item.status):"Loading",this.item.responseSize=i.length,this.item.responseSizeText=Go(this.item.responseSize),e.done&&(this.item.response=Xo(this.item.responseType,i)),e}),s.cancel=(...e)=>(this.item.cancelState=2,this.item.statusText="Cancel",this.item.endTime=performance.now(),this.item.duration=this.item.endTime-(this.item.startTime||this.item.endTime),this.item.response=Xo(this.item.responseType,i),t.apply(s,e))}return s}}}}class ta{constructor(e,t,s,i,n,r){this.ignoredHeaders=e,this.setSessionTokenHeader=t,this.sanitize=s,this.sendMessage=i,this.isServiceUrl=n,this.tokenUrlMatcher=r}apply(e,t,s){var i=s[0],n=s[1];if(!i||"string"!=typeof i&&(null==i||!i.url))return e.apply(window,s);if(i instanceof URL||"string"==typeof i?this.isServiceUrl(String(i)):this.isServiceUrl(String(i.url)))return e.apply(window,s);let r=new $o(this.ignoredHeaders,this.setSessionTokenHeader,this.sanitize);return this.beforeFetch(r,i,n),this.setSessionTokenHeader((e,t)=>{if(void 0===this.tokenUrlMatcher||this.tokenUrlMatcher(r.url))return void 0===s[1]&&s[0]instanceof Request?s[0].headers.append(e,t):(s[1]||(s[1]={}),void 0===s[1].headers&&(s[1]=Object.assign(Object.assign({},s[1]),{headers:{}})),void(s[1].headers instanceof Headers?s[1].headers.append(e,t):Array.isArray(s[1].headers)?s[1].headers.push([e,t]):s[1].headers[e]=t))}),e.apply(window,s).then(this.afterFetch(r)).catch(e=>{throw r.endTime=performance.now(),r.duration=r.endTime-(r.startTime||r.endTime),e})}beforeFetch(e,t,s){let i,n="GET",r={};if(r="string"==typeof t?(n=(null==s?void 0:s.method)||"GET",i=Yo(t),(null==s?void 0:s.headers)||{}):(n=t.method||"GET",i=Yo(t.url),t.headers),e.method=n,e.requestType="fetch",e.requestHeader=r,e.url=i.toString(),e.name=(i.pathname.split("/").pop()||"")+i.search,e.status=0,e.statusText="Pending",e.readyState=1,e.startTime||(e.startTime=performance.now()),"[object Headers]"===Object.prototype.toString.call(r)){e.requestHeader={};for(var[o,a]of r)e.requestHeader[o]=a}else e.requestHeader=r;if(i.search&&i.searchParams){e.getData={};for(var[h,l]of i.searchParams)e.getData[h]=l}null!=s&&s.body&&(e.requestData=Ko(s.body))}afterFetch(n){return e=>{n.endTime=performance.now(),n.duration=n.endTime-(n.startTime||n.endTime),n.status=e.status,n.statusText=String(e.status);let t=!1;n.header={};for(var[s,i]of e.headers)n.header[s]=i,t=-1<i.toLowerCase().indexOf("chunked")||t;return t?n.readyState=3:(n.readyState=4,this.handleResponseBody(e.clone(),n).then(e=>{n.responseSize="string"==typeof e?e.length:e.byteLength,n.responseSizeText=Go(n.responseSize),n.response=Xo(n.responseType,e);e=n.getMessage();e&&this.sendMessage(e)}).catch(e=>{if("AbortError"!==e.name)throw e})),new Proxy(e,new ea(e,n))}}handleResponseBody(e,t){var s=e.headers.get("content-type");return s&&s.includes("application/json")?(t.responseType="json",e.text()):s&&(s.includes("text/html")||s.includes("text/plain"))?(t.responseType="text",e.text()):(t.responseType="arraybuffer",e.arrayBuffer())}}class sa{static create(e,t,s,i,n,r){return new Proxy(fetch,new ta(e,t,s,i,n,r))}}class ia{constructor(e,t,s,i,n,r,o){this.ignoredHeaders=t,this.setSessionTokenHeader=s,this.sanitize=i,this.sendMessage=n,this.isServiceUrl=r,this.tokenUrlMatcher=o,this.XMLReq=e,this.XMLReq.onreadystatechange=()=>{this.onReadyStateChange()},this.XMLReq.onabort=()=>{this.onAbort()},this.XMLReq.ontimeout=()=>{this.onTimeout()},this.item=new $o(t,s,i),this.item.requestType="xhr"}get(s,e){switch(e){case"open":return this.getOpen(s);case"send":return this.setSessionTokenHeader((e,t)=>{void 0!==this.tokenUrlMatcher&&!this.tokenUrlMatcher(this.item.url)||s.setRequestHeader(e,t)}),this.getSend(s);case"setRequestHeader":return this.getSetRequestHeader(s);default:var t=Reflect.get(s,e);return"function"==typeof t?t.bind(s):t}}set(e,t,s){switch(t){case"onreadystatechange":return this.setOnReadyStateChange(e,t,s);case"onabort":return this.setOnAbort(e,t,s);case"ontimeout":return this.setOnTimeout(e,t,s)}return Reflect.set(e,t,s)}onReadyStateChange(){var e;this.item.url&&this.isServiceUrl(this.item.url)||(this.item.readyState=this.XMLReq.readyState,this.item.responseType=this.XMLReq.responseType,this.item.endTime=performance.now(),this.item.duration=this.item.endTime-this.item.startTime,this.updateItemByReadyState(),setTimeout(()=>{this.item.response=Xo(this.item.responseType,this.item.response)},0),this.XMLReq.readyState===p.DONE&&(e=this.item.getMessage())&&this.sendMessage(e))}onAbort(){this.item.cancelState=1,this.item.statusText="Abort";var e=this.item.getMessage();e&&this.sendMessage(e)}onTimeout(){this.item.cancelState=3,this.item.statusText="Timeout";var e=this.item.getMessage();e&&this.sendMessage(e)}getOpen(i){let n=Reflect.get(i,"open");return(...e)=>{var t=e[0],s=e[1];return this.item.method=t?t.toUpperCase():"GET",this.item.url=(null==(t=s.toString)?void 0:t.call(s))||"",this.item.name=null!=(s=null==(t=this.item.url)?void 0:t.replace(new RegExp("/*$"),"").split("/").pop())?s:"",this.item.getData=((e,t)=>{Jo(t)||(t={});let s=e?e.split("?"):[];if(s.shift(),0<s.length)for(var i of s=s.join("?").split("&")){i=i.split("=");try{t[i[0]]=decodeURIComponent(i[1])}catch(e){t[i[0]]=i[1]}}return t})(this.item.url,{}),n.apply(i,e)}}getSend(s){let i=Reflect.get(s,"send");return(...e)=>{var t=e[0];return this.item.requestData=Ko(t),i.apply(s,e)}}getSetRequestHeader(t){let s=Reflect.get(t,"setRequestHeader");return(...e)=>(this.item.requestHeader||(this.item.requestHeader={}),this.item.requestHeader[e[0]]=e[1],s.apply(t,e))}setOnReadyStateChange(t,e,s){return Reflect.set(t,e,(...e)=>{this.onReadyStateChange(),null!=s&&s.apply(t,e)})}setOnAbort(t,e,s){return Reflect.set(t,e,(...e)=>{this.onAbort(),s.apply(t,e)})}setOnTimeout(t,e,s){return Reflect.set(t,e,(...e)=>{this.onTimeout(),s.apply(t,e)})}updateItemByReadyState(){switch(this.XMLReq.readyState){case p.UNSENT:case p.OPENED:this.item.status=p.UNSENT,this.item.statusText="Pending",this.item.startTime||(this.item.startTime=performance.now());break;case p.HEADERS_RECEIVED:this.item.status=this.XMLReq.status,this.item.statusText="Loading",this.item.header={};var t=(this.XMLReq.getAllResponseHeaders()||"").split("\n");for(let e=0;e<t.length;e++){var s,i=t[e];i&&(s=(i=i.split(": "))[0],this.item.header[s]=i.slice(1).join(": "))}break;case p.LOADING:this.item.status=this.XMLReq.status,this.item.statusText="Loading",this.XMLReq.response&&this.XMLReq.response.length&&(this.item.responseSize=this.XMLReq.response.length,this.item.responseSizeText=Go(this.item.responseSize));break;case p.DONE:this.item.status=this.XMLReq.status||this.item.status||0,this.item.statusText=String(this.item.status),this.item.endTime=performance.now(),this.item.duration=this.item.endTime-(this.item.startTime||this.item.endTime),this.item.response=this.XMLReq.response,this.XMLReq.response&&this.XMLReq.response.length&&(this.item.responseSize=this.XMLReq.response.length,this.item.responseSizeText=Go(this.item.responseSize));break;default:this.item.status=this.XMLReq.status,this.item.statusText="Unknown"}}}class na{static create(t,s,i,n,r,o){return new Proxy(XMLHttpRequest,{construct(e){e=new e;return new Proxy(e,new ia(e,t,s,i,n,r,o))}})}}let ra=e=>{console.warn(`Openreplay: Can't find ${e} in global context.`)};function oa(e){return e.__or_req_data__||(e.__or_req_data__={body:void 0,headers:{}}),e.__or_req_data__}function aa(e){return"string"==typeof e?e.toUpperCase():"GET"}function ha(m,e={}){if(!e.disabled){let p=Object.assign({failuresOnly:!1,ignoreHeaders:["cookie","set-cookie","authorization"],capturePayload:!1,sessionTokenHeader:!1,captureInIframes:!0,axiosInstances:void 0,useProxy:!0},e),f=(!1===p.useProxy&&m.debug.warn("Network module is migrating to proxy api, to gradually migrate and test it set useProxy to true"),p.ignoreHeaders),g=Array.isArray(f)?e=>f.includes(e):()=>f,s=!0===p.sessionTokenHeader?"X-OpenReplay-SessionToken":p.sessionTokenHeader;e=n=>{if(p.useProxy)r=n,o=!!m.sanitizer.privateMode||p.ignoreHeaders,a=v,h=y,l=e=>{var t;p.failuresOnly&&e.status<400||(t=m.sanitizer.privateMode?"************":e.url,m.send(qi(e.requestType,e.method,t,e.request,e.response,e.status,e.startTime+k,e.duration,e.responseSize)))},c=e=>m.isServiceURL(e),d={xhr:!0,fetch:!0,beacon:!0},u=p.tokenUrlMatcher,r&&(d.xhr&&(r.XMLHttpRequest?r.XMLHttpRequest=na.create(o,a,h,l,c,u):ra("XMLHttpRequest")),d.fetch&&(r.fetch?r.fetch=sa.create(o,a,h,l,c,u):ra("fetch")),d.beacon)&&null!=(u=r.navigator)&&u.sendBeacon&&(d=r.navigator.sendBeacon,r.navigator.sendBeacon=Zo.create(d,o,a,h,l,c));else{var r,o,a,h,l,c,d,u;let e=n.fetch.bind(n);n.fetch=(o,a={})=>{if(!("string"==typeof o||o instanceof URL)||m.isServiceURL(String(o)))return e(o,a);v(function(e,t){void 0===a.headers&&(a.headers={}),a.headers instanceof Headers?a.headers.append(e,t):Array.isArray(a.headers)?a.headers.push([e,t]):a.headers[e]=t});let h=performance.now();return e(o,a).then(e=>{let s=performance.now()-h;if(!(p.failuresOnly&&e.status<400)){let r=e.clone();r.text().then(e=>{let i={},n={};if(!0!==f){let s=([e,t])=>{g(e)||(i[e]=t)};a.headers instanceof Headers?a.headers.forEach((e,t)=>s([t,e])):Array.isArray(a.headers)?a.headers.forEach(s):"object"==typeof a.headers&&Object.entries(a.headers).forEach(s),r.headers.forEach((e,t)=>{g(t)||(n[t]=e)})}var t=aa(a.method),e=y({url:String(o),method:t,status:r.status,request:{headers:i,body:a.body||null},response:{headers:n,body:e}});e&&m.send(qi("fetch",t,String(e.url),b(e.request),b(e.response),r.status,h+k,s,0))}).catch(e=>m.debug.error("Could not process Fetch response:",e))}return e})};let t=n.XMLHttpRequest.prototype.open,s=n.XMLHttpRequest.prototype.setRequestHeader,i=n.XMLHttpRequest.prototype.send;p.axiosInstances||(n.XMLHttpRequest.prototype.open=function(r,o){let a=this,h=(v((e,t)=>a.setRequestHeader(e,t)),0);return a.addEventListener("loadstart",e=>{h=e.timeStamp}),a.addEventListener("load",m.safe(e=>{var{headers:t,body:s}=oa(a),e=0<h?e.timeStamp-h:0,i=(a.getAllResponseHeaders()||"").trim().split(/[\r\n]+/);let n={};i.forEach(function(e){var e=e.split(": "),t=e.shift();g(t)||(n[t]=e.join(": "))});i=aa(r),t=y({url:String(o),method:i,status:a.status,request:{headers:t,body:s||null},response:{headers:n,body:a.response}});t&&m.send(qi("xhr",i,String(t.url),b(t.request),b(t.response),a.status,h+k,e,0))})),t.apply(this,arguments)},n.XMLHttpRequest.prototype.send=function(e){return oa(this).body=e,i.apply(this,arguments)},n.XMLHttpRequest.prototype.setRequestHeader=function(e,t){return g(e)||(oa(this).headers[e]=t),s.apply(this,arguments)})}};function v(e){var t;s&&(t=m.getSessionToken())&&m.safe(e)(s,t)}function y(e){if(p.capturePayload&&!m.sanitizer.privateMode||(delete e.request.body,delete e.response.body),p.sanitizer){var t=e.response.body;if("string"==typeof t)try{e.response.body=JSON.parse(t)}catch{}return p.sanitizer(e)}return e}function b(e){if(e&&"string"!=typeof e.body)try{e.body=JSON.stringify(e.body)}catch{e.body="<unable to stringify>",m.notify.warn("Openreplay fetch couldn't stringify body:",e.body)}return JSON.stringify(e)}e(window),p.axiosInstances&&p.axiosInstances.forEach(e=>{Vo(m,e,p,y,b)}),p.captureInIframes&&m.observer.attachContextCallback(m.safe(e))}}let la="/en/sdk";class ca{constructor(n){if(this.options=n,this.app=null,this.crossdomainMode=!1,this.checkDoNotTrack=()=>this.options.respectDoNotTrack&&("1"==navigator.doNotTrack||"1"==window.doNotTrack),this.signalStartIssue=(e,t)=>{var s=this.checkDoNotTrack();console.log("Tracker couldn't start due to:",JSON.stringify({trackerVersion:"16.2.1",projectKey:this.options.projectKey,doNotTrack:s,reason:t.length?"missing api: "+t.join(","):e}))},this.restartCanvasTracking=()=>{null!==this.app&&this.app.restartCanvasTracking()},this.handleError=(e,t={})=>{var s;null!==this.app&&(e instanceof Error?(s=Or(e,[],t),this.app.send(s)):(e instanceof ErrorEvent||"PromiseRejectionEvent"in window&&e instanceof PromiseRejectionEvent)&&null!=(s=Rr(e,void 0,t))&&this.app.send(s))},this.crossdomainMode=Boolean(ki()&&n.crossdomain?.enabled),S&&(e=>{if(null!=e){if("string"!=typeof e.projectKey)if("number"!=typeof e.projectKey){if("number"!=typeof e.projectID)return console.error(`OpenReplay: projectKey is missing or wrong type (string is expected). Please, check ${vi}${la} for more information.`),0;e.projectKey=e.projectID.toString(),T("`projectID` option","`projectKey` option",la)}else console.warn("OpenReplay: projectKey is expected to have a string type."),e.projectKey=e.projectKey.toString();return null!=e.sessionToken&&T("`sessionToken` option","`sessionHash` start() option","/"),1}console.error("OpenReplay: invalid options argument type. Please, check documentation on "+vi+la)})(n))if(window.__OPENREPLAY__||!this.crossdomainMode&&ki()&&(()=>{try{return Boolean(window.top?.document)}catch{return!1}})()&&window.top.__OPENREPLAY__)console.error("OpenReplay: one tracker instance has been initialised already");else if(n.__DISABLE_SECURE_MODE||"https:"===location.protocol){var t,e=[];if(this.checkDoNotTrack())e.push("doNotTrack");else for(var s of["Map","Set","MutationObserver","performance","timing","startsWith","Blob","Worker"])if("timing"===s){if("performance"in window&&!(s in performance)){e.push(s);break}}else if("startsWith"===s){if(!(s in String.prototype)){e.push(s);break}}else if(!(s in window)){e.push(s);break}if(0<e.length)t=e.join(","),console.error("OpenReplay: browser doesn't support API required for tracking or doNotTrack is set to 1. Reason: "+t),this.signalStartIssue("missing_api",e);else{let h=new gr(n.projectKey,n.sessionToken,n,this.signalStartIssue,this.crossdomainMode);if(this.app=h,!this.crossdomainMode){{var l=h;let i,s,n,r,o=document.referrer,e=l.safe(()=>{var e,t,s=document.URL;s!==i&&(i=s,s=l.sanitizer.privateMode?or(document.title):document.title,e=l.sanitizer.privateMode?or(i):i,t=l.sanitizer.privateMode?or(o):o,l.send([122,e,t,r,s]),r=0,o=i)}),t=l.safe(()=>{var{innerWidth:e,innerHeight:t}=window;e===s&&t===n||(s=e,n=t,l.send([5,s,n]))}),a=void 0===document.hidden?Function.prototype:l.safe(()=>l.send([55,document.hidden]));l.attachStartCallback(()=>{i=null,r=k,s=n=-1,e(),t(),a()}),void 0!==document.hidden&&l.attachEventListener(document,"visibilitychange",a,!1,!1),l.ticker.attach(e,1,!1),l.ticker.attach(t,5,!1)}{var r=h;let e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;void 0!==e&&((t=()=>r.send([54,Math.round(1e3*e.downlink),e.type||"unknown"]))(),e.addEventListener("change",t))}var o=h,a=n;if(Object.assign({capturePerformance:!0},a).capturePerformance){let e,t,s=()=>{void 0!==e&&-1!==e&&(e++,requestAnimationFrame(s))},i=(o.ticker.attach(()=>{void 0!==t&&-1!==t&&t++},0,!1),()=>{void 0!==e&&void 0!==t&&(o.send([49,e,t,Xi.memory.totalJSHeapSize||0,Xi.memory.usedJSHeapSize||0]),t=e=document.hidden?-1:0)});o.attachStartCallback(()=>{t=e=-1,i(),s()}),o.attachStopCallback(()=>{t=e=void 0}),o.ticker.attach(i,165,!1),void 0!==document.hidden&&o.attachEventListener(document,"visibilitychange",i,!1,!1)}(c=h).attachEventListener(window,"focus",function(){document.hidden||(c.debug.log("Openreplay: tab change to"+c.session.getTabId()),c.send(Vi(c.session.getTabId())))},!1,!1)}Zr(h,n.mouse),Wo(h,this.crossdomainMode);var c,d,u=h;if(null!==u)if(window.CSSStyleSheet){let r=u.safe((e,t,s)=>{e=Jn.get(e);e&&("string"==typeof s?u.send(ji(e,s,t,u.getBaseHref())):u.send(Fi(e,t)))}),o=u.safe(e=>{let t=e;for(;t.parentRule;)t=t.parentRule;var s,i,n,r=t.parentStyleSheet;r?(s=Jn.get(r))?(i=t.cssText,n=r.cssRules,0<=(n=Array.from(n).indexOf(t))?(u.send(ji(s,i,n,u.getBaseHref())),u.send(Fi(s,n+1))):u.debug.warn("Rule index not found in",r,t)):u.debug.warn("No sheedID found for",r,Jn):u.debug.warn("No parent StyleSheet found for",t,e)});a=u.safe(e=>{let{insertRule:s,deleteRule:t}=e.CSSStyleSheet.prototype,{insertRule:i,deleteRule:n}=e.CSSGroupingRule.prototype;e.CSSStyleSheet.prototype.insertRule=function(e,t=0){return r(this,t,e),s.call(this,e,t)},e.CSSStyleSheet.prototype.deleteRule=function(e){return r(this,e),t.call(this,e)},e.CSSGroupingRule.prototype.insertRule=function(e,t=0){e=i.call(this,e,t);return o(this),e},e.CSSGroupingRule.prototype.deleteRule=function(e=0){e=n.call(this,e);return o(this),e}});a(window),u.observer.attachContextCallback(a),u.nodes.attachNodeCallback(e=>{if(E(e,"style")&&e.sheet&&!(null!==e.textContent&&0<e.textContent.trim().length)){var t=u.nodes.getID(e);if(t){var s=e.sheet,e=Xn++,i=(Jn.set(s,e),u.send(Pi(e,t)),s.cssRules);for(let e=0;e<i.length;e++)r(s,e,i[e].cssText)}}})}else u.send([63,"no_stylesheet_prototype_in_window",""]);var p=h;if(null!==p&&$n(document)){let l=new Map,c=new Map,s=h=>setTimeout(()=>{let s=p.nodes.getID(h);if(void 0!==(s=h===document?0:s)){let e=c.get(s);e=e||[];var i=[],t=h.adoptedStyleSheets;if(t&&Symbol.iterator in t)for(var n of t){let t=l.get(n);var r=!t;if(t||(t=Xn++,l.set(n,t)),e.includes(t)||p.send(Pi(t,s)),r){var o=n.cssRules;for(let e=0;e<o.length;e++)p.send(ji(t,o[e].cssText,e,p.getBaseHref()))}i.push(t)}if(Symbol.iterator in e)for(var a of e)i.includes(a)||p.send([77,a,s]);c.set(s,i)}},20);var f=t=>{if(!t.__openreplay_adpss_patched__){t.__openreplay_adpss_patched__=!0,g(t.Document.prototype),g(t.ShadowRoot.prototype);let{replace:e,replaceSync:s}=t.CSSStyleSheet.prototype;t.CSSStyleSheet.prototype.replace=function(s){return e.call(this,s).then(e=>{var t=l.get(this);return t&&p.send(Bi(t,s,p.getBaseHref())),e})},t.CSSStyleSheet.prototype.replaceSync=function(e){var t=l.get(this);return t&&p.send(Bi(t,e,p.getBaseHref())),s.call(this,e)}}};function g(e){let t=Object.getOwnPropertyDescriptor(e,"adoptedStyleSheets");t&&Object.defineProperty(e,"adoptedStyleSheets",{...t,set:function(e){e=t.set.call(this,e);return s(this),e}})}f(window),p.observer.attachContextCallback(p.safe(f)),p.attachStopCallback(()=>{l.clear(),c.clear()}),p.attachStartCallback(()=>{s(document)}),p.nodes.attachNodeCallback(e=>{$n(e)&&s(e)})}Sr(h,n),d=h,Object.assign({captureExceptions:!0},n).captureExceptions&&(d.observer.attachContextCallback(w),w(window)),Ar(h),jr(h,n),Ho(h,n);{var m=h;function v(e){e=m.nodes.getID(e);void 0!==e&&m.send(Ai(e))}let t=!1;m.nodes.attachNodeCallback(e=>{E(e,"body")&&(m.nodes.attachNodeListener(e,"focus",e=>{Nn(e.target)&&(v(e.target),t=!1)}),m.nodes.attachNodeListener(e,"blur",e=>{null===e.relatedTarget&&(t=!0,setTimeout(()=>{t&&m.send(Ai(-1))},0))}))}),m.attachStartCallback(()=>{let e=document.activeElement;for(;e&&E(e,"iframe")&&e.contentDocument;)e=e.contentDocument.activeElement;e&&e!==e.ownerDocument.body&&v(e)},!0)}var y,b=h;if(window.FontFace){let r=new Map;f=n=>{class e extends n.FontFace{constructor(...t){if("string"==typeof t[1]){let e="";t[2]&&b.safe(()=>{e=JSON.stringify(t[2])});var s=[t[0],t[1],e],i=r.get(n.document)||[],i=(i.push(s),r.set(n.document,i),n===window?0:b.nodes.getID(n.document));if(void 0===i)return;b.active()&&b.send(Ni(i,...s))}super(...t)}}n.FontFace=e};b.observer.attachContextCallback(f),f(window),b.nodes.attachNodeCallback(b.safe(e=>{if(Mn(e)){var s=r.get(e);if(s){let t=e.defaultView===window?0:b.nodes.getID(e);void 0!==t&&s.forEach(e=>{b.send(Ni(t,...e))})}}}))}n.network?.disabled||ha(h,n.network),(y=h).attachEventListener(document,"selectionchange",()=>{var e,t,s=document.getSelection();null===s||s.isCollapsed?y.send(Hi(-1,-1,"")):(e=y.nodes.getID(s.anchorNode),t=y.nodes.getID(s.focusNode),s=s.toString().replace(/\s+/g," "),e&&t&&y.send(Hi(e,t,s)))}),window.__OPENREPLAY__=this,n.flags&&n.flags.onFlagsLoad&&this.onFlagsLoad(n.flags.onFlagsLoad);let i=window.open;function w(t){function e(e){e=Rr(e,t);null!=e&&d.send(e)}try{d.attachEventListener(t,"unhandledrejection",e),d.attachEventListener(t,"error",e)}catch(e){console.error("Error while attaching to error proto contexts",e)}}(n.autoResetOnWindowOpen||n.resetTabOnWindowOpen)&&(h.attachStartCallback(()=>{let t=h.getTabId(),s=h.sessionStorage??window.sessionStorage;window.open=function(...e){return n.autoResetOnWindowOpen&&h.resetNextPageSession(!0),n.resetTabOnWindowOpen&&s.removeItem(n.session_tabid_key||"__openreplay_tabid"),h.resetNextPageSession(!1),s.setItem(n.session_tabid_key||"__openreplay_tabid",t),i.call(window,...e)}}),h.attachStopCallback(()=>{window.open=i}))}}else console.error("OpenReplay: Your website must be publicly accessible and running on SSL in order for OpenReplay to properly capture and replay the user session. You can disable this check by setting `__DISABLE_SECURE_MODE` option to `true` if you are testing in localhost. Keep in mind, that asset files on a local machine are not available to the outside world. This might affect tracking if you use css files.")}isFlagEnabled(e){return this.featureFlags.isFlagEnabled(e)}onFlagsLoad(e){this.app?.featureFlags.onFlagsLoad(e)}clearPersistFlags(){this.app?.featureFlags.clearPersistFlags()}reloadFlags(){return this.app?.featureFlags.reloadFlags()}getFeatureFlag(e){return this.app?.featureFlags.getFeatureFlag(e)}getAllFeatureFlags(){return this.app?.featureFlags.flags}use(e){return e(this.app,this.options)}isActive(){return null!==this.app&&this.app.active()}trackWs(e){if(null!==this.app)return this.app.trackWs(e)}start(e){return this.browserEnvCheck()?null===this.app?Promise.reject("Browser doesn't support required api, or doNotTrack is active."):this.app.start(e):Promise.reject("Trying to start not in browser.")}browserEnvCheck(){return S||(console.error("OpenReplay: you are trying to start Tracker on a node.js environment. If you want to use OpenReplay with SSR, please, use componentDidMount or useEffect API for placing the `tracker.start()` line. Check documentation on "+vi+la),!1)}coldStart(e,t){return this.browserEnvCheck()?null===this.app?Promise.reject("Tracker not initialized"):void this.app.coldStart(e,t):Promise.reject("Trying to start not in browser.")}startOfflineRecording(e,t){return this.browserEnvCheck()?null===this.app?Promise.reject("Tracker not initialized"):this.app.offlineRecording(e,t):Promise.reject("Trying to start not in browser.")}uploadOfflineRecording(){if(null!==this.app)return this.app.uploadOfflineRecording()}stop(){if(null!==this.app)return this.app.stop(),this.app.session.getSessionHash()}forceFlushBatch(){null!==this.app&&this.app.forceFlushBatch()}getSessionToken(){return null===this.app?null:this.app.getSessionToken()}getSessionInfo(){return null===this.app?null:this.app.session.getInfo()}getSessionID(){return null===this.app?null:this.app.getSessionID()}getTabId(){return null===this.app?null:this.app.getTabId()}getUxId(){return null===this.app?null:this.app.getUxtId()}sessionID(){return T("'sessionID' method","'getSessionID' method","/"),this.getSessionID()}getSessionURL(e){if(null!==this.app)return this.app.getSessionURL(e)}setUserID(e){"string"==typeof e&&null!==this.app&&this.app.session.setUserID(e)}userID(e){T("'userID' method","'setUserID' method","/"),this.setUserID(e)}setUserAnonymousID(e){"string"==typeof e&&null!==this.app&&this.app.send([29,e])}userAnonymousID(e){T("'userAnonymousID' method","'setUserAnonymousID' method","/"),this.setUserAnonymousID(e)}setMetadata(e,t){"string"==typeof e&&"string"==typeof t&&null!==this.app&&this.app.session.setMetadata(e,t)}metadata(e,t){T("'metadata' method","'setMetadata' method","/"),this.setMetadata(e,t)}event(e,t=null,s=!1){if("string"==typeof e&&null!==this.app){if(s)return this.issue(e,t);try{t=JSON.stringify(t)}catch(e){return}this.app.send([27,e,t])}}issue(e,t=null){if("string"==typeof e&&null!==this.app){try{t=JSON.stringify(t)}catch(e){return}this.app.send([64,e,t])}}}
      
      /*
      (function(e){var e=0<arguments.length&&void 0!==e?e:{},t=window.OpenReplay||window.asayer,s=t.shift(),i=t.shift();let n=t.shift();"object"==typeof(n="number"==typeof n?{obscureTextEmails:!!(1&n),obscureTextNumbers:!!(n>>1&1),obscureInputNumbers:!!(n>>3&1),obscureInputEmails:!!(n>>4&1),defaultInputMode:n>>5}:n)&&null!==n||(n={});var s=Object.assign({projectKey:s,sessionToken:i},n,e,{__is_snippet:!0}),r=(t.i&&(s.ingestPoint=t.i),window.OpenReplay=window.asayer=new ca(s));let o=r.setUserID.bind(r),a=(r.setUserID=r.userID=e=>{null!==e&&o(e.toString())},r.setUserAnonymousID.bind(r)),h=(r.setUserAnonymousID=r.userAnonymousID=e=>{null!==e&&a(e.toString())},r.setMetadata.bind(r)),l=(r.setMetadata=r.metadata=(e,t)=>{"number"==typeof t&&NaN!==t&&(t=t.toString()),"string"==typeof e&&"string"==typeof t&&h(e,t)},r.event.bind(r));for(r.event=(e,t)=>{"string"==typeof e&&l(e,t)};t.length;){var c=t.shift();switch(c[0]){case 0:r.start(c[1]);break;case 1:r.stop();break;case 2:r.setUserID(c[1]);break;case 3:r.setUserAnonymousID(c[1]);break;case 4:r.setMetadata(c[1],c[2]);break;case 5:r.event(c[1],c[2],c[3]);break;case 6:r.issue(c[1],c[2])}}return r})().use(function(e,t={}){var s;if(null!==e&&null!=(s=null==navigator?void 0:navigator.mediaDevices)&&s.getUserMedia&&!e.insideIframe){if(e.checkRequiredVersion&&e.checkRequiredVersion("14.0.14"))return s=new cs(e,ro,t.__DISABLE_SECURE_MODE),e.debug.log(s),s;console.warn("OpenReplay Assist: couldn't load. The minimum required version of @openreplay/tracker@14.0.14 is not met")}})
      */
      console.log('Attempting to assign ca to window.OpenReplay. Typeof ca:', typeof ca);
      window.OpenReplay = ca;
    })();